<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>cave-master-frontend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">cave-master-frontend documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  Cave</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/view/admin-dashboard/profit/profit.component.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Interface pour une cave</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                        <a href="#location" 
>
                                            location
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="location"></a>
                                        <span class="name "><b>location</b>
                                            <a href="#location">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>location:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit } from &#x27;@angular/core&#x27;;
import { CommonModule } from &#x27;@angular/common&#x27;;
import { FormsModule, ReactiveFormsModule } from &#x27;@angular/forms&#x27;;

/**
 * √ânum√©rations import√©es
 */
export enum DrinkCategory {
  BIERES &#x3D; &#x27;Bi√®res&#x27;,
  SUCRERIES &#x3D; &#x27;Sucreries&#x27;,
  CHAMPAGNE &#x3D; &#x27;Champagne&#x27;,
  VIN_BLANC &#x3D; &#x27;Vin Blanc&#x27;,
  VIN_ROUGE &#x3D; &#x27;Vin Rouge&#x27;,
  VIN_ROSE &#x3D; &#x27;Vin Ros√©&#x27;,
  VIN_MOUSSEUX &#x3D; &#x27;Vin Mousseux&#x27;,
  LIQUEURS &#x3D; &#x27;Liqueurs&#x27;,
  BOISSONS_ENERGISANTES &#x3D; &#x27;Boissons √ânergisantes&#x27;,
  BOISSONS_LOCALES &#x3D; &#x27;Boissons Locales&#x27;
}

export enum DrinkFormat {
  CL_25 &#x3D; &#x27;25cl&#x27;,
  CL_33 &#x3D; &#x27;33cl&#x27;,
  CL_50 &#x3D; &#x27;50cl&#x27;,
  CL_65 &#x3D; &#x27;65cl&#x27;,
  CL_75 &#x3D; &#x27;75cl&#x27;,
  L_1 &#x3D; &#x27;1L&#x27;,
  L_1_5 &#x3D; &#x27;1.5L&#x27;,
  L_2 &#x3D; &#x27;2L&#x27;
}

export enum Supplier {
  SOLIBRA &#x3D; &#x27;Solibra&#x27;,
  BRASSIVOIRE &#x3D; &#x27;Brassivoire&#x27;,
  SICOBRA &#x3D; &#x27;Sicobra&#x27;,
  UNIBRA &#x3D; &#x27;Unibra&#x27;,
  AUTRES &#x3D; &#x27;Autres&#x27;
}

export enum BulkUnit {
  CARTON &#x3D; &#x27;Carton&#x27;,
  CASIER &#x3D; &#x27;Casier&#x27;,
  PACK &#x3D; &#x27;Pack&#x27;,
  CAISSE &#x3D; &#x27;Caisse&#x27;
}

/**
 * Interface pour une boisson
 */
interface Drink {
  id: string;
  name: string;
  icon: string;
  category: DrinkCategory;
  format: DrinkFormat;
  supplier: Supplier;
  depot: string;
  commercialName: string;
  commercialContact: string;
  bulkUnit: BulkUnit;
  bulkQuantity: number;
  unitsPerBulk: number;
  totalBottles: number;
  purchasePrice: number;
  sellingPrice: number;
  stock: number;
  sales?: number;
  description?: string;
}

/**
 * Interface pour une entr√©e de stock
 */
interface StockEntry {
  id: string;
  date: Date;
  drinkId: string;
  drinkName: string;
  drinkIcon: string;
  drinkCategory: DrinkCategory;
  drinkFormat: DrinkFormat;
  bulkUnit: BulkUnit;
  bulkQuantity: number;
  unitsPerBulk: number;
  quantity: number;
  supplier: Supplier;
  supplierInvoice?: string;
  deliveryNote?: string;
  commercialName: string;
  commercialContact: string;
  unitPrice: number;
  bulkPrice: number;
  totalCost: number;
  caveId: string;
  qualityCheck: &#x27;conforme&#x27; | &#x27;non-conforme&#x27; | &#x27;avec-reserve&#x27;;
  qualityNotes?: string;
  addedBy: string;
  batchNumber?: string;
  expiryDate?: Date;
  notes?: string;
}

/**
 * Type de sortie
 */
type ExitType &#x3D; &#x27;vente&#x27; | &#x27;transfert&#x27; | &#x27;perte&#x27; | &#x27;casse&#x27; | &#x27;peremption&#x27; | &#x27;degustation&#x27;;

/**
 * Interface pour une sortie de stock
 */
interface StockExit {
  id: string;
  date: Date;
  drinkId: string;
  drinkName: string;
  drinkIcon: string;
  drinkCategory: DrinkCategory;
  drinkFormat: DrinkFormat;
  type: ExitType;
  quantity: number;
  destination?: string;
  customer?: string;
  customerContact?: string;
  transferToCaveId?: string;
  unitPrice: number;
  totalAmount: number;
  caveId: string;
  processedBy: string;
  processedByName?: string;
  invoiceNumber?: string;
  deliveryNote?: string;
  lossReason?: string;
  breakageDetails?: string;
  expiryDate?: Date;
  notes?: string;
}

/**
 * Interface pour une d√©pense
 */
interface Expense {
  id: string;
  category: &#x27;salaire&#x27; | &#x27;electricite&#x27; | &#x27;eau&#x27; | &#x27;carburant&#x27; | &#x27;materiel&#x27; | &#x27;autre&#x27;;
  description: string;
  amount: number;
  date: string;
  beneficiary?: string;
}

/**
 * Interface pour une cave
 */
interface Cave {
  id: string;
  name: string;
  location: string;
}

/**
 * Type de p√©riode
 */
type PeriodType &#x3D; &#x27;mensuel&#x27; | &#x27;trimestriel&#x27; | &#x27;annuel&#x27; | &#x27;personnalise&#x27;;

/**
 * Interface pour les statistiques globales
 */
interface GlobalStats {
  // Revenus
  chiffreAffaires: number;           // Total des ventes
  totalVentesBrutes: number;         // Montant brut des ventes

  // Co√ªts
  totalAchats: number;               // Total des achats (entr√©es)
  totalDepenses: number;             // Total des d√©penses
  totalPertes: number;               // Total des pertes (casse, p√©remption, etc.)
  coutTotal: number;                 // Total des co√ªts (achats + d√©penses + pertes)

  // B√©n√©fices
  beneficeBrut: number;              // CA - Achats
  beneficeNet: number;               // CA - (Achats + D√©penses + Pertes)
  margeBrute: number;                // (CA - Achats) / CA * 100
  margeNette: number;                // B√©n√©fice Net / CA * 100

  // Stock
  stockDepart: number;               // Valeur du stock au d√©but de la p√©riode
  stockRestant: number;              // Valeur du stock actuel
  totalBoissonsAchetees: number;     // Nombre total d&#x27;unit√©s achet√©es
  totalBoissonsVendues: number;      // Nombre total d&#x27;unit√©s vendues
  totalBoissonsPertes: number;       // Nombre total d&#x27;unit√©s perdues

  // Transactions
  nombreVentes: number;              // Nombre de transactions de vente
  nombreEntrees: number;             // Nombre d&#x27;entr√©es de stock
  nombrePertes: number;              // Nombre de pertes enregistr√©es
  nombreDepenses: number;            // Nombre de d√©penses

  // Moyennes
  prixMoyenVente: number;            // Prix moyen de vente
  prixMoyenAchat: number;            // Prix moyen d&#x27;achat
  panierMoyen: number;               // Montant moyen par vente
}

/**
 * Interface pour les statistiques d√©taill√©es par item
 */
interface ItemStats {
  drinkId: string;
  drinkName: string;
  drinkIcon: string;
  category: DrinkCategory;
  format: DrinkFormat;
  supplier: Supplier;

  // Quantit√©s
  quantiteAchetee: number;
  quantiteVendue: number;
  quantitePerdue: number;
  stockActuel: number;

  // Montants
  coutAchat: number;
  revenueVente: number;
  valeurPertes: number;

  // Marges
  benefice: number;
  margePourcentage: number;

  // Prix
  prixAchatMoyen: number;
  prixVenteMoyen: number;
}

/**
 * Composant BeneficeComponent - VERSION COMPL√àTE
 * Calcul automatique des b√©n√©fices avec filtres avanc√©s
 */
@Component({
  selector: &#x27;app-profit&#x27;,
  standalone: true,
  imports: [CommonModule, FormsModule, ReactiveFormsModule],
  templateUrl: &#x27;./profit.component.html&#x27;,
  styleUrls: [&#x27;./profit.component.scss&#x27;]
})
export class ProfitComponent implements OnInit {

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // PROPRI√âT√âS - DONN√âES
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  drinks: Drink[] &#x3D; [];
  entries: StockEntry[] &#x3D; [];
  exits: StockExit[] &#x3D; [];
  expenses: Expense[] &#x3D; [];
  caves: Cave[] &#x3D; [];

  // Donn√©es filtr√©es
  filteredEntries: StockEntry[] &#x3D; [];
  filteredExits: StockExit[] &#x3D; [];
  filteredExpenses: Expense[] &#x3D; [];

  // Statistiques
  globalStats: GlobalStats &#x3D; this.getEmptyStats();
  itemStats: ItemStats[] &#x3D; [];

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // PROPRI√âT√âS - FILTRES
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  // Filtre de p√©riode
  periodType: PeriodType &#x3D; &#x27;mensuel&#x27;;
  selectedYear: number &#x3D; new Date().getFullYear();
  selectedMonth: number &#x3D; new Date().getMonth() + 1;
  selectedQuarter: number &#x3D; Math.ceil((new Date().getMonth() + 1) / 3);
  customStartDate: string &#x3D; &#x27;&#x27;;
  customEndDate: string &#x3D; &#x27;&#x27;;

  // Filtres avanc√©s
  selectedCave: string &#x3D; &#x27;all&#x27;;
  selectedCategory: DrinkCategory | &#x27;all&#x27; &#x3D; &#x27;all&#x27;;
  selectedSupplier: Supplier | &#x27;all&#x27; &#x3D; &#x27;all&#x27;;
  selectedFormat: DrinkFormat | &#x27;all&#x27; &#x3D; &#x27;all&#x27;;
  selectedBulkUnit: BulkUnit | &#x27;all&#x27; &#x3D; &#x27;all&#x27;;
  selectedDrink: string &#x3D; &#x27;all&#x27;;
  selectedExpenseCategory: string &#x3D; &#x27;all&#x27;;
  searchTerm: string &#x3D; &#x27;&#x27;;

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // PROPRI√âT√âS - UI
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  isLoading: boolean &#x3D; false;
  showFilters: boolean &#x3D; true;
  viewMode: &#x27;global&#x27; | &#x27;details&#x27; &#x3D; &#x27;global&#x27;;
  chartType: &#x27;bar&#x27; | &#x27;line&#x27; | &#x27;pie&#x27; &#x3D; &#x27;bar&#x27;;

  // √ânum√©rations pour le template
  drinkCategories &#x3D; Object.values(DrinkCategory);
  suppliers &#x3D; Object.values(Supplier);
  formats &#x3D; Object.values(DrinkFormat);
  bulkUnits &#x3D; Object.values(BulkUnit);
  expenseCategories &#x3D; [&#x27;salaire&#x27;, &#x27;electricite&#x27;, &#x27;eau&#x27;, &#x27;carburant&#x27;, &#x27;materiel&#x27;, &#x27;autre&#x27;];

  // Ann√©es disponibles
  availableYears: number[] &#x3D; [];

  // Mois
  months &#x3D; [
    { value: 1, label: &#x27;Janvier&#x27; },
    { value: 2, label: &#x27;F√©vrier&#x27; },
    { value: 3, label: &#x27;Mars&#x27; },
    { value: 4, label: &#x27;Avril&#x27; },
    { value: 5, label: &#x27;Mai&#x27; },
    { value: 6, label: &#x27;Juin&#x27; },
    { value: 7, label: &#x27;Juillet&#x27; },
    { value: 8, label: &#x27;Ao√ªt&#x27; },
    { value: 9, label: &#x27;Septembre&#x27; },
    { value: 10, label: &#x27;Octobre&#x27; },
    { value: 11, label: &#x27;Novembre&#x27; },
    { value: 12, label: &#x27;D√©cembre&#x27; }
  ];

  // Trimestres
  quarters &#x3D; [
    { value: 1, label: &#x27;T1 (Jan-Mar)&#x27; },
    { value: 2, label: &#x27;T2 (Avr-Jun)&#x27; },
    { value: 3, label: &#x27;T3 (Jul-Sep)&#x27; },
    { value: 4, label: &#x27;T4 (Oct-D√©c)&#x27; }
  ];

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // CONSTRUCTEUR
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  constructor() {}

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // LIFECYCLE HOOKS
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  ngOnInit(): void {
    console.log(&#x27;‚úÖ ProfitComponent initialis√©&#x27;);
    this.loadData();
    this.initializeYears();
    this.applyFilters();
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // CHARGEMENT DES DONN√âES
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  loadData(): void {
    this.isLoading &#x3D; true;

    // Charge toutes les donn√©es
    this.drinks &#x3D; this.loadDrinks();
    this.entries &#x3D; this.loadEntries();
    this.exits &#x3D; this.loadExits();
    this.expenses &#x3D; this.loadExpenses();
    this.caves &#x3D; this.loadCaves();

    this.isLoading &#x3D; false;
    console.log(&#x27;‚úÖ Donn√©es charg√©es:&#x27;, {
      drinks: this.drinks.length,
      entries: this.entries.length,
      exits: this.exits.length,
      expenses: this.expenses.length,
      caves: this.caves.length
    });
  }

  private loadDrinks(): Drink[] {
    // Simule le chargement des boissons
    return [
      {
        id: &#x27;drink_1&#x27;,
        name: &#x27;Heineken&#x27;,
        icon: &#x27;üç∫&#x27;,
        category: DrinkCategory.BIERES,
        format: DrinkFormat.CL_33,
        supplier: Supplier.SOLIBRA,
        depot: &#x27;D√©p√¥t Abidjan Zone 4&#x27;,
        commercialName: &#x27;Kouadio Jean&#x27;,
        commercialContact: &#x27;+225 07 00 00 00 01&#x27;,
        bulkUnit: BulkUnit.CARTON,
        bulkQuantity: 3,
        unitsPerBulk: 12,
        totalBottles: 36,
        purchasePrice: 650,
        sellingPrice: 800,
        stock: 150,
        sales: 450
      },
      {
        id: &#x27;drink_2&#x27;,
        name: &#x27;Bordeaux Rouge 2018&#x27;,
        icon: &#x27;üç∑&#x27;,
        category: DrinkCategory.VIN_ROUGE,
        format: DrinkFormat.CL_75,
        supplier: Supplier.AUTRES,
        depot: &#x27;D√©p√¥t Cocody&#x27;,
        commercialName: &#x27;Bakayoko Aminata&#x27;,
        commercialContact: &#x27;+225 05 00 00 00 02&#x27;,
        bulkUnit: BulkUnit.CAISSE,
        bulkQuantity: 2,
        unitsPerBulk: 6,
        totalBottles: 12,
        purchasePrice: 12000,
        sellingPrice: 15000,
        stock: 45,
        sales: 120
      },
      {
        id: &#x27;drink_3&#x27;,
        name: &#x27;Champagne Mo√´t &amp; Chandon&#x27;,
        icon: &#x27;üçæ&#x27;,
        category: DrinkCategory.CHAMPAGNE,
        format: DrinkFormat.CL_75,
        supplier: Supplier.AUTRES,
        depot: &#x27;D√©p√¥t Plateau&#x27;,
        commercialName: &#x27;Kon√© Moussa&#x27;,
        commercialContact: &#x27;+225 07 11 22 33 44&#x27;,
        bulkUnit: BulkUnit.CAISSE,
        bulkQuantity: 1,
        unitsPerBulk: 6,
        totalBottles: 6,
        purchasePrice: 30000,
        sellingPrice: 35000,
        stock: 20,
        sales: 85
      }
    ];
  }

  private loadEntries(): StockEntry[] {
    const now &#x3D; new Date();
    return [
      {
        id: &#x27;entry_1&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 15),
        drinkId: &#x27;drink_1&#x27;,
        drinkName: &#x27;Heineken&#x27;,
        drinkIcon: &#x27;üç∫&#x27;,
        drinkCategory: DrinkCategory.BIERES,
        drinkFormat: DrinkFormat.CL_33,
        bulkUnit: BulkUnit.CARTON,
        bulkQuantity: 10,
        unitsPerBulk: 12,
        quantity: 120,
        supplier: Supplier.SOLIBRA,
        commercialName: &#x27;Kouadio Jean&#x27;,
        commercialContact: &#x27;+225 07 00 00 00 01&#x27;,
        unitPrice: 650,
        bulkPrice: 7800,
        totalCost: 78000,
        caveId: &#x27;cave_1&#x27;,
        qualityCheck: &#x27;conforme&#x27;,
        addedBy: &#x27;Admin&#x27;
      },
      {
        id: &#x27;entry_2&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 10),
        drinkId: &#x27;drink_2&#x27;,
        drinkName: &#x27;Bordeaux Rouge 2018&#x27;,
        drinkIcon: &#x27;üç∑&#x27;,
        drinkCategory: DrinkCategory.VIN_ROUGE,
        drinkFormat: DrinkFormat.CL_75,
        bulkUnit: BulkUnit.CAISSE,
        bulkQuantity: 5,
        unitsPerBulk: 6,
        quantity: 30,
        supplier: Supplier.AUTRES,
        commercialName: &#x27;Bakayoko Aminata&#x27;,
        commercialContact: &#x27;+225 05 00 00 00 02&#x27;,
        unitPrice: 12000,
        bulkPrice: 72000,
        totalCost: 360000,
        caveId: &#x27;cave_1&#x27;,
        qualityCheck: &#x27;conforme&#x27;,
        addedBy: &#x27;Admin&#x27;
      },
      {
        id: &#x27;entry_3&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 5),
        drinkId: &#x27;drink_3&#x27;,
        drinkName: &#x27;Champagne Mo√´t &amp; Chandon&#x27;,
        drinkIcon: &#x27;üçæ&#x27;,
        drinkCategory: DrinkCategory.CHAMPAGNE,
        drinkFormat: DrinkFormat.CL_75,
        bulkUnit: BulkUnit.CAISSE,
        bulkQuantity: 3,
        unitsPerBulk: 6,
        quantity: 18,
        supplier: Supplier.AUTRES,
        commercialName: &#x27;Kon√© Moussa&#x27;,
        commercialContact: &#x27;+225 07 11 22 33 44&#x27;,
        unitPrice: 30000,
        bulkPrice: 180000,
        totalCost: 540000,
        caveId: &#x27;cave_1&#x27;,
        qualityCheck: &#x27;conforme&#x27;,
        addedBy: &#x27;Admin&#x27;
      }
    ];
  }

  private loadExits(): StockExit[] {
    const now &#x3D; new Date();
    return [
      {
        id: &#x27;exit_1&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 20),
        drinkId: &#x27;drink_1&#x27;,
        drinkName: &#x27;Heineken&#x27;,
        drinkIcon: &#x27;üç∫&#x27;,
        drinkCategory: DrinkCategory.BIERES,
        drinkFormat: DrinkFormat.CL_33,
        type: &#x27;vente&#x27;,
        quantity: 50,
        unitPrice: 800,
        totalAmount: 40000,
        caveId: &#x27;cave_1&#x27;,
        customer: &#x27;Restaurant Le Gourmet&#x27;,
        customerContact: &#x27;+225 07 22 33 44 55&#x27;,
        destination: &#x27;Restaurant Le Gourmet - Cocody&#x27;,
        processedBy: &#x27;user_1&#x27;,
        processedByName: &#x27;Jean Dupont&#x27;
      },
      {
        id: &#x27;exit_2&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 18),
        drinkId: &#x27;drink_2&#x27;,
        drinkName: &#x27;Bordeaux Rouge 2018&#x27;,
        drinkIcon: &#x27;üç∑&#x27;,
        drinkCategory: DrinkCategory.VIN_ROUGE,
        drinkFormat: DrinkFormat.CL_75,
        type: &#x27;vente&#x27;,
        quantity: 15,
        unitPrice: 15000,
        totalAmount: 225000,
        caveId: &#x27;cave_1&#x27;,
        customer: &#x27;H√¥tel Ivoire&#x27;,
        customerContact: &#x27;+225 27 22 48 10 00&#x27;,
        destination: &#x27;H√¥tel Ivoire - Cocody&#x27;,
        processedBy: &#x27;user_2&#x27;,
        processedByName: &#x27;Marie Martin&#x27;
      },
      {
        id: &#x27;exit_3&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 22),
        drinkId: &#x27;drink_3&#x27;,
        drinkName: &#x27;Champagne Mo√´t &amp; Chandon&#x27;,
        drinkIcon: &#x27;üçæ&#x27;,
        drinkCategory: DrinkCategory.CHAMPAGNE,
        drinkFormat: DrinkFormat.CL_75,
        type: &#x27;vente&#x27;,
        quantity: 8,
        unitPrice: 35000,
        totalAmount: 280000,
        caveId: &#x27;cave_1&#x27;,
        customer: &#x27;√âv√©nement Corporate&#x27;,
        customerContact: &#x27;+225 05 66 77 88 99&#x27;,
        destination: &#x27;Sofitel H√¥tel Ivoire&#x27;,
        processedBy: &#x27;user_2&#x27;,
        processedByName: &#x27;Marie Martin&#x27;
      },
      {
        id: &#x27;exit_4&#x27;,
        date: new Date(now.getFullYear(), now.getMonth(), 12),
        drinkId: &#x27;drink_1&#x27;,
        drinkName: &#x27;Heineken&#x27;,
        drinkIcon: &#x27;üç∫&#x27;,
        drinkCategory: DrinkCategory.BIERES,
        drinkFormat: DrinkFormat.CL_33,
        type: &#x27;casse&#x27;,
        quantity: 5,
        unitPrice: 650,
        totalAmount: 3250,
        caveId: &#x27;cave_1&#x27;,
        lossReason: &#x27;Casse lors de la manipulation&#x27;,
        breakageDetails: &#x27;5 bouteilles cass√©es&#x27;,
        destination: &#x27;Perte par casse&#x27;,
        processedBy: &#x27;user_3&#x27;,
        processedByName: &#x27;Pierre Dubois&#x27;
      }
    ];
  }

  private loadExpenses(): Expense[] {
    const now &#x3D; new Date();
    return [
      {
        id: &#x27;exp_1&#x27;,
        category: &#x27;salaire&#x27;,
        description: &#x27;Salaires du mois&#x27;,
        amount: 500000,
        date: &#x60;${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, &#x27;0&#x27;)}-01&#x60;,
        beneficiary: &#x27;Employ√©s&#x27;
      },
      {
        id: &#x27;exp_2&#x27;,
        category: &#x27;electricite&#x27;,
        description: &#x27;Facture d\&#x27;√©lectricit√©&#x27;,
        amount: 75000,
        date: &#x60;${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, &#x27;0&#x27;)}-05&#x60;,
        beneficiary: &#x27;CIE&#x27;
      },
      {
        id: &#x27;exp_3&#x27;,
        category: &#x27;eau&#x27;,
        description: &#x27;Facture d\&#x27;eau&#x27;,
        amount: 25000,
        date: &#x60;${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, &#x27;0&#x27;)}-06&#x60;,
        beneficiary: &#x27;SODECI&#x27;
      },
      {
        id: &#x27;exp_4&#x27;,
        category: &#x27;materiel&#x27;,
        description: &#x27;Achat de verres&#x27;,
        amount: 120000,
        date: &#x60;${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, &#x27;0&#x27;)}-10&#x60;,
        beneficiary: &#x27;Fournisseur Mat√©riel&#x27;
      }
    ];
  }

  private loadCaves(): Cave[] {
    return [
      { id: &#x27;cave_1&#x27;, name: &#x27;Cave Principale&#x27;, location: &#x27;B√¢timent A&#x27; },
      { id: &#x27;cave_2&#x27;, name: &#x27;Cave Secondaire&#x27;, location: &#x27;B√¢timent B&#x27; },
      { id: &#x27;cave_3&#x27;, name: &#x27;Cave Restaurant&#x27;, location: &#x27;Restaurant&#x27; }
    ];
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // INITIALISATION
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  initializeYears(): void {
    const currentYear &#x3D; new Date().getFullYear();
    this.availableYears &#x3D; [];
    for (let year &#x3D; currentYear - 5; year &lt;&#x3D; currentYear; year++) {
      this.availableYears.push(year);
    }
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // FILTRAGE
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  applyFilters(): void {
    console.log(&#x27;üîÑ Application des filtres...&#x27;);

    // 1. Filtre par p√©riode
    this.filterByPeriod();

    // 2. Filtre par crit√®res
    this.filterByCriteria();

    // 3. Calcul des statistiques
    this.calculateGlobalStats();
    this.calculateItemStats();

    console.log(&#x27;‚úÖ Filtres appliqu√©s&#x27;);
  }

  private filterByPeriod(): void {
    let startDate: Date;
    let endDate: Date;

    switch (this.periodType) {
      case &#x27;mensuel&#x27;:
        startDate &#x3D; new Date(this.selectedYear, this.selectedMonth - 1, 1);
        endDate &#x3D; new Date(this.selectedYear, this.selectedMonth, 0, 23, 59, 59);
        break;

      case &#x27;trimestriel&#x27;:
        const quarterStartMonth &#x3D; (this.selectedQuarter - 1) * 3;
        startDate &#x3D; new Date(this.selectedYear, quarterStartMonth, 1);
        endDate &#x3D; new Date(this.selectedYear, quarterStartMonth + 3, 0, 23, 59, 59);
        break;

      case &#x27;annuel&#x27;:
        startDate &#x3D; new Date(this.selectedYear, 0, 1);
        endDate &#x3D; new Date(this.selectedYear, 11, 31, 23, 59, 59);
        break;

      case &#x27;personnalise&#x27;:
        if (!this.customStartDate || !this.customEndDate) {
          alert(&#x27;‚ö†Ô∏è Veuillez s√©lectionner une p√©riode personnalis√©e&#x27;);
          return;
        }
        startDate &#x3D; new Date(this.customStartDate);
        endDate &#x3D; new Date(this.customEndDate);
        endDate.setHours(23, 59, 59);
        break;

      default:
        return;
    }

    // Filtre les entr√©es
    this.filteredEntries &#x3D; this.entries.filter(entry &#x3D;&gt; {
      const entryDate &#x3D; new Date(entry.date);
      return entryDate &gt;&#x3D; startDate &amp;&amp; entryDate &lt;&#x3D; endDate;
    });

    // Filtre les sorties
    this.filteredExits &#x3D; this.exits.filter(exit &#x3D;&gt; {
      const exitDate &#x3D; new Date(exit.date);
      return exitDate &gt;&#x3D; startDate &amp;&amp; exitDate &lt;&#x3D; endDate;
    });

    // Filtre les d√©penses
    this.filteredExpenses &#x3D; this.expenses.filter(expense &#x3D;&gt; {
      const expenseDate &#x3D; new Date(expense.date);
      return expenseDate &gt;&#x3D; startDate &amp;&amp; expenseDate &lt;&#x3D; endDate;
    });

    console.log(&#x27;üìÖ P√©riode filtr√©e:&#x27;, {
      startDate: startDate.toLocaleDateString(&#x27;fr-FR&#x27;),
      endDate: endDate.toLocaleDateString(&#x27;fr-FR&#x27;),
      entries: this.filteredEntries.length,
      exits: this.filteredExits.length,
      expenses: this.filteredExpenses.length
    });
  }

  private filterByCriteria(): void {
    // Filtre par cave
    if (this.selectedCave !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.caveId &#x3D;&#x3D;&#x3D; this.selectedCave);
      this.filteredExits &#x3D; this.filteredExits.filter(e &#x3D;&gt; e.caveId &#x3D;&#x3D;&#x3D; this.selectedCave);
    }

    // Filtre par cat√©gorie
    if (this.selectedCategory !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.drinkCategory &#x3D;&#x3D;&#x3D; this.selectedCategory);
      this.filteredExits &#x3D; this.filteredExits.filter(e &#x3D;&gt; e.drinkCategory &#x3D;&#x3D;&#x3D; this.selectedCategory);
    }

    // Filtre par fournisseur
    if (this.selectedSupplier !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.supplier &#x3D;&#x3D;&#x3D; this.selectedSupplier);
    }

    // Filtre par format
    if (this.selectedFormat !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.drinkFormat &#x3D;&#x3D;&#x3D; this.selectedFormat);
      this.filteredExits &#x3D; this.filteredExits.filter(e &#x3D;&gt; e.drinkFormat &#x3D;&#x3D;&#x3D; this.selectedFormat);
    }

    // Filtre par conditionnement
    if (this.selectedBulkUnit !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.bulkUnit &#x3D;&#x3D;&#x3D; this.selectedBulkUnit);
    }

    // Filtre par boisson
    if (this.selectedDrink !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; this.selectedDrink);
      this.filteredExits &#x3D; this.filteredExits.filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; this.selectedDrink);
    }

    // Filtre par cat√©gorie de d√©pense
    if (this.selectedExpenseCategory !&#x3D;&#x3D; &#x27;all&#x27;) {
      this.filteredExpenses &#x3D; this.filteredExpenses.filter(e &#x3D;&gt; e.category &#x3D;&#x3D;&#x3D; this.selectedExpenseCategory);
    }

    // Filtre par recherche textuelle
    if (this.searchTerm.trim()) {
      const term &#x3D; this.searchTerm.toLowerCase();

      this.filteredEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt;
        e.drinkName.toLowerCase().includes(term) ||
        e.commercialName.toLowerCase().includes(term) ||
        e.notes?.toLowerCase().includes(term)
      );

      this.filteredExits &#x3D; this.filteredExits.filter(e &#x3D;&gt;
        e.drinkName.toLowerCase().includes(term) ||
        e.customer?.toLowerCase().includes(term) ||
        e.destination?.toLowerCase().includes(term) ||
        e.notes?.toLowerCase().includes(term)
      );

      this.filteredExpenses &#x3D; this.filteredExpenses.filter(e &#x3D;&gt;
        e.description.toLowerCase().includes(term) ||
        e.beneficiary?.toLowerCase().includes(term)
      );
    }
  }

  onPeriodTypeChange(): void {
    this.applyFilters();
  }

  onYearChange(): void {
    this.applyFilters();
  }

  onMonthChange(): void {
    this.applyFilters();
  }

  onQuarterChange(): void {
    this.applyFilters();
  }

  onCaveChange(): void {
    this.applyFilters();
  }

  onCategoryChange(): void {
    this.applyFilters();
  }

  onSupplierChange(): void {
    this.applyFilters();
  }

  onFormatChange(): void {
    this.applyFilters();
  }

  onBulkUnitChange(): void {
    this.applyFilters();
  }

  onDrinkChange(): void {
    this.applyFilters();
  }

  onExpenseCategoryChange(): void {
    this.applyFilters();
  }

  onSearchChange(): void {
    this.applyFilters();
  }

  resetFilters(): void {
    this.selectedCave &#x3D; &#x27;all&#x27;;
    this.selectedCategory &#x3D; &#x27;all&#x27;;
    this.selectedSupplier &#x3D; &#x27;all&#x27;;
    this.selectedFormat &#x3D; &#x27;all&#x27;;
    this.selectedBulkUnit &#x3D; &#x27;all&#x27;;
    this.selectedDrink &#x3D; &#x27;all&#x27;;
    this.selectedExpenseCategory &#x3D; &#x27;all&#x27;;
    this.searchTerm &#x3D; &#x27;&#x27;;
    this.applyFilters();
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // CALCUL DES STATISTIQUES GLOBALES
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  calculateGlobalStats(): void {
    console.log(&#x27;üìä Calcul des statistiques globales...&#x27;);

    // R√©initialise les stats
    this.globalStats &#x3D; this.getEmptyStats();

    // 1. CALCUL DES ACHATS (Entr√©es)
    this.globalStats.totalAchats &#x3D; this.filteredEntries.reduce((sum, entry) &#x3D;&gt; sum + entry.totalCost, 0);
    this.globalStats.totalBoissonsAchetees &#x3D; this.filteredEntries.reduce((sum, entry) &#x3D;&gt; sum + entry.quantity, 0);
    this.globalStats.nombreEntrees &#x3D; this.filteredEntries.length;

    if (this.filteredEntries.length &gt; 0) {
      const totalPrixAchats &#x3D; this.filteredEntries.reduce((sum, entry) &#x3D;&gt; sum + entry.unitPrice, 0);
      this.globalStats.prixMoyenAchat &#x3D; totalPrixAchats / this.filteredEntries.length;
    }

    // 2. CALCUL DES VENTES
    const ventes &#x3D; this.filteredExits.filter(exit &#x3D;&gt; exit.type &#x3D;&#x3D;&#x3D; &#x27;vente&#x27;);
    this.globalStats.chiffreAffaires &#x3D; ventes.reduce((sum, exit) &#x3D;&gt; sum + exit.totalAmount, 0);
    this.globalStats.totalVentesBrutes &#x3D; this.globalStats.chiffreAffaires;
    this.globalStats.totalBoissonsVendues &#x3D; ventes.reduce((sum, exit) &#x3D;&gt; sum + exit.quantity, 0);
    this.globalStats.nombreVentes &#x3D; ventes.length;

    if (ventes.length &gt; 0) {
      const totalPrixVentes &#x3D; ventes.reduce((sum, exit) &#x3D;&gt; sum + exit.unitPrice, 0);
      this.globalStats.prixMoyenVente &#x3D; totalPrixVentes / ventes.length;
      this.globalStats.panierMoyen &#x3D; this.globalStats.chiffreAffaires / ventes.length;
    }

    // 3. CALCUL DES PERTES (Casse, P√©remption, Perte)
    const pertes &#x3D; this.filteredExits.filter(exit &#x3D;&gt;
      [&#x27;perte&#x27;, &#x27;casse&#x27;, &#x27;peremption&#x27;].includes(exit.type)
    );
    this.globalStats.totalPertes &#x3D; pertes.reduce((sum, exit) &#x3D;&gt; sum + exit.totalAmount, 0);
    this.globalStats.totalBoissonsPertes &#x3D; pertes.reduce((sum, exit) &#x3D;&gt; sum + exit.quantity, 0);
    this.globalStats.nombrePertes &#x3D; pertes.length;

    // 4. CALCUL DES D√âPENSES
    this.globalStats.totalDepenses &#x3D; this.filteredExpenses.reduce((sum, expense) &#x3D;&gt; sum + expense.amount, 0);
    this.globalStats.nombreDepenses &#x3D; this.filteredExpenses.length;

    // 5. CALCUL DES CO√õTS TOTAUX
    this.globalStats.coutTotal &#x3D;
      this.globalStats.totalAchats +
      this.globalStats.totalDepenses +
      this.globalStats.totalPertes;

    // 6. CALCUL DES B√âN√âFICES
    this.globalStats.beneficeBrut &#x3D; this.globalStats.chiffreAffaires - this.globalStats.totalAchats;
    this.globalStats.beneficeNet &#x3D; this.globalStats.chiffreAffaires - this.globalStats.coutTotal;

    // 7. CALCUL DES MARGES
    if (this.globalStats.chiffreAffaires &gt; 0) {
      this.globalStats.margeBrute &#x3D; (this.globalStats.beneficeBrut / this.globalStats.chiffreAffaires) * 100;
      this.globalStats.margeNette &#x3D; (this.globalStats.beneficeNet / this.globalStats.chiffreAffaires) * 100;
    }

    // 8. CALCUL DU STOCK
    // Stock de d√©part &#x3D; Stock actuel + Ventes - Achats + Pertes
    this.drinks.forEach(drink &#x3D;&gt; {
      const achats &#x3D; this.filteredEntries
        .filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; drink.id)
        .reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);

      const ventesQty &#x3D; ventes
        .filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; drink.id)
        .reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);

      const pertesQty &#x3D; pertes
        .filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; drink.id)
        .reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);

      const stockDepart &#x3D; drink.stock + ventesQty + pertesQty - achats;

      this.globalStats.stockDepart +&#x3D; stockDepart * drink.purchasePrice;
      this.globalStats.stockRestant +&#x3D; drink.stock * drink.purchasePrice;
    });

    console.log(&#x27;‚úÖ Statistiques globales calcul√©es:&#x27;, this.globalStats);
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // CALCUL DES STATISTIQUES PAR ITEM
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  calculateItemStats(): void {
    console.log(&#x27;üìä Calcul des statistiques par item...&#x27;);

    this.itemStats &#x3D; [];

    // Pour chaque boisson, calcule ses statistiques
    this.drinks.forEach(drink &#x3D;&gt; {
      // Filtre les entr√©es et sorties pour cette boisson
      const drinkEntries &#x3D; this.filteredEntries.filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; drink.id);
      const drinkExits &#x3D; this.filteredExits.filter(e &#x3D;&gt; e.drinkId &#x3D;&#x3D;&#x3D; drink.id);
      const ventes &#x3D; drinkExits.filter(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; &#x27;vente&#x27;);
      const pertes &#x3D; drinkExits.filter(e &#x3D;&gt; [&#x27;perte&#x27;, &#x27;casse&#x27;, &#x27;peremption&#x27;].includes(e.type));

      // Si aucune transaction, on passe
      if (drinkEntries.length &#x3D;&#x3D;&#x3D; 0 &amp;&amp; drinkExits.length &#x3D;&#x3D;&#x3D; 0) {
        return;
      }

      // Quantit√©s
      const quantiteAchetee &#x3D; drinkEntries.reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);
      const quantiteVendue &#x3D; ventes.reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);
      const quantitePerdue &#x3D; pertes.reduce((sum, e) &#x3D;&gt; sum + e.quantity, 0);

      // Montants
      const coutAchat &#x3D; drinkEntries.reduce((sum, e) &#x3D;&gt; sum + e.totalCost, 0);
      const revenueVente &#x3D; ventes.reduce((sum, e) &#x3D;&gt; sum + e.totalAmount, 0);
      const valeurPertes &#x3D; pertes.reduce((sum, e) &#x3D;&gt; sum + e.totalAmount, 0);

      // B√©n√©fice
      const benefice &#x3D; revenueVente - coutAchat;
      const margePourcentage &#x3D; revenueVente &gt; 0 ? (benefice / revenueVente) * 100 : 0;

      // Prix moyens
      const prixAchatMoyen &#x3D; drinkEntries.length &gt; 0
        ? drinkEntries.reduce((sum, e) &#x3D;&gt; sum + e.unitPrice, 0) / drinkEntries.length
        : drink.purchasePrice;

      const prixVenteMoyen &#x3D; ventes.length &gt; 0
        ? ventes.reduce((sum, e) &#x3D;&gt; sum + e.unitPrice, 0) / ventes.length
        : drink.sellingPrice;

      // Ajoute les stats
      this.itemStats.push({
        drinkId: drink.id,
        drinkName: drink.name,
        drinkIcon: drink.icon,
        category: drink.category,
        format: drink.format,
        supplier: drink.supplier,
        quantiteAchetee,
        quantiteVendue,
        quantitePerdue,
        stockActuel: drink.stock,
        coutAchat,
        revenueVente,
        valeurPertes,
        benefice,
        margePourcentage,
        prixAchatMoyen,
        prixVenteMoyen
      });
    });

    // Trie par b√©n√©fice d√©croissant
    this.itemStats.sort((a, b) &#x3D;&gt; b.benefice - a.benefice);

    console.log(&#x27;‚úÖ Statistiques par item calcul√©es:&#x27;, this.itemStats.length, &#x27;items&#x27;);
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // M√âTHODES UTILITAIRES
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  private getEmptyStats(): GlobalStats {
    return {
      chiffreAffaires: 0,
      totalVentesBrutes: 0,
      totalAchats: 0,
      totalDepenses: 0,
      totalPertes: 0,
      coutTotal: 0,
      beneficeBrut: 0,
      beneficeNet: 0,
      margeBrute: 0,
      margeNette: 0,
      stockDepart: 0,
      stockRestant: 0,
      totalBoissonsAchetees: 0,
      totalBoissonsVendues: 0,
      totalBoissonsPertes: 0,
      nombreVentes: 0,
      nombreEntrees: 0,
      nombrePertes: 0,
      nombreDepenses: 0,
      prixMoyenVente: 0,
      prixMoyenAchat: 0,
      panierMoyen: 0
    };
  }

  formatNumber(num: number): string {
    return num.toFixed(0).replace(/\B(?&#x3D;(\d{3})+(?!\d))/g, &#x27; &#x27;);
  }

  formatCurrency(num: number): string {
    return this.formatNumber(num) + &#x27; FCFA&#x27;;
  }

  formatPercentage(num: number): string {
    return num.toFixed(2) + &#x27; %&#x27;;
  }

  getCaveName(caveId: string): string {
    const cave &#x3D; this.caves.find(c &#x3D;&gt; c.id &#x3D;&#x3D;&#x3D; caveId);
    return cave ? cave.name : &#x27;Inconnue&#x27;;
  }

  getPeriodLabel(): string {
    switch (this.periodType) {
      case &#x27;mensuel&#x27;:
        const month &#x3D; this.months.find(m &#x3D;&gt; m.value &#x3D;&#x3D;&#x3D; this.selectedMonth);
        return &#x60;${month?.label} ${this.selectedYear}&#x60;;

      case &#x27;trimestriel&#x27;:
        const quarter &#x3D; this.quarters.find(q &#x3D;&gt; q.value &#x3D;&#x3D;&#x3D; this.selectedQuarter);
        return &#x60;${quarter?.label} ${this.selectedYear}&#x60;;

      case &#x27;annuel&#x27;:
        return &#x60;Ann√©e ${this.selectedYear}&#x60;;

      case &#x27;personnalise&#x27;:
        if (this.customStartDate &amp;&amp; this.customEndDate) {
          const start &#x3D; new Date(this.customStartDate).toLocaleDateString(&#x27;fr-FR&#x27;);
          const end &#x3D; new Date(this.customEndDate).toLocaleDateString(&#x27;fr-FR&#x27;);
          return &#x60;${start} - ${end}&#x60;;
        }
        return &#x27;P√©riode personnalis√©e&#x27;;

      default:
        return &#x27;&#x27;;
    }
  }

  getStatusClass(value: number): string {
    if (value &gt; 0) return &#x27;text-success&#x27;;
    if (value &lt; 0) return &#x27;text-danger&#x27;;
    return &#x27;text-muted&#x27;;
  }

  getStatusIcon(value: number): string {
    if (value &gt; 0) return &#x27;üìà&#x27;;
    if (value &lt; 0) return &#x27;üìâ&#x27;;
    return &#x27;‚ûñ&#x27;;
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // CHANGEMENT DE VUE
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  switchView(view: &#x27;global&#x27; | &#x27;details&#x27;): void {
    this.viewMode &#x3D; view;
  }

  toggleFilters(): void {
    this.showFilters &#x3D; !this.showFilters;
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // EXPORT
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  exportToCSV(): void {
    if (this.viewMode &#x3D;&#x3D;&#x3D; &#x27;global&#x27;) {
      this.exportGlobalToCSV();
    } else {
      this.exportDetailsToCSV();
    }
  }

  private exportGlobalToCSV(): void {
    const headers &#x3D; [
      &#x27;P√©riode&#x27;,
      &#x27;Chiffre d\&#x27;Affaires (FCFA)&#x27;,
      &#x27;Total Achats (FCFA)&#x27;,
      &#x27;Total D√©penses (FCFA)&#x27;,
      &#x27;Total Pertes (FCFA)&#x27;,
      &#x27;Co√ªt Total (FCFA)&#x27;,
      &#x27;B√©n√©fice Brut (FCFA)&#x27;,
      &#x27;B√©n√©fice Net (FCFA)&#x27;,
      &#x27;Marge Brute (%)&#x27;,
      &#x27;Marge Nette (%)&#x27;,
      &#x27;Stock D√©part (FCFA)&#x27;,
      &#x27;Stock Restant (FCFA)&#x27;,
      &#x27;Boissons Achet√©es&#x27;,
      &#x27;Boissons Vendues&#x27;,
      &#x27;Boissons Perdues&#x27;,
      &#x27;Nombre Ventes&#x27;,
      &#x27;Nombre Entr√©es&#x27;,
      &#x27;Nombre Pertes&#x27;,
      &#x27;Nombre D√©penses&#x27;,
      &#x27;Prix Moyen Vente&#x27;,
      &#x27;Prix Moyen Achat&#x27;,
      &#x27;Panier Moyen&#x27;
    ];

    const row &#x3D; [
      this.getPeriodLabel(),
      this.globalStats.chiffreAffaires,
      this.globalStats.totalAchats,
      this.globalStats.totalDepenses,
      this.globalStats.totalPertes,
      this.globalStats.coutTotal,
      this.globalStats.beneficeBrut,
      this.globalStats.beneficeNet,
      this.globalStats.margeBrute.toFixed(2),
      this.globalStats.margeNette.toFixed(2),
      this.globalStats.stockDepart,
      this.globalStats.stockRestant,
      this.globalStats.totalBoissonsAchetees,
      this.globalStats.totalBoissonsVendues,
      this.globalStats.totalBoissonsPertes,
      this.globalStats.nombreVentes,
      this.globalStats.nombreEntrees,
      this.globalStats.nombrePertes,
      this.globalStats.nombreDepenses,
      this.globalStats.prixMoyenVente.toFixed(0),
      this.globalStats.prixMoyenAchat.toFixed(0),
      this.globalStats.panierMoyen.toFixed(0)
    ];

    const csv &#x3D; [
      headers.join(&#x27;,&#x27;),
      row.join(&#x27;,&#x27;)
    ].join(&#x27;\n&#x27;);

    this.downloadFile(csv, &#x60;benefices-global-${Date.now()}.csv&#x60;);
    alert(&#x27;‚úÖ Export global r√©ussi !&#x27;);
  }

  private exportDetailsToCSV(): void {
    const headers &#x3D; [
      &#x27;Boisson&#x27;,
      &#x27;Cat√©gorie&#x27;,
      &#x27;Format&#x27;,
      &#x27;Fournisseur&#x27;,
      &#x27;Quantit√© Achet√©e&#x27;,
      &#x27;Quantit√© Vendue&#x27;,
      &#x27;Quantit√© Perdue&#x27;,
      &#x27;Stock Actuel&#x27;,
      &#x27;Co√ªt Achat (FCFA)&#x27;,
      &#x27;Revenue Vente (FCFA)&#x27;,
      &#x27;Valeur Pertes (FCFA)&#x27;,
      &#x27;B√©n√©fice (FCFA)&#x27;,
      &#x27;Marge (%)&#x27;,
      &#x27;Prix Achat Moyen&#x27;,
      &#x27;Prix Vente Moyen&#x27;
    ];

    const rows &#x3D; this.itemStats.map(item &#x3D;&gt; [
      item.drinkName,
      item.category,
      item.format,
      item.supplier,
      item.quantiteAchetee,
      item.quantiteVendue,
      item.quantitePerdue,
      item.stockActuel,
      item.coutAchat,
      item.revenueVente,
      item.valeurPertes,
      item.benefice,
      item.margePourcentage.toFixed(2),
      item.prixAchatMoyen.toFixed(0),
      item.prixVenteMoyen.toFixed(0)
    ]);

    const csv &#x3D; [
      headers.join(&#x27;,&#x27;),
      ...rows.map(r &#x3D;&gt; r.join(&#x27;,&#x27;))
    ].join(&#x27;\n&#x27;);

    this.downloadFile(csv, &#x60;benefices-details-${Date.now()}.csv&#x60;);
    alert(&#x27;‚úÖ Export d√©taill√© r√©ussi !&#x27;);
  }

  private downloadFile(content: string, filename: string): void {
    const blob &#x3D; new Blob([&#x27;\ufeff&#x27; + content], { type: &#x27;text/csv;charset&#x3D;utf-8;&#x27; });
    const url &#x3D; window.URL.createObjectURL(blob);
    const a &#x3D; document.createElement(&#x27;a&#x27;);
    a.href &#x3D; url;
    a.download &#x3D; filename;
    a.click();
    window.URL.revokeObjectURL(url);
  }

  exportToPDF(): void {
    console.log(&#x27;üìÑ Export PDF en cours...&#x27;);
    window.print();
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // GRAPHIQUES - Donn√©es pour les charts
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  getChartData(): any {
    if (this.viewMode &#x3D;&#x3D;&#x3D; &#x27;global&#x27;) {
      return {
        labels: [&#x27;CA&#x27;, &#x27;Achats&#x27;, &#x27;D√©penses&#x27;, &#x27;Pertes&#x27;, &#x27;B√©n√©fice Net&#x27;],
        datasets: [{
          label: &#x27;Montants (FCFA)&#x27;,
          data: [
            this.globalStats.chiffreAffaires,
            this.globalStats.totalAchats,
            this.globalStats.totalDepenses,
            this.globalStats.totalPertes,
            this.globalStats.beneficeNet
          ],
          backgroundColor: [
            &#x27;rgba(75, 192, 192, 0.6)&#x27;,
            &#x27;rgba(255, 99, 132, 0.6)&#x27;,
            &#x27;rgba(255, 206, 86, 0.6)&#x27;,
            &#x27;rgba(255, 159, 64, 0.6)&#x27;,
            &#x27;rgba(54, 162, 235, 0.6)&#x27;
          ]
        }]
      };
    } else {
      // Top 10 boissons par b√©n√©fice
      const top10 &#x3D; this.itemStats.slice(0, 10);
      return {
        labels: top10.map(item &#x3D;&gt; item.drinkName),
        datasets: [{
          label: &#x27;B√©n√©fice (FCFA)&#x27;,
          data: top10.map(item &#x3D;&gt; item.benefice),
          backgroundColor: &#x27;rgba(54, 162, 235, 0.6)&#x27;,
          borderColor: &#x27;rgba(54, 162, 235, 1)&#x27;,
          borderWidth: 1
        }]
      };
    }
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // ANALYSE AVANC√âE
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  getTopPerformers(limit: number &#x3D; 5): ItemStats[] {
    return this.itemStats
      .filter(item &#x3D;&gt; item.benefice &gt; 0)
      .slice(0, limit);
  }

  getLowPerformers(limit: number &#x3D; 5): ItemStats[] {
    return [...this.itemStats]
      .sort((a, b) &#x3D;&gt; a.benefice - b.benefice)
      .slice(0, limit);
  }

  getMostSoldDrinks(limit: number &#x3D; 5): ItemStats[] {
    return [...this.itemStats]
      .sort((a, b) &#x3D;&gt; b.quantiteVendue - a.quantiteVendue)
      .slice(0, limit);
  }

  getHighestMarginDrinks(limit: number &#x3D; 5): ItemStats[] {
    return [...this.itemStats]
      .filter(item &#x3D;&gt; item.revenueVente &gt; 0)
      .sort((a, b) &#x3D;&gt; b.margePourcentage - a.margePourcentage)
      .slice(0, limit);
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
  // ALERTES ET RECOMMANDATIONS
  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  getAlerts(): string[] {
    const alerts: string[] &#x3D; [];

    // Alerte si b√©n√©fice net n√©gatif
    if (this.globalStats.beneficeNet &lt; 0) {
      alerts.push(&#x27;‚ö†Ô∏è B√©n√©fice net n√©gatif ! Vos co√ªts d√©passent vos revenus.&#x27;);
    }

    // Alerte si marge nette faible
    if (this.globalStats.margeNette &lt; 10 &amp;&amp; this.globalStats.margeNette &gt; 0) {
      alerts.push(&#x27;‚ö†Ô∏è Marge nette faible (&lt; 10%). Optimisez vos co√ªts.&#x27;);
    }

    // Alerte sur les pertes √©lev√©es
    if (this.globalStats.totalPertes &gt; 0) {
      const tauxPerte &#x3D; (this.globalStats.totalPertes / this.globalStats.totalAchats) * 100;
      if (tauxPerte &gt; 5) {
        alerts.push(&#x60;‚ö†Ô∏è Taux de perte √©lev√© (${tauxPerte.toFixed(1)}%). V√©rifiez la gestion du stock.&#x60;);
      }
    }

    // Alerte sur les d√©penses √©lev√©es
    if (this.globalStats.totalDepenses &gt; 0) {
      const ratioDepenses &#x3D; (this.globalStats.totalDepenses / this.globalStats.chiffreAffaires) * 100;
      if (ratioDepenses &gt; 30) {
        alerts.push(&#x60;‚ö†Ô∏è D√©penses repr√©sentent ${ratioDepenses.toFixed(1)}% du CA. Optimisation recommand√©e.&#x60;);
      }
    }

    // Alerte sur les boissons non rentables
    const nonRentables &#x3D; this.itemStats.filter(item &#x3D;&gt; item.benefice &lt; 0);
    if (nonRentables.length &gt; 0) {
      alerts.push(&#x60;‚ö†Ô∏è ${nonRentables.length} boisson(s) non rentable(s). R√©vision des prix recommand√©e.&#x60;);
    }

    return alerts;
  }

  getRecommendations(): string[] {
    const recommendations: string[] &#x3D; [];

    // Recommandation sur les best sellers
    const topSellers &#x3D; this.getMostSoldDrinks(3);
    if (topSellers.length &gt; 0) {
      recommendations.push(&#x60;‚úÖ Augmentez le stock de: ${topSellers.map(d &#x3D;&gt; d.drinkName).join(&#x27;, &#x27;)}&#x60;);
    }

    // Recommandation sur les marges √©lev√©es
    const highMargin &#x3D; this.getHighestMarginDrinks(3);
    if (highMargin.length &gt; 0) {
      recommendations.push(&#x60;üí∞ Promouvez les produits √† forte marge: ${highMargin.map(d &#x3D;&gt; d.drinkName).join(&#x27;, &#x27;)}&#x60;);
    }

    // Recommandation sur les produits peu performants
    const lowPerf &#x3D; this.getLowPerformers(3);
    if (lowPerf.length &gt; 0 &amp;&amp; lowPerf[0].benefice &lt; 0) {
      recommendations.push(&#x60;‚ùå Envisagez de retirer: ${lowPerf.map(d &#x3D;&gt; d.drinkName).join(&#x27;, &#x27;)}&#x60;);
    }

    return recommendations;
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Cave-6.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
