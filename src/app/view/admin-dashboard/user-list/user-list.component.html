<!-- ===== FICHIER: user-lists.component.html ===== -->
<!-- Template pour la liste des utilisateurs avec filtrage et pagination -->

<div class="user-lists-container">

  <!-- En-tÃªte avec titre -->
  <div class="header-section">
    <h2>ğŸ‘¥ Liste des Utilisateurs</h2>
  </div>

  <!-- Barre de recherche -->
  <div class="search-section">
    <div class="search-bar">
      <input
        type="text"
        placeholder="ğŸ” Rechercher par nom, prÃ©nom, email..."
        (input)="onSearch($any($event.target).value)"
        class="search-input">
    </div>
  </div>

  <!-- Section des filtres -->
  <div class="filters-section">
    <!-- Filtre par rÃ´le -->
    <select class="filter-select"
            (change)="onFilterChange('role', $any($event.target).value)">
      <option value="">Tous les rÃ´les</option>
      <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
    </select>

    <!-- Filtre par cave -->
    <select class="filter-select"
            (change)="onFilterChange('cave', $any($event.target).value)">
      <option value="">Toutes les caves</option>
      <option *ngFor="let cave of caves" [value]="cave">{{ cave }}</option>
    </select>

    <!-- Filtre par statut -->
    <select class="filter-select"
            (change)="onFilterChange('status', $any($event.target).value)">
      <option value="">Tous les statuts</option>
      <option value="active">ğŸŸ¢ Actif</option>
      <option value="inactive">ğŸ”´ Inactif</option>
      <option value="on-leave">ğŸŸ¡ En congÃ©</option>
    </select>

    <!-- Bouton rÃ©initialiser les filtres -->
    <button (click)="resetFilters()" class="btn btn-secondary">
      â†» RÃ©initialiser
    </button>
  </div>

  <!-- Statistiques globales (affichÃ©es si rÃ©sultats) -->
  <div class="stats-summary" *ngIf="filteredUsers.length > 0">
    <div class="stat-item">
      <span class="stat-label">ğŸ’° Ventes totales:</span>
      <span class="stat-value">{{ formatCurrency(getStatistics().totalSales) }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">â±ï¸ Heures totales:</span>
      <span class="stat-value">{{ getStatistics().totalHours }}h</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">â­ Satisfaction moyenne:</span>
      <span class="stat-value">{{ getStatistics().averageSatisfaction }}</span>
    </div>
  </div>

  <!-- Tableau des utilisateurs -->
  <div class="users-table-container">
    <table class="users-table">
      <!-- En-tÃªte du tableau -->
      <thead>
        <tr>
          <!-- Colonne PrÃ©nom (triable) -->
          <th (click)="changeSortField('firstName')" class="sortable">
            ğŸ‘¤ PrÃ©nom
            <span *ngIf="sortField === 'firstName'" class="sort-indicator">
              {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
            </span>
          </th>
          <!-- Colonne Nom (triable) -->
          <th (click)="changeSortField('lastName')" class="sortable">
            Nom
            <span *ngIf="sortField === 'lastName'" class="sort-indicator">
              {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
            </span>
          </th>
          <!-- Colonne Email -->
          <th>ğŸ“§ Email</th>
          <!-- Colonne RÃ´le (triable) -->
          <th (click)="changeSortField('role')" class="sortable">
            RÃ´le
            <span *ngIf="sortField === 'role'" class="sort-indicator">
              {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
            </span>
          </th>
          <!-- Colonne Cave -->
          <th>ğŸ¢ Cave</th>
          <!-- Colonne Statut -->
          <th>ğŸ“Š Statut</th>
          <!-- Colonne Ventes -->
          <th class="text-right">ğŸ’° Ventes</th>
          <!-- Colonne Heures -->
          <th class="text-right">â±ï¸ Heures</th>
          <!-- Colonne Actions -->
          <th>âš™ï¸ Actions</th>
        </tr>
      </thead>

      <!-- Corps du tableau -->
      <tbody>
        <!-- Boucle sur les utilisateurs filtrÃ©s et paginÃ©s -->
        <tr *ngFor="let user of filteredUsers" class="user-row">
          <!-- Colonne PrÃ©nom avec avatar -->
          <td>
            <div class="user-cell">
              <span class="avatar">{{ user.avatar }}</span>
              <span>{{ user.firstName }}</span>
            </div>
          </td>
          <!-- Colonne Nom -->
          <td>{{ user.lastName }}</td>
          <!-- Colonne Email -->
          <td>{{ user.email }}</td>
          <!-- Colonne RÃ´le -->
          <td>{{ user.role }}</td>
          <!-- Colonne Cave -->
          <td>{{ user.cave }}</td>
          <!-- Colonne Statut avec badge -->
          <td>
            <span class="badge" [ngClass]="getStatusBadgeClass(user.status)">
              {{ getStatusLabel(user.status) }}
            </span>
          </td>
          <!-- Colonne Ventes alignÃ©e Ã  droite -->
          <td class="text-right">{{ formatCurrency(user.performance.sales) }}</td>
          <!-- Colonne Heures alignÃ©e Ã  droite -->
          <td class="text-right">{{ user.performance.hours }}h</td>
          <!-- Colonne Actions -->
          <td>
            <button (click)="viewUserDetails(user)" class="btn-icon" title="Voir dÃ©tails">
              ğŸ‘ï¸
            </button>
          </td>
        </tr>

        <!-- Message si aucun rÃ©sultat -->
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="9" class="empty-message">
            ğŸ“­ Aucun utilisateur trouvÃ©
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <!-- Bouton page prÃ©cÃ©dente -->
    <button (click)="previousPage()"
            class="btn btn-secondary"
            [disabled]="currentPage === 1">
      â—€ PrÃ©cÃ©dent
    </button>

    <!-- Information de pagination -->
    <div class="page-info">
      Page {{ currentPage }} / {{ totalPages }}
    </div>

    <!-- Boutons de numÃ©ros de page -->
    <div class="page-numbers">
      <button *ngFor="let page of [].constructor(totalPages); let i = index"
              (click)="goToPage(i + 1)"
              class="btn btn-sm"
              [class.active]="currentPage === i + 1">
        {{ i + 1 }}
      </button>
    </div>

    <!-- Bouton page suivante -->
    <button (click)="nextPage()"
            class="btn btn-secondary"
            [disabled]="currentPage === totalPages">
      Suivant â–¶
    </button>
  </div>

  <!-- Modal de dÃ©tails utilisateur -->
  <div *ngIf="isDetailModalOpen && selectedUser"
       class="modal-overlay"
       (click)="closeDetailModal()">
    <!-- Contenu du modal -->
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- En-tÃªte du modal -->
      <div class="modal-header">
        <h3>ğŸ‘¤ DÃ©tails de {{ selectedUser.firstName }} {{ selectedUser.lastName }}</h3>
        <!-- Bouton fermer -->
        <button (click)="closeDetailModal()" class="close-btn">Ã—</button>
      </div>

      <!-- Corps du modal -->
      <div class="modal-body">
        <!-- DÃ©tails de l'utilisateur -->
        <div class="user-details">
          <!-- Ligne Email -->
          <div class="detail-row">
            <span class="label">ğŸ“§ Email:</span>
            <span>{{ selectedUser.email }}</span>
          </div>
          <!-- Ligne TÃ©lÃ©phone -->
          <div class="detail-row">
            <span class="label">ğŸ“± TÃ©lÃ©phone:</span>
            <span>{{ selectedUser.phone }}</span>
          </div>
          <!-- Ligne RÃ´le -->
          <div class="detail-row">
            <span class="label">ğŸ‘” RÃ´le:</span>
            <span>{{ selectedUser.role }}</span>
          </div>
          <!-- Ligne Cave -->
          <div class="detail-row">
            <span class="label">ğŸ¢ Cave:</span>
            <span>{{ selectedUser.cave }}</span>
          </div>
          <!-- Ligne Date d'embauche -->
          <div class="detail-row">
            <span class="label">ğŸ“… Date d'embauche:</span>
            <span>{{ selectedUser.joinDate }}</span>
          </div>
          <!-- Ligne Ventes -->
          <div class="detail-row">
            <span class="label">ğŸ’° Ventes totales:</span>
            <span>{{ formatCurrency(selectedUser.performance.sales) }}</span>
          </div>
          <!-- Ligne Heures -->
          <div class="detail-row">
            <span class="label">â±ï¸ Heures travaillÃ©es:</span>
            <span>{{ selectedUser.performance.hours }}h</span>
          </div>
          <!-- Ligne Satisfaction -->
          <div class="detail-row">
            <span class="label">â­ Satisfaction:</span>
            <span>{{ selectedUser.performance.satisfaction }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
