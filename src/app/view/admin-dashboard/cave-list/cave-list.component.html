<!-- ===== FICHIER: cave-lists.component.html ===== -->
<!-- Template pour l'affichage et gestion de la liste des caves -->

<div class="cave-lists-container">

  <!-- Message de feedback -->
  <div *ngIf="message"
       class="alert"
       [ngClass]="'alert-' + messageType">
    {{ message }}
  </div>

  <!-- En-tÃªte avec titre et boutons -->
  <div class="header-section">
    <h2>ğŸ· Mes Caves</h2>
    <button class="btn btn-primary" (click)="openAddCaveModal()">
      â• Ajouter une cave
    </button>
  </div>

  <!-- Barre de recherche -->
  <div class="search-section">
    <div class="search-bar">
      <input
        type="text"
        placeholder="ğŸ” Rechercher une cave par nom ou localisation..."
        [value]="filters.searchTerm"
        (input)="onSearch($any($event.target).value)"
        class="search-input">
    </div>
  </div>

  <!-- Section des filtres -->
  <div class="filters-section">
    <!-- Filtre par rÃ©gion -->
    <select class="filter-select"
            [value]="filters.location"
            (change)="onFilterChange('location', $any($event.target).value)">
      <option value="">Toutes les rÃ©gions</option>
      <option *ngFor="let region of regions" [value]="region">ğŸ“ {{ region }}</option>
    </select>

    <!-- Filtre par capacitÃ© -->
    <select class="filter-select"
            [value]="filters.capacity"
            (change)="onFilterChange('capacity', $any($event.target).value)">
      <option value="">Toutes les capacitÃ©s</option>
      <option value="small">Petite (< 200)</option>
      <option value="medium">Moyenne (200-500)</option>
      <option value="large">Grande (> 500)</option>
    </select>

    <!-- Bouton rÃ©initialiser les filtres -->
    <button (click)="resetFilters()" class="btn btn-secondary">
      â†» RÃ©initialiser
    </button>
  </div>

  <!-- Statistiques globales des caves -->
  <div class="caves-stats" *ngIf="filteredCaves.length > 0">
    <div class="stat-box">
      <span class="stat-icon">ğŸ¢</span>
      <div class="stat-info">
        <span class="stat-label">Total de caves</span>
        <span class="stat-value">{{ filteredCaves.length }}</span>
      </div>
    </div>

    <div class="stat-box">
      <span class="stat-icon">ğŸ¾</span>
      <div class="stat-info">
        <span class="stat-label">Total de bouteilles</span>
        <span class="stat-value">{{ getTotalBottles() }}</span>
      </div>
    </div>

    <div class="stat-box">
      <span class="stat-icon">ğŸ‘¥</span>
      <div class="stat-info">
        <span class="stat-label">Total de managers</span>
        <span class="stat-value">{{ getTotalManagers() }}</span>
      </div>
    </div>

    <div class="stat-box">
      <span class="stat-icon">ğŸ‘¨â€ğŸ’¼</span>
      <div class="stat-info">
        <span class="stat-label">Total d'employÃ©s</span>
        <span class="stat-value">{{ getTotalEmployees() }}</span>
      </div>
    </div>
  </div>

  <!-- Grille de cartes des caves -->
  <div class="caves-grid">
    <!-- Boucle sur chaque cave filtrÃ©e -->
    <div *ngFor="let cave of filteredCaves" class="cave-card">

      <!-- En-tÃªte de la carte -->
      <div class="cave-card-header">
        <div class="cave-title">
          <h3>{{ cave.name }}</h3>
          <p class="cave-location">ğŸ“ {{ cave.location }}</p>
        </div>
        <!-- Badge de statut -->
        <span class="productivity-badge" [ngClass]="'badge-' + getProductivityLevel(cave.productivity)">
          {{ cave.productivity }}%
        </span>
      </div>

      <!-- Description de la cave -->
      <p class="cave-description">{{ cave.description }}</p>

      <!-- Grille de statistiques -->
      <div class="stats-grid">
        <!-- Bouteilles -->
        <div class="stat-item">
          <span class="stat-label">ğŸ¾ Bouteilles</span>
          <span class="stat-value">{{ cave.bottles }}</span>
        </div>
        <!-- CapacitÃ© -->
        <div class="stat-item">
          <span class="stat-label">ğŸ“¦ CapacitÃ©</span>
          <span class="stat-value">{{ cave.capacity }}</span>
        </div>
        <!-- Managers -->
        <div class="stat-item">
          <span class="stat-label">ğŸ‘¥ Managers</span>
          <span class="stat-value">{{ cave.managersCount }}</span>
        </div>
        <!-- EmployÃ©s -->
        <div class="stat-item">
          <span class="stat-label">ğŸ‘¨â€ğŸ’¼ EmployÃ©s</span>
          <span class="stat-value">{{ cave.employeesCount }}</span>
        </div>
      </div>

      <!-- Barre de taux d'occupation -->
      <div class="occupancy-bar">
        <div class="bar-label">
          <span>Occupation</span>
          <span class="percentage">{{ getOccupancyPercentage(cave) }}%</span>
        </div>
        <div class="bar-container">
          <div class="bar-fill" [style.width.%]="getOccupancyPercentage(cave)"></div>
        </div>
      </div>

      <!-- Actions de la carte -->
      <div class="cave-card-actions">
        <!-- Bouton voir dÃ©tails -->
        <button (click)="viewCaveDetails(cave)" class="btn btn-secondary btn-sm">
          ğŸ‘ï¸ DÃ©tails
        </button>
        <!-- Bouton statistiques -->
        <button (click)="viewCaveStats(cave)" class="btn btn-secondary btn-sm">
          ğŸ“Š Stats
        </button>
        <!-- Bouton Ã©diter -->
        <button (click)="editCave(cave)" class="btn btn-primary btn-sm">
          âœï¸ Ã‰diter
        </button>
        <!-- Bouton supprimer -->
        <button (click)="deleteCave(cave.id)" class="btn btn-danger btn-sm">
          ğŸ—‘ï¸ Supprimer
        </button>
      </div>
    </div>

    <!-- Message si aucune cave trouvÃ©e -->
    <div *ngIf="filteredCaves.length === 0" class="empty-state">
      <p>ğŸœï¸ Aucune cave trouvÃ©e. CrÃ©ez-en une pour commencer !</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <!-- Bouton page prÃ©cÃ©dente -->
    <button (click)="previousPage()"
            class="btn btn-secondary"
            [disabled]="currentPage === 1">
      â—€ PrÃ©cÃ©dent
    </button>

    <!-- Info pagination -->
    <div class="page-info">
      Page {{ currentPage }} / {{ totalPages }}
    </div>

    <!-- Boutons de numÃ©ros de page -->
    <div class="page-numbers">
      <button *ngFor="let page of [].constructor(totalPages); let i = index"
              (click)="goToPage(i + 1)"
              class="btn btn-sm"
              [class.active]="currentPage === i + 1">
        {{ i + 1 }}
      </button>
    </div>

    <!-- Bouton page suivante -->
    <button (click)="nextPage()"
            class="btn btn-secondary"
            [disabled]="currentPage === totalPages">
      Suivant â–¶
    </button>
  </div>

  <!-- Modal de dÃ©tails cave -->
  <div *ngIf="isDetailModalOpen && selectedCave"
       class="modal-overlay"
       (click)="closeDetailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- En-tÃªte du modal -->
      <div class="modal-header">
        <h3>ğŸ· {{ selectedCave.name }}</h3>
        <button (click)="closeDetailModal()" class="close-btn">Ã—</button>
      </div>

      <!-- Corps du modal -->
      <div class="modal-body">
        <!-- Infos principales -->
        <div class="cave-details">
          <!-- Localisation -->
          <div class="detail-row">
            <span class="label">ğŸ“ Localisation:</span>
            <span class="value">{{ selectedCave.location }}</span>
          </div>
          <!-- Description -->
          <div class="detail-row">
            <span class="label">ğŸ“ Description:</span>
            <span class="value">{{ selectedCave.description }}</span>
          </div>
          <!-- CapacitÃ© -->
          <div class="detail-row">
            <span class="label">ğŸ“¦ CapacitÃ©:</span>
            <span class="value">{{ selectedCave.capacity }} bouteilles</span>
          </div>
          <!-- Bouteilles actuelles -->
          <div class="detail-row">
            <span class="label">ğŸ¾ Bouteilles actuelles:</span>
            <span class="value">{{ selectedCave.bottles }}</span>
          </div>
          <!-- Managers -->
          <div class="detail-row">
            <span class="label">ğŸ‘¥ Managers:</span>
            <span class="value">{{ selectedCave.managersCount }}</span>
          </div>
          <!-- EmployÃ©s -->
          <div class="detail-row">
            <span class="label">ğŸ‘¨â€ğŸ’¼ EmployÃ©s:</span>
            <span class="value">{{ selectedCave.employeesCount }}</span>
          </div>
          <!-- ProductivitÃ© -->
          <div class="detail-row">
            <span class="label">ğŸ“ˆ ProductivitÃ©:</span>
            <span class="value" [ngClass]="'value-' + getProductivityLevel(selectedCave.productivity)">
              {{ selectedCave.productivity }}%
            </span>
          </div>
          <!-- Date de crÃ©ation -->
          <div class="detail-row">
            <span class="label">ğŸ“… Date de crÃ©ation:</span>
            <span class="value">{{ selectedCave.createdDate | date: 'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal d'Ã©dition cave -->
  <div *ngIf="isEditModalOpen && selectedCave"
       class="modal-overlay"
       (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- En-tÃªte du modal -->
      <div class="modal-header">
        <h3>âœï¸ Modifier {{ selectedCave.name }}</h3>
        <button (click)="closeEditModal()" class="close-btn">Ã—</button>
      </div>

      <!-- Formulaire d'Ã©dition -->
      <div class="modal-body">
        <form (ngSubmit)="saveCaveChanges()" class="edit-form">
          <!-- Champ Nom -->
          <div class="form-group">
            <label class="form-label">Nom de la cave</label>
            <input type="text"
                   class="form-input"
                   [(ngModel)]="selectedCave.name"
                   name="name"
                   required>
          </div>

          <!-- Champ Localisation -->
          <div class="form-group">
            <label class="form-label">Localisation</label>
            <input type="text"
                   class="form-input"
                   [(ngModel)]="selectedCave.location"
                   name="location"
                   required>
          </div>

          <!-- Champ CapacitÃ© -->
          <div class="form-group">
            <label class="form-label">CapacitÃ© (bouteilles)</label>
            <input type="number"
                   class="form-input"
                   [(ngModel)]="selectedCave.capacity"
                   name="capacity"
                   min="1"
                   required>
          </div>

          <!-- Champ Description -->
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea"
                      [(ngModel)]="selectedCave.description"
                      name="description"
                      rows="4"
                      required></textarea>
          </div>

          <!-- Boutons -->
          <div class="form-actions">
            <button type="button" (click)="closeEditModal()" class="btn btn-secondary">
              âœ• Annuler
            </button>
            <button type="submit" class="btn btn-primary">
              ğŸ’¾ Enregistrer
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
