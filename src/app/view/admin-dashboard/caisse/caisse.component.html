<div class="caisse-container">
  <!-- ===== EN-TÃŠTE ===== -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">ğŸ’° Gestion des Caisses</h1>
        <p class="page-subtitle">Supervision en temps rÃ©el de toutes les caisses</p>
      </div>
      <div class="header-actions">
        <button class="action-btn action-btn-primary" (click)="exporterRapport()">
          <span class="btn-icon">ğŸ“Š</span>
          <span class="btn-text">Exporter Rapport</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ===== SÃ‰LECTION DE DATE ===== -->
  <section class="date-section">
    <div class="date-selector-card">
      <label for="dateSelect" class="date-label">
        <span class="date-icon">ğŸ“…</span>
        <span>Date de consultation:</span>
      </label>
      <input
        type="date"
        id="dateSelect"
        [(ngModel)]="selectedDate"
        class="date-input">
      <div class="date-info">
        <span class="info-icon">â„¹ï¸</span>
        <span class="info-text">Mise Ã  jour: {{statistiquesManager.derniereMaj}}</span>
      </div>
    </div>
  </section>

  <!-- ===== VUE RÃ‰SUMÃ‰ GLOBAL ===== -->
  <section class="view-toggle-section">
    <div class="view-toggle">
      <button
        class="toggle-btn"
        [class.active]="currentView === 'resume'"
        (click)="switchView('resume')">
        <span class="toggle-icon">ğŸ“Š</span>
        <span>Vue RÃ©sumÃ©</span>
      </button>
      <button
        class="toggle-btn"
        [class.active]="currentView === 'details'"
        (click)="switchView('details')">
        <span class="toggle-icon">ğŸ”</span>
        <span>Vue DÃ©taillÃ©e</span>
      </button>
    </div>
  </section>

  <!-- ===== VUE RÃ‰SUMÃ‰ ===== -->
  <div *ngIf="currentView === 'resume'" class="resume-view">
    <!-- Statistiques Globales -->
    <section class="global-stats-section">
      <h2 class="section-title">
        <span class="title-icon">ğŸŒ</span>
        Statistiques Globales
      </h2>

      <div class="global-stats-grid">
        <div class="global-stat-card global-stat-total">
          <div class="stat-icon-wrapper">
            <span class="stat-icon">ğŸ’°</span>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total Toutes Caisses</div>
            <div class="stat-value">{{formatMontant(totalGlobal)}}</div>
            <div class="stat-detail">{{statistiquesGlobales.length}} caisses actives</div>
          </div>
        </div>

        <div class="global-stat-card global-stat-especes">
          <div class="stat-icon-wrapper">
            <span class="stat-icon">ğŸ’µ</span>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total EspÃ¨ces</div>
            <div class="stat-value">{{formatMontant(totalEspecesGlobal)}}</div>
            <div class="stat-detail">Toutes caisses confondues</div>
          </div>
        </div>

        <div class="global-stat-card global-stat-carte">
          <div class="stat-icon-wrapper">
            <span class="stat-icon">ğŸ’³</span>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total Wave</div>
            <div class="stat-value">{{formatMontant(totalWaveGlobal)}}</div>
            <div class="stat-detail">Paiements Ã©lectroniques</div>
          </div>
        </div>

        <div class="global-stat-card global-stat-mobile">
          <div class="stat-icon-wrapper">
            <span class="stat-icon">ğŸ“±</span>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total Mobile</div>
            <div class="stat-value">{{formatMontant(totalMobileGlobal)}}</div>
            <div class="stat-detail">Paiements mobiles</div>
          </div>
        </div>
      </div>
    </section>

    <!-- RÃ©sumÃ© par Manager -->
    <section class="managers-summary-section">
      <h2 class="section-title">
        <span class="title-icon">ğŸ‘¥</span>
        RÃ©sumÃ© par Manager
      </h2>

      <div class="managers-grid">
                  <div
          *ngFor="let stat of statistiquesGlobales"
          class="manager-summary-card"
          [class.card-selected]="selectedManagerId === stat.managerId"
          (click)="selectManager(stat.managerId)">

          <div class="manager-card-header">
            <div class="manager-avatar">
              {{getManagerAvatar(stat.managerId)}}
              <div class="status-dot" [ngClass]="'status-' + getManagerStatut(stat.managerId)"></div>
            </div>
            <div class="manager-info">
              <h3 class="manager-name">{{stat.managerNom}}</h3>
              <p class="manager-cave">{{stat.cave}}</p>
            </div>
          </div>

          <div class="manager-card-body">
            <div class="summary-stat">
              <span class="summary-label">Total du jour</span>
              <span class="summary-value summary-value-total">{{formatMontant(stat.totalJour)}}</span>
            </div>

            <div class="summary-stats-grid">
              <div class="mini-stat">
                <span class="mini-icon">ğŸ’µ</span>
                <div class="mini-content">
                  <span class="mini-label">EspÃ¨ces</span>
                  <span class="mini-value">{{formatMontant(stat.especes)}}</span>
                </div>
              </div>

              <div class="mini-stat">
                <span class="mini-icon">ğŸ’³</span>
                <div class="mini-content">
                  <span class="mini-label">Wave</span>
                  <span class="mini-value">{{formatMontant(stat.Wave)}}</span>
                </div>
              </div>

              <div class="mini-stat">
                <span class="mini-icon">ğŸ“±</span>
                <div class="mini-content">
                  <span class="mini-label">Mobile</span>
                  <span class="mini-value">{{formatMontant(stat.mobile)}}</span>
                </div>
              </div>

              <div class="mini-stat">
                <span class="mini-icon">ğŸ§¾</span>
                <div class="mini-content">
                  <span class="mini-label">Transactions</span>
                  <span class="mini-value">{{stat.nombreTransactions}}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="manager-card-footer">
            <button class="card-action-btn" (click)="switchView('details'); $event.stopPropagation()">
              <span>Voir dÃ©tails</span>
              <span>â†’</span>
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- ===== VUE DÃ‰TAILLÃ‰E ===== -->
  <div *ngIf="currentView === 'details'" class="details-view">
    <!-- SÃ©lection du Manager -->
    <section class="manager-selection-section">
      <h2 class="section-title">
        <span class="title-icon">ğŸ‘¤</span>
        SÃ©lectionner un Manager
      </h2>

      <div class="manager-tabs">
        <button
          *ngFor="let manager of managersData"
          class="manager-tab"
          [class.active]="selectedManagerId === manager.id"
          (click)="selectManager(manager.id)">
          <div class="tab-avatar">
            {{manager.avatar}}
            <div class="status-indicator" [class]="'status-' + manager.statut"></div>
          </div>
          <div class="tab-content">
            <div class="tab-name">{{manager.nom}}</div>
            <div class="tab-cave">{{manager.cave}}</div>
          </div>
        </button>
      </div>
    </section>

    <!-- Informations Manager SÃ©lectionnÃ© -->
    <section class="selected-manager-info" *ngIf="selectedManager">
      <div class="info-card">
        <div class="info-header">
          <div class="info-avatar-large">
            {{selectedManager.avatar}}
          </div>
          <div class="info-details">
            <h3 class="info-name">{{selectedManager.nom}}</h3>
            <p class="info-cave">ğŸ¢ {{selectedManager.cave}}</p>
            <p class="info-adresse">ğŸ“ {{selectedManager.caveAdresse}}</p>
          </div>
          <div class="info-actions">
            <button class="info-action-btn" (click)="envoyerNotification(selectedManager.id)">
              <span>ğŸ“§</span>
              <span>Notifier</span>
            </button>
            <button class="info-action-btn btn-danger" (click)="fermerCaisse(selectedManager.id)">
              <span>ğŸ”’</span>
              <span>Fermer caisse</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Statistiques du Manager -->
    <section class="manager-stats-section">
      <h2 class="section-title">
        <span class="title-icon">ğŸ“Š</span>
        Statistiques de Caisse
      </h2>

      <div class="stats-grid">
        <div class="stat-card stat-card-total">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-content">
            <div class="stat-label">Total du Jour</div>
            <div class="stat-value">{{formatMontant(statistiquesManager.totalJour)}}</div>
            <div class="stat-transactions">{{statistiquesManager.nombreTransactions}} transactions</div>
          </div>
        </div>

        <div class="stat-card stat-card-especes">
          <div class="stat-icon">ğŸ’µ</div>
          <div class="stat-content">
            <div class="stat-label">EspÃ¨ces</div>
            <div class="stat-value">{{formatMontant(statistiquesManager.especes)}}</div>
          </div>
        </div>

        <div class="stat-card stat-card-carte">
          <div class="stat-icon">ğŸ’³</div>
          <div class="stat-content">
            <div class="stat-label">Wave</div>
            <div class="stat-value">{{formatMontant(statistiquesManager.wave)}}</div>
          </div>
        </div>

        <div class="stat-card stat-card-mobile">
          <div class="stat-icon">ğŸ“±</div>
          <div class="stat-content">
            <div class="stat-label">Paiement Mobile</div>
            <div class="stat-value">{{formatMontant(statistiquesManager.mobile)}}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Filtres des Transactions -->
    <section class="transactions-filters-section">
      <h3 class="filter-title">Filtrer par type</h3>
      <div class="transaction-tabs">
        <button
          class="transaction-tab"
          [class.active]="currentTransactionFilter === 'all'"
          (click)="filterTransactions('all')">
          Toutes ({{getTransactionCount('all')}})
        </button>
        <button
          class="transaction-tab"
          [class.active]="currentTransactionFilter === 'vente'"
          (click)="filterTransactions('vente')">
          Ventes ({{getTransactionCount('vente')}})
        </button>
        <button
          class="transaction-tab"
          [class.active]="currentTransactionFilter === 'remboursement'"
          (click)="filterTransactions('remboursement')">
          Remboursements ({{getTransactionCount('remboursement')}})
        </button>
        <button
          class="transaction-tab"
          [class.active]="currentTransactionFilter === 'ouverture'"
          (click)="filterTransactions('ouverture')">
          Ouverture/Fermeture ({{getTransactionCount('ouverture') + getTransactionCount('fermeture')}})
        </button>
      </div>
    </section>

    <!-- Liste des Transactions -->
    <section class="transactions-list-section">
      <h2 class="section-title">
        <span class="title-icon">ğŸ“</span>
        Transactions de la JournÃ©e
      </h2>

      <div class="transactions-container">
        <div *ngIf="filteredTransactions.length === 0" class="empty-state">
          <div class="empty-icon">ğŸ’°</div>
          <p class="empty-text">Aucune transaction pour cette pÃ©riode</p>
        </div>

        <div class="transaction-item" *ngFor="let transaction of filteredTransactions">
          <div class="transaction-header">
            <div class="transaction-icon" [class]="'transaction-' + transaction.type">
              <span *ngIf="transaction.type === 'vente'">ğŸ›’</span>
              <span *ngIf="transaction.type === 'remboursement'">â†©ï¸</span>
              <span *ngIf="transaction.type === 'ouverture'">ğŸ”“</span>
              <span *ngIf="transaction.type === 'fermeture'">ğŸ”’</span>
            </div>

            <div class="transaction-info">
              <div class="transaction-type-row">
                <span class="transaction-type-badge" [class]="'type-badge-' + transaction.type">
                  {{transaction.typeText}}
                </span>
                <span class="transaction-id">{{transaction.id}}</span>
              </div>
              <div class="transaction-datetime">{{transaction.date}} Ã  {{transaction.heure}}</div>
            </div>

            <div class="transaction-amount"
                 [class.amount-positive]="transaction.montant > 0"
                 [class.amount-negative]="transaction.montant < 0">
              {{transaction.montant > 0 ? '+' : ''}}{{formatMontant(transaction.montant)}}
            </div>
          </div>

          <div class="transaction-body">
            <div class="transaction-detail-row" *ngIf="transaction.client">
              <span class="detail-icon">ğŸ‘¤</span>
              <span class="detail-text">Client: {{transaction.client}}</span>
            </div>
            <div class="transaction-detail-row">
              <span class="detail-icon">ğŸ’³</span>
              <span class="detail-text">{{transaction.moyenPaiementText}}</span>
            </div>
            <div class="transaction-detail-row" *ngIf="transaction.reference">
              <span class="detail-icon">ğŸ“</span>
              <span class="detail-text">RÃ©f: {{transaction.reference}}</span>
            </div>
            <div class="transaction-detail-row">
              <span class="detail-icon">ğŸ‘¨â€ğŸ’¼</span>
              <span class="detail-text">Caissier: {{transaction.caissier}}</span>
            </div>
            <div class="transaction-details-text">
              {{transaction.details}}
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
