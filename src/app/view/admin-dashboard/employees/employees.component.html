<!-- ===== PAGE MES EMPLOYÃ‰S ===== -->
<div class="page-section">

  <section class="content-section">

    <!-- ===== En-tÃªte de page ===== -->
    <div class="section-header">
      <h2 class="section-title-main">ğŸ‘¨â€ğŸ’¼ Mes EmployÃ©s</h2>
      <button class="btn btn-primary" (click)="openAddEmployeeModal()">
        â• Ajouter un employÃ©
      </button>
    </div>

    <!-- ===== Statistiques globales ===== -->
    <div class="employees-stats-grid">

      <!-- Total EmployÃ©s -->
      <div class="stat-card stat-card-blue">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <div class="stat-label">Total EmployÃ©s</div>
          <div class="stat-value">{{ getTotalEmployeesCount() }}</div>
          <div class="stat-change positive">+5 ce mois</div>
        </div>
      </div>

      <!-- EmployÃ©s PrÃ©sents -->
      <div class="stat-card stat-card-green">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <div class="stat-label">PrÃ©sents Aujourd'hui</div>
          <div class="stat-value">{{ getPresentEmployeesCount() }}</div>
          <div class="stat-change positive">En service</div>
        </div>
      </div>

      <!-- EmployÃ©s Absents -->
      <div class="stat-card stat-card-red">
        <div class="stat-icon">âŒ</div>
        <div class="stat-content">
          <div class="stat-label">Absents</div>
          <div class="stat-value">{{ getAbsentEmployeesCount() }}</div>
          <div class="stat-change negative">Aujourd'hui</div>
        </div>
      </div>

      <!-- En CongÃ© -->
      <div class="stat-card stat-card-orange">
        <div class="stat-icon">ğŸ–ï¸</div>
        <div class="stat-content">
          <div class="stat-label">En CongÃ©</div>
          <div class="stat-value">{{ getOnLeaveEmployeesCount() }}</div>
          <div class="stat-change neutral">Actuellement</div>
        </div>
      </div>
    </div>

    <!-- ===== Tableau des employÃ©s ===== -->
    <div class="employees-table">

      <div class="table-header">
        <h3>Liste complÃ¨te des employÃ©s</h3>
      </div>

        <div class="table-column-headers">
            <div>Nom et poste</div>
            <div>DisponibilitÃ©</div>
            <div>ArrivÃ©e</div>
            <div>DÃ©part</div>
            <div>Revenus total</div>
            <div>Heures eff</div>
            <div>Options</div>

        </div>

    <div class="table-content">

    <!-- Boucle sur chaque employÃ© -->
    <div *ngFor="let employee of getAllEmployees()" class="employee-row">

      <!-- Colonne 1: Avatar + Nom et poste -->
      <div class="employee-info-wrapper">
        <div class="employee-info">
          <div class="employee-avatar-sm">
            {{ employee.avatar }}
            <span class="status-indicator"
                  [ngClass]="{
                    'present': employee.availability.status === 'prÃ©sent',
                    'absent': employee.availability.status === 'absent',
                    'leave': employee.availability.status === 'congÃ©'
                  }">
            </span>
          </div>
          <div class="employee-details">
            <div class="employee-name-bold">{{ employee.name }}</div>
            <div class="employee-position-sm">{{ employee.position }}</div>
          </div>
        </div>
      </div>

      <!-- Colonne 2: Badge de disponibilitÃ© -->
      <div class="availability-badge" [ngClass]="getStatusClass(employee.availability.status)">
        <span class="status-icon">{{ getStatusIcon(employee.availability.status) }}</span>
        <span class="status-text">{{ employee.availability.status | titlecase }}</span>
      </div>

                <!-- Colonne 3: ArrivÃ©e -->
      <div class="info-badge-cell">
            <span class="info-badge" *ngIf="employee.availability.status === 'prÃ©sent'; else dashArrivee">
              ğŸ• {{ employee.availability.heureArrivee }}
            </span>
            <ng-template #dashArrivee>
              <span class="info-badge">-</span>
            </ng-template>
      </div>

          <!-- Colonne 4: DÃ©part -->
      <div class="info-badge-cell">
            <span class="info-badge" *ngIf="employee.availability.status === 'prÃ©sent' && employee.availability.heureDepart; else dashDepart">
              ğŸ• {{ employee.availability.heureDepart }}
            </span>
            <ng-template #dashDepart>
              <span class="info-badge">-</span>
            </ng-template>
      </div>

      <!-- Colonne 5: Rev. total -->
      <div class="info-badge-cell">
        <span class="info-badge">
          ğŸ’° {{ employee.ventes }}
        </span>
      </div>

      <!-- Colonne 6: Heures -->
      <div class="info-badge-cell">
        <span class="info-badge">
          â±ï¸ {{ employee.heures }}
        </span>
      </div>


        <!-- Actions sous l'avatar -->
        <div class="employee-row-actions">
          <button class="btn-icon btn-view"
                  title="Voir le profil"
                  (click)="viewEmployeeDetails(employee)">
            ğŸ‘ï¸
          </button>

          <button class="btn-icon btn-history"
                  title="Voir l'historique"
                  (click)="viewAvailabilityHistory(employee)">
            ğŸ“Š
          </button>

          <button class="btn-icon btn-edit"
                  title="Modifier"
                  (click)="editEmployee(employee)">
            âœï¸
          </button>

          <button class="btn-icon btn-danger"
                  title="Supprimer"
                  (click)="deleteEmployee(employee)">
            ğŸ—‘ï¸
          </button>
        </div>

    </div>

        <!-- Message si aucun employÃ© -->
        <div *ngIf="getAllEmployees().length === 0" class="empty-state">
          <div class="empty-icon">ğŸ“­</div>
          <p>Aucun employÃ© pour le moment</p>
          <button class="btn btn-primary" (click)="openAddEmployeeModal()">
            Ajouter le premier employÃ©
          </button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- ===== MODAL AJOUTER EMPLOYÃ‰ ===== -->
<div *ngIf="isAddEmployeeModalOpen" class="modal" (click)="closeAddEmployeeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">â• Ajouter un nouvel employÃ©</h2>
      <button class="close-btn" (click)="closeAddEmployeeModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label class="form-label">PrÃ©nom *</label>
          <input type="text" class="form-input" [(ngModel)]="newEmployeeForm.firstName"
                 name="firstName" placeholder="Ex: Alice" required>
        </div>

        <div class="form-group">
          <label class="form-label">Nom *</label>
          <input type="text" class="form-input" [(ngModel)]="newEmployeeForm.lastName"
                 name="lastName" placeholder="Ex: Martin" required>
        </div>

        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" [(ngModel)]="newEmployeeForm.email"
                 name="email" placeholder="Ex: alice.martin@caveviking.com" required>
        </div>

        <div class="form-group">
          <label class="form-label">TÃ©lÃ©phone</label>
          <input type="tel" class="form-input" [(ngModel)]="newEmployeeForm.phone"
                 name="phone" placeholder="Ex: +234 801 234 5678">
        </div>

        <div class="form-group">
          <label class="form-label">Cave d'affectation *</label>
          <select class="form-input" [(ngModel)]="newEmployeeForm.caveId" name="caveId" required>
            <option value="">SÃ©lectionner une cave...</option>
            <option *ngFor="let cave of caves" [value]="cave.id">{{ cave.name }}</option>
          </select>
        </div>

        <div class="form-group" *ngIf="newEmployeeForm.caveId">
          <label class="form-label">Manager de supervision *</label>
          <select class="form-input" [(ngModel)]="newEmployeeForm.managerId" name="managerId" required>
            <option value="">SÃ©lectionner un manager...</option>
            <option *ngFor="let manager of getManagersByCave(newEmployeeForm.caveId)"
                    [value]="manager.name">
              {{ manager.name }} - {{ manager.role }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Poste *</label>
          <select class="form-input" [(ngModel)]="newEmployeeForm.position" name="position" required>
            <option value="">SÃ©lectionner un poste...</option>
            <option value="Caissier(Ã¨re)">Caissier(Ã¨re)</option>
            <option value="Vendeur(se)">Vendeur(se)</option>
            <option value="Magasinier">Magasinier</option>
            <option value="Livreur">Livreur</option>
            <option value="Assistant(e)">Assistant(e)</option>
            <option value="Sommelier">Sommelier</option>
            <option value="Conseiller(Ã¨re)">Conseiller(Ã¨re)</option>
          </select>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="closeAddEmployeeModal()">Annuler</button>
      <button class="btn btn-primary" (click)="addNewEmployee()">Ajouter l'employÃ©</button>
    </div>
  </div>
</div>

<!-- ===== MODAL VOIR PROFIL COMPLET ===== -->
<div *ngIf="isViewDetailsModalOpen && selectedEmployee" class="modal" (click)="closeDetailsModal()">
  <div class="modal-content modal-content-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">ğŸ‘¤ Profil de {{ selectedEmployee.name }}</h2>
      <button class="close-btn" (click)="closeDetailsModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <!-- RÃ©sumÃ© du profil -->
      <div class="profile-summary">
        <div class="profile-avatar-large">{{ selectedEmployee.avatar }}</div>
        <div class="profile-info">
          <h3>{{ selectedEmployee.name }}</h3>
          <p class="profile-position">{{ selectedEmployee.position }}</p>
          <div class="availability-badge-large" [ngClass]="getStatusClass(selectedEmployee.availability.status)">
            {{ getStatusIcon(selectedEmployee.availability.status) }}
            {{ selectedEmployee.availability.status | titlecase }}
          </div>
        </div>
      </div>

      <!-- Informations personnelles -->
      <div class="info-section">
        <h4 class="section-subtitle">ğŸ“‹ Informations Personnelles</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Email:</span>
            <span class="info-value">{{ selectedEmployee.email }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">TÃ©lÃ©phone:</span>
            <span class="info-value">{{ selectedEmployee.phone }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Poste:</span>
            <span class="info-value">{{ selectedEmployee.position }}</span>
          </div>
           <div class="info-item">
            <span class="info-label">Cave d'affectation:</span>
            <span class="info-value">{{ selectedEmployee.caveId || 'Non assignÃ©e' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Manager de supervision:</span>
            <span class="info-value">{{ selectedEmployee.managerId || 'Non assignÃ©' }}</span>
          </div>
        </div>
      </div>

      <!-- DisponibilitÃ© actuelle -->
      <div class="info-section">
        <h4 class="section-subtitle">â° DisponibilitÃ© Actuelle</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Statut:</span>
            <span class="info-value" [ngClass]="getStatusClass(selectedEmployee.availability.status)">
              {{ selectedEmployee.availability.status | titlecase }}
            </span>
          </div>
          <div class="info-item" *ngIf="selectedEmployee.availability.heureArrivee">
            <span class="info-label">Heure d'arrivÃ©e:</span>
            <span class="info-value">{{ selectedEmployee.availability.heureArrivee }}</span>
          </div>
          <div class="info-item" *ngIf="selectedEmployee.availability.heureDepart">
            <span class="info-label">Heure de dÃ©part:</span>
            <span class="info-value">{{ selectedEmployee.availability.heureDepart }}</span>
          </div>
        </div>
      </div>

      <!-- Performance -->
      <div class="info-section">
        <h4 class="section-subtitle">ğŸ“Š Performance</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Ventes totales:</span>
            <span class="info-value">{{ selectedEmployee.ventes }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Heures travaillÃ©es:</span>
            <span class="info-value">{{ selectedEmployee.heures }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="viewAvailabilityHistory(selectedEmployee)">
        ğŸ“Š Voir l'historique
      </button>
      <button class="btn btn-primary" (click)="editEmployee(selectedEmployee); closeDetailsModal()">
        âœï¸ Modifier le profil
      </button>
    </div>
  </div>
</div>
<!-- ===== MODAL HISTORIQUE DE DISPONIBILITÃ‰ ===== -->
<div *ngIf="isViewHistoryModalOpen && selectedEmployee" class="modal" (click)="closeHistoryModal()">
  <div class="modal-content modal-content-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">ğŸ“Š Historique de {{ selectedEmployee.name }}</h2>
      <button class="close-btn" (click)="closeHistoryModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <!-- Statistiques rÃ©sumÃ©es -->
      <div class="history-stats">
        <div class="history-stat-card">
          <div class="stat-icon-small">âœ…</div>
          <div class="stat-content-small">
            <div class="stat-value-small">
              {{ getHistoryPresentDays(selectedEmployee) }}
            </div>
            <div class="stat-label-small">Jours prÃ©sents</div>
          </div>
        </div>

        <div class="history-stat-card">
          <div class="stat-icon-small">âŒ</div>
          <div class="stat-content-small">
            <div class="stat-value-small">
              {{ getHistoryAbsentDays(selectedEmployee) }}
            </div>
            <div class="stat-label-small">Jours absents</div>
          </div>
        </div>

        <div class="history-stat-card">
          <div class="stat-icon-small">ğŸ–ï¸</div>
          <div class="stat-content-small">
            <div class="stat-value-small">
             {{ getHistoryLeaveDays(selectedEmployee) }}
            </div>
            <div class="stat-label-small">Jours de congÃ©</div>
          </div>
        </div>
      </div>

      <!-- Tableau d'historique -->
      <div class="history-table">
        <div class="history-table-header">
          <h4>Historique des 30 derniers jours</h4>
        </div>

        <div class="history-table-content">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Statut</th>
                <th>ArrivÃ©e</th>
                <th>DÃ©part</th>
                <th>DurÃ©e</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of selectedEmployee.availabilityHistory"
                  [ngClass]="'row-' + record.status">
                <td class="date-cell">{{ record.date }}</td>
                <td>
                  <span class="status-badge-small" [ngClass]="getStatusClass(record.status)">
                    {{ getStatusIcon(record.status) }} {{ record.status | titlecase }}
                  </span>
                </td>
                <td class="time-cell">{{ record.heureArrivee || '-' }}</td>
                <td class="time-cell">{{ record.heureDepart || '-' }}</td>
                <td class="duration-cell">{{ record.duree || '-' }}</td>
              </tr>
            </tbody>
          </table>

          <!-- Message si pas d'historique -->
          <div *ngIf="selectedEmployee.availabilityHistory.length === 0" class="empty-history">
            <p>Aucun historique disponible pour cet employÃ©</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeHistoryModal()">Fermer</button>
      <button class="btn btn-primary" (click)="closeHistoryModal(); editEmployee(selectedEmployee)">
        âœï¸ Modifier le profil
      </button>
    </div>
  </div>
</div>

<!-- ===== MODAL MODIFIER EMPLOYÃ‰ ===== -->
<div *ngIf="isEditEmployeeModalOpen && editEmployeeForm" class="modal" (click)="closeEditEmployeeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">âœï¸ Modifier l'employÃ©</h2>
      <button class="close-btn" (click)="closeEditEmployeeModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label class="form-label">PrÃ©nom *</label>
          <input type="text" class="form-input" [(ngModel)]="editEmployeeForm.firstName"
                 name="firstName" required>
        </div>

        <div class="form-group">
          <label class="form-label">Nom *</label>
          <input type="text" class="form-input" [(ngModel)]="editEmployeeForm.lastName"
                 name="lastName" required>
        </div>

        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" [(ngModel)]="editEmployeeForm.email"
                 name="email" required>
        </div>

        <div class="form-group">
          <label class="form-label">TÃ©lÃ©phone</label>
          <input type="tel" class="form-input" [(ngModel)]="editEmployeeForm.phone"
                 name="phone">
        </div>

        <div class="form-group">
          <label class="form-label">Cave d'affectation *</label>
          <select class="form-input" [(ngModel)]="editEmployeeForm.caveId" name="caveId" required>
            <option value="">SÃ©lectionner une cave...</option>
            <option *ngFor="let cave of caves" [value]="cave.id">{{ cave.name }}</option>
          </select>
        </div>

        <div class="form-group" *ngIf="editEmployeeForm.caveId">
          <label class="form-label">Manager de supervision *</label>
          <select class="form-input" [(ngModel)]="editEmployeeForm.managerId" name="managerId" required>
            <option value="">SÃ©lectionner un manager...</option>
            <option *ngFor="let manager of getManagersByCave(editEmployeeForm.caveId)"
                    [value]="manager.name">
              {{ manager.name }} - {{ manager.role }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Poste *</label>
          <select class="form-input" [(ngModel)]="editEmployeeForm.position" name="position" required>
            <option value="Caissier(Ã¨re)">Caissier(Ã¨re)</option>
            <option value="Vendeur(se)">Vendeur(se)</option>
            <option value="Magasinier">Magasinier</option>
            <option value="Livreur">Livreur</option>
            <option value="Assistant(e)">Assistant(e)</option>
            <option value="Sommelier">Sommelier</option>
            <option value="Conseiller(Ã¨re)">Conseiller(Ã¨re)</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Statut de disponibilitÃ©</label>
          <select class="form-input" [(ngModel)]="editEmployeeForm.availability.status" name="status">
            <option value="prÃ©sent">âœ… PrÃ©sent</option>
            <option value="absent">âŒ Absent</option>
            <option value="congÃ©">ğŸ–ï¸ En CongÃ©</option>
          </select>
        </div>

        <div class="form-group" *ngIf="editEmployeeForm.availability.status === 'prÃ©sent'">
          <label class="form-label">Heure d'arrivÃ©e</label>
          <input type="time" class="form-input" [(ngModel)]="editEmployeeForm.availability.heureArrivee"
                 name="heureArrivee">
        </div>

        <div class="form-group" *ngIf="editEmployeeForm.availability.status === 'prÃ©sent'">
          <label class="form-label">Heure de dÃ©part</label>
          <input type="time" class="form-input" [(ngModel)]="editEmployeeForm.availability.heureDepart"
                 name="heureDepart">
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="closeEditEmployeeModal()">Annuler</button>
      <button class="btn btn-primary" (click)="saveEmployeeChanges()">
        ğŸ’¾ Enregistrer les modifications
      </button>
    </div>
  </div>
</div>



