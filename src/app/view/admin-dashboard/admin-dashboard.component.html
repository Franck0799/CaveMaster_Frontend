<!-- ===== CONTENEUR PRINCIPAL ===== -->
<!-- Plus besoin de <!DOCTYPE html>, <head>, <body> dans Angular -->
<body>
    <div class="dashboard">
        <!-- ===== SIDEBAR (MENU LAT√âRAL) ===== -->
        <aside class="sidebar">
            <!-- Logo en haut -->
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üçæ</span>
                    <span class="logo-text">VIKINGS</span>
                </div>
            </div>

            <!-- Navigation principale -->
            <nav class="sidebar-section">
                <!-- (click) √©coute l'√©v√©nement de clic et appelle la m√©thode navigateTo -->
                <!-- [class.active] ajoute la classe 'active' si la condition est vraie -->
                <div
                    class="nav-item"
                    [class.active]="currentPage === 'home'"
                    (click)="navigateTo('home')">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Accueil</span>
                </div>

                <!-- Navigation vers Mes caves -->
                <div
                    class="nav-item"
                    [class.active]="currentPage === 'caves'"
                    (click)="navigateTo('caves')">
                    <span class="nav-icon">üç∑</span>
                    <span class="nav-text">Mes caves</span>
                </div>
            </nav>

            <div class="divider"></div>

            <!-- Section MA CAVE -->
            <nav class="sidebar-section">
                <div class="section-title">MA CAVE</div>

                <!-- Mes boissons avec sous-menu -->
                <!-- $event est l'objet √©v√©nement JavaScript natif -->
                <div class="nav-item" (click)="toggleSubmenu($event)">
                    <span class="nav-icon">üçæ</span>
                    <span class="nav-text">Mes boissons</span>
                    <!-- [style.transform] lie dynamiquement le style CSS transform -->
                    <!-- L'op√©rateur ternaire ? : choisit entre deux valeurs selon une condition -->
                    <span
                        class="submenu-arrow"
                        [style.transform]="submenuOpen ? 'rotate(90deg)' : 'rotate(0deg)'">
                        ‚ñ∂
                    </span>
                </div>

                <!-- Sous-menu des cat√©gories de boissons -->
                <!-- [class.open] ajoute la classe 'open' si submenuOpen est true -->
                <div class="submenu" [class.open]="submenuOpen">
                    <!-- *ngFor r√©p√®te cet √©l√©ment pour chaque cat√©gorie -->
                    <!-- 'let category of drinkCategories' cr√©e une variable locale 'category' -->
                    <div class="submenu-item" *ngFor="let category of drinkCategories">
                        {{ category.icon }} {{ category.name }}
                    </div>
                </div>

                <!-- Autres items de la cave -->
                <div class="nav-item">
                    <span class="nav-icon">üì•</span>
                    <span class="nav-text">Mes entr√©es</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üì§</span>
                    <span class="nav-text">Mes sorties</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üçΩÔ∏è</span>
                    <span class="nav-text">Mets & Vins</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Mes managers</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üë®‚Äçüíº</span>
                    <span class="nav-text">Mes employ√©s</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üì∑</span>
                    <span class="nav-text">Scan</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-text">Mon compte</span>
                </div>
            </nav>

            <div class="divider"></div>

            <!-- Section INFOS -->
            <nav class="sidebar-section">
                <div class="section-title">INFOS</div>

                <div class="nav-item">
                    <span class="nav-icon">‚ùì</span>
                    <span class="nav-text">FAQ</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Notes am√©liorations</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üìß</span>
                    <span class="nav-text">Nous contacter</span>
                </div>

                <div class="nav-item">
                    <span class="nav-icon">üìö</span>
                    <span class="nav-text">En savoir plus</span>
                </div>
            </nav>

            <div class="divider"></div>

            <!-- R√©seaux sociaux -->
            <div class="sidebar-section">
                <div class="section-title">SUIVEZ-NOUS</div>
                <div class="social-links">
                    <!-- *ngFor cr√©e un lien pour chaque r√©seau social -->
                    <!-- [title] lie l'attribut HTML title √† la propri√©t√© social.name -->
                    <div
                        class="social-link"
                        *ngFor="let social of socialLinks"
                        [title]="social.name">
                        {{ social.icon }}
                    </div>
                </div>
            </div>
        </aside>

        <!-- ===== CONTENU PRINCIPAL ===== -->
        <main class="main-content">
            <!-- ===== EN-T√äTE DU HAUT ===== -->
            <header class="top-header">
                <!-- Barre de recherche √† gauche -->
                <div class="header-left">
                    <div class="search-bar">
                        <!-- [(ngModel)] cr√©e un two-way binding (liaison bidirectionnelle) -->
                        <!-- Les changements dans l'input mettent √† jour searchQuery -->
                        <!-- Les changements de searchQuery mettent √† jour l'input -->
                        <input
                            type="text"
                            placeholder="Rechercher un vin mill√©sime, une cave..."
                            [(ngModel)]="searchQuery"
                            (input)="onSearch()">
                        <button class="search-btn" (click)="onSearch()">üîç</button>
                    </div>
                </div>

                <!-- √âl√©ments √† droite -->
                <div class="header-right">
                    <!-- S√©lecteur de cat√©gories -->
                    <div class="category-selector">
                        <!-- [(ngModel)] sur un select lie la valeur s√©lectionn√©e -->
                        <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
                            <option value="">Toutes les cat√©gories</option>
                            <!-- *ngFor cr√©e une option pour chaque cat√©gorie -->
                            <!-- [value] lie l'attribut value √† cat.value -->

                            <option *ngFor="let cat of categories" [value]="cat.value">
                                {{ cat.label }}
                            </option>
                        </select>
                    </div>

                    <!-- Ic√¥ne panier avec badge -->
                    <div class="header-icon" (click)="openCart()">
                        <span class="icon">üõí</span>
                        <!-- *ngIf affiche le badge seulement si cartCount > 0 -->
                        <span class="badge" *ngIf="cartCount > 0">{{ cartCount }}</span>
                    </div>

                    <!-- Ic√¥ne notifications avec badge -->
                    <div class="header-icon" (click)="openNotifications()">
                        <span class="icon">üîî</span>
                        <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
                    </div>

                    <!-- Profil utilisateur avec dropdown -->
                    <div class="user-profile" (click)="toggleUserDropdown()">
                        <div class="avatar">üë§</div>
                        <div>
                            <!-- ?. est l'op√©rateur safe navigation (√©vite les erreurs si null) -->
                            <div class="user-name">{{ currentUser?.name }}</div>
                            <div class="user-role">{{ currentUser?.role }}</div>
                        </div>
                        <!-- Menu dropdown -->
                        <!-- [class.show] ajoute la classe 'show' si userDropdownOpen est true -->
                        <div class="user-dropdown" [class.show]="userDropdownOpen">
                            <div class="dropdown-item" (click)="goToProfile()">üë§ Mon profil</div>
                            <div class="dropdown-item" (click)="goToSettings()">‚öôÔ∏è Param√®tres</div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item" (click)="openSupport()">üí¨ Assistance</div>
                            <div class="dropdown-item" (click)="logout()">üö™ D√©connexion</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- ===== PAGE ACCUEIL ===== -->
            <!-- *ngIf affiche cette section seulement si currentPage === 'home' -->
            <div class="page-section" *ngIf="currentPage === 'home'">
                <!-- CAROUSEL DES BOISSONS VEDETTES -->
                <section class="carousel-section">
                    <div class="carousel-container">
                        <!-- Bouton pr√©c√©dent -->
                        <button class="carousel-btn" (click)="previousDrink()">‚ùÆ</button>

                        <!-- Contenu du carousel -->
                        <!-- currentDrink est un getter qui retourne la boisson actuelle -->
                        <div class="carousel-content" *ngIf="currentDrink">
                            <div class="featured-drink">
                                <!-- Image de la boisson -->
                                <div class="drink-image">{{ currentDrink.icon }}</div>
                                <!-- Informations de la boisson -->
                                <div class="drink-info">
                                    <h2>{{ currentDrink.name }}</h2>
                                    <p class="drink-category">{{ currentDrink.category }}</p>
                                    <!-- Le pipe 'number' formate le nombre avec des espaces -->
                                    <p class="drink-price">{{ currentDrink.price | number }} FCFA</p>
                                    <p class="drink-stock">Stock: {{ currentDrink.stock }} unit√©s</p>
                                    <button class="view-btn" (click)="viewDrinkDetails(currentDrink)">
                                        Voir les d√©tails
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton suivant -->
                        <button class="carousel-btn" (click)="nextDrink()">‚ùØ</button>
                    </div>

                    <!-- Indicateurs de position (points) -->
                    <div class="carousel-indicators">
                        <!-- *ngFor avec 'let i = index' cr√©e une variable pour l'index -->
                        <span
                            class="indicator"
                            *ngFor="let drink of featuredDrinks; let i = index"
                            [class.active]="i === currentDrinkIndex"
                            (click)="goToDrink(i)">
                        </span>
                    </div>
                </section>

                <!-- STATISTIQUES RAPIDES -->
                <section class="content-section">
                    <div class="stats-cards-grid">
                        <!-- *ngFor it√®re sur les cartes statistiques -->
                        <!-- [ngClass] permet d'appliquer une classe dynamiquement -->
                        <div
                            class="stat-card"
                            *ngFor="let stat of statsCards"
                            [ngClass]="stat.colorClass">
                            <div class="stat-icon">{{ stat.icon }}</div>
                            <div class="stat-content">
                                <div class="stat-label">{{ stat.label }}</div>
                                <div class="stat-value">{{ stat.value }}</div>
                                <!-- [ngClass] applique une classe selon stat.changeType -->
                                <div class="stat-change" [ngClass]="stat.changeType">
                                    {{ stat.change }}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- PRODUITS POPULAIRES -->
                <section class="content-section">
                    <div class="section-header">
                        <h2 class="section-title-main">Produits Populaires</h2>
                    </div>
                    <div class="products-grid">
                        <!-- *ngFor it√®re sur les produits populaires -->
                        <div
                            class="product-card"
                            *ngFor="let product of popularProducts"
                            (click)="viewProductDetails(product)">
                            <div class="product-image">
                                {{ product.icon }}
                                <!-- *ngIf affiche le badge seulement si product.badge existe -->
                                <!-- 'badge-' + product.badge.toLowerCase() concat√®ne les cha√Ænes -->
                                <span
                                    class="product-badge"
                                    *ngIf="product.badge"
                                    [ngClass]="'badge-' + product.badge.toLowerCase()">
                                    {{ product.badge }}
                                </span>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">{{ product.name }}</h3>
                                <p class="product-category">{{ product.category }}</p>
                                <div class="product-stats">
                                    <span class="product-sales">{{ product.sales }} ventes</span>
                                    <span class="product-price">{{ product.price | number }} FCFA</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ACTIONS R√âCENTES -->
                <section class="content-section">
                    <div class="section-header">
                        <h2 class="section-title-main">Actions R√©centes</h2>
                    </div>
                    <div class="actions-list">
                        <!-- *ngFor it√®re sur les actions r√©centes -->
                        <div
                            class="action-item"
                            *ngFor="let action of recentActions">
                            <!-- [ngClass] applique une classe bas√©e sur action.type -->
                            <div class="action-icon" [ngClass]="action.type">
                                {{ action.icon }}
                            </div>
                            <div class="action-content">
                                <div class="action-title">{{ action.title }}</div>
                                <div class="action-details">{{ action.details }}</div>
                            </div>
                            <div class="action-time">{{ action.time }}</div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ===== PAGE MES CAVES ===== -->
            <div class="page-section" *ngIf="currentPage === 'caves'">
                <section class="content-section">
                    <div class="section-header">
                        <h2 class="section-title-main">Mes Caves</h2>
                        <!-- Bouton pour ajouter une nouvelle cave -->
                        <button class="btn btn-primary" (click)="openAddCaveModal()">
                            ‚ûï Ajouter une cave
                        </button>
                    </div>

                    <!-- Grille des caves -->
                    <div class="caves-grid">
                        <!-- *ngFor it√®re sur toutes les caves -->
                        <div
                            class="cave-card"
                            *ngFor="let cave of caves"
                            (click)="openCaveModal(cave)">
                            <div class="cave-header">
                                <h3 class="cave-name">{{ cave.name }}</h3>
                                <p class="cave-location">{{ cave.location }}</p>
                            </div>
                            <div class="cave-stats">
                                <div class="stat-item">
                                    <div class="stat-value">{{ cave.bottles }}</div>
                                    <div class="stat-label">Bouteilles</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ cave.managers }}</div>
                                    <!-- Op√©rateur ternaire pour pluriel/singulier -->
                                    <div class="stat-label">{{ cave.managers === 1 ? 'Manager' : 'Managers' }}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ cave.employees }}</div>
                                    <div class="stat-label">Employ√©s</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">{{ cave.productivity }}%</div>
                                    <div class="stat-label">Productivit√©</div>
                                </div>
                            </div>
                            <!-- $event.stopPropagation() emp√™che le clic de remonter au parent -->
                            <!-- Sinon, cliquer sur les boutons ouvrirait aussi la modal -->
                            <div class="cave-actions" (click)="$event.stopPropagation()">
                                <button
                                    class="btn btn-sm btn-secondary"
                                    (click)="viewCaveStats(cave)">
                                    üìä Stats
                                </button>
                                <button
                                    class="btn btn-sm btn-primary"
                                    (click)="openCaveModal(cave)">
                                    Voir d√©tails
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- ===== MODAL D√âTAILS CAVE ===== -->
    <!-- [class.show] ajoute la classe 'show' si caveModalOpen est true -->
    <!-- (click) sur la modal ferme la modal (clic sur le fond sombre) -->
    <div class="modal" [class.show]="caveModalOpen" (click)="closeCaveModal()">
        <!-- $event.stopPropagation() emp√™che le clic de fermer la modal -->
        <!-- quand on clique sur le contenu de la modal -->
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <!-- ?. √©vite les erreurs si selectedCave est null -->
                <h2 class="modal-title">{{ selectedCave?.name || 'D√©tails de la cave' }}</h2>
                <button class="close-btn" (click)="closeCaveModal()">√ó</button>
            </div>

            <!-- Onglets -->
            <div class="modal-tabs">
                <button
                    class="modal-tab"
                    [class.active]="currentTab === 'managers'"
                    (click)="switchTab('managers')">
                    üë• Managers
                </button>
                <button
                    class="modal-tab"
                    [class.active]="currentTab === 'productivity'"
                    (click)="switchTab('productivity')">
                    üìä Productivit√©
                </button>
            </div>

            <div class="modal-body">
                <!-- ===== ONGLET MANAGERS ===== -->
                <!-- [class.active] affiche l'onglet si currentTab === 'managers' -->
                <div class="tab-content" [class.active]="currentTab === 'managers'">
                    <div class="managers-list">
                        <!-- *ngFor it√®re sur les managers de la cave s√©lectionn√©e -->
                        <!-- ?. √©vite les erreurs si selectedCave est null -->
                        <div
                            class="manager-card"
                            *ngFor="let manager of selectedCave?.managersList">
                            <div class="manager-avatar">{{ manager.avatar }}</div>
                            <div class="manager-info">
                                <div class="manager-name">{{ manager.name }}</div>
                                <div class="manager-role">{{ manager.role }}</div>
                                <div class="manager-contact">
                                    <div>üìß {{ manager.email }}</div>
                                    <div>üì± {{ manager.phone }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== ONGLET PRODUCTIVIT√â ===== -->
                <div class="tab-content" [class.active]="currentTab === 'productivity'">
                    <h3 style="margin-bottom: 1.5rem;">Statistiques mensuelles</h3>

                    <div class="productivity-grid">
                        <!-- *ngFor it√®re sur les stats mensuelles -->
                        <div
                            class="productivity-card"
                            *ngFor="let stat of selectedCave?.monthlyStats">
                            <h4>{{ stat.month }}</h4>
                            <div class="productivity-stat">
                                <span>Ventes:</span>
                                <!-- Le pipe 'number' formate le nombre avec des espaces -->
                                <span>{{ stat.sales | number }} FCFA</span>
                            </div>
                            <div class="productivity-stat">
                                <span>Commandes:</span>
                                <span>{{ stat.orders }}</span>
                            </div>
                            <div class="productivity-stat">
                                <span>Productivit√©:</span>
                                <span>{{ stat.avgProductivity }}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Moyennes globales -->
                    <!-- *ngIf affiche cette section seulement si selectedCave existe -->
                    <div class="global-stats" *ngIf="selectedCave">
                        <h3>Moyennes globales</h3>
                        <div class="global-stats-grid">
                            <div class="global-stat-item">
                                <div class="global-stat-label">Ventes moyennes</div>
                                <div class="global-stat-value">
                                    <!-- Appelle une m√©thode du composant pour calculer la moyenne -->
                                    {{ getAverageSales(selectedCave) | number }} FCFA
                                </div>
                            </div>
                            <div class="global-stat-item">
                                <div class="global-stat-label">Commandes moyennes</div>
                                <div class="global-stat-value">
                                    {{ getAverageOrders(selectedCave) }}
                                </div>
                            </div>
                            <div class="global-stat-item">
                                <div class="global-stat-label">Productivit√© moyenne</div>
                                <div class="global-stat-value">
                                    {{ getAverageProductivity(selectedCave) }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MODAL AJOUTER CAVE ===== -->
    <div class="modal" [class.show]="addCaveModalOpen" (click)="closeAddCaveModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">‚ûï Ajouter une nouvelle cave</h2>
                <button class="close-btn" (click)="closeAddCaveModal()">√ó</button>
            </div>

            <div class="modal-body">
                <!-- Formulaire d'ajout de cave -->
                <!-- [formGroup] lie le formulaire √† addCaveForm -->
                <!-- (ngSubmit) est d√©clench√© lors de la soumission du formulaire -->
                <form [formGroup]="addCaveForm" (ngSubmit)="onAddCave()">
                    <div class="form-group">
                        <label class="form-label">Nom de la cave</label>
                        <!-- formControlName lie cet input au champ 'name' du formulaire -->
                        <input
                            type="text"
                            class="form-input"
                            formControlName="name"
                            placeholder="Ex: Cave Principale">
                        <!-- Affiche une erreur si le champ est invalide ET touch√© -->
                        <!-- get('name')?.invalid v√©rifie si le champ name est invalide -->
                        <!-- get('name')?.touched v√©rifie si l'utilisateur a cliqu√© dedans -->
                        <div
                            class="error-message"
                            *ngIf="addCaveForm.get('name')?.invalid && addCaveForm.get('name')?.touched">
                            Le nom est requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Localisation</label>
                        <input
                            type="text"
                            class="form-input"
                            formControlName="location"
                            placeholder="Ex: Lekki Phase 1, Lagos">
                        <div
                            class="error-message"
                            *ngIf="addCaveForm.get('location')?.invalid && addCaveForm.get('location')?.touched">
                            La localisation est requise
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Capacit√© (nombre de bouteilles)</label>
                        <input
                            type="number"
                            class="form-input"
                            formControlName="capacity"
                            placeholder="Ex: 500">
                        <div
                            class="error-message"
                            *ngIf="addCaveForm.get('capacity')?.invalid && addCaveForm.get('capacity')?.touched">
                            La capacit√© est requise
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea
                            class="form-textarea"
                            formControlName="description"
                            placeholder="Description de la cave...">
                        </textarea>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button
                    class="btn btn-cancel"
                    type="button"
                    (click)="closeAddCaveModal()">
                    Annuler
                </button>
                <!-- [disabled] d√©sactive le bouton si le formulaire est invalide -->
                <!-- addCaveForm.invalid est true si au moins un champ requis est vide -->
                <button
                    class="btn btn-primary"
                    type="button"
                    [disabled]="addCaveForm.invalid"
                    (click)="onAddCave()">
                    Cr√©er la cave
                </button>
            </div>
        </div>
    </div>
</body>
