<!-- app.component.html -->
<div class="dashboard">
    <!-- ===== SIDEBAR (MENU LAT√âRAL) ===== -->
    <aside class="sidebar">
        <!-- Logo en haut -->
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üçæ</span>
                <span class="logo-text">DrinkStore Pro</span>
            </div>
        </div>

        <!-- Navigation principale -->
        <nav class="sidebar-section">
            <!-- Accueil - Page active par d√©faut -->
            <div
                class="nav-item"
                [class.active]="currentPage === 'home'"
                (click)="navigateTo('home')">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Accueil</span>
            </div>
            <!-- Mes caves -->
            <div
                class="nav-item"
                [class.active]="currentPage === 'caves'"
                (click)="navigateTo('caves')">
                <span class="nav-icon">üç∑</span>
                <span class="nav-text">Mes caves</span>
            </div>
        </nav>

        <div class="divider"></div>

        <!-- Section MA CAVE -->
        <nav class="sidebar-section">
            <div class="section-title">MA CAVE</div>

            <!-- Mes boissons avec sous-menu -->
            <div class="nav-item" (click)="toggleSubmenu($event)">
                <span class="nav-icon">üçæ</span>
                <span class="nav-text">Mes boissons</span>
                <span
                    class="submenu-arrow"
                    [style.transform]="submenuOpen ? 'rotate(90deg)' : 'rotate(0deg)'">
                    ‚ñ∂
                </span>
            </div>
            <!-- Sous-menu des cat√©gories de boissons -->
            <div class="submenu" [class.open]="submenuOpen">
                <div class="submenu-item" *ngFor="let category of drinkCategories">
                    {{ category.icon }} {{ category.name }}
                </div>
            </div>

            <!-- Autres items de la cave -->
            <div class="nav-item">
                <span class="nav-icon">üì•</span>
                <span class="nav-text">Mes entr√©es</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üì§</span>
                <span class="nav-text">Mes sorties</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üçΩÔ∏è</span>
                <span class="nav-text">Mets & Vins</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">Mes managers</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üë®‚Äçüíº</span>
                <span class="nav-text">Mes employ√©s</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üì∑</span>
                <span class="nav-text">Scan</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üë§</span>
                <span class="nav-text">Mon compte</span>
            </div>
        </nav>

        <div class="divider"></div>

        <!-- Section INFOS -->
        <nav class="sidebar-section">
            <div class="section-title">INFOS</div>

            <div class="nav-item">
                <span class="nav-icon">‚ùì</span>
                <span class="nav-text">FAQ</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üìù</span>
                <span class="nav-text">Notes am√©liorations</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üìß</span>
                <span class="nav-text">Nous contacter</span>
            </div>

            <div class="nav-item">
                <span class="nav-icon">üìö</span>
                <span class="nav-text">En savoir plus</span>
            </div>
        </nav>

        <div class="divider"></div>

        <!-- R√©seaux sociaux -->
        <div class="sidebar-section">
            <div class="section-title">SUIVEZ-NOUS</div>
            <div class="social-links">
                <div
                    class="social-link"
                    *ngFor="let social of socialLinks"
                    [title]="social.name">
                    {{ social.icon }}
                </div>
            </div>
        </div>
    </aside>

    <!-- ===== CONTENU PRINCIPAL ===== -->
    <main class="main-content">
        <!-- ===== EN-T√äTE DU HAUT ===== -->
        <header class="top-header">
            <!-- Barre de recherche √† gauche -->
            <div class="header-left">
                <div class="search-bar">
                    <input
                        type="text"
                        placeholder="Rechercher un vin mill√©sime, une cave..."
                        [(ngModel)]="searchQuery"
                        (input)="onSearch()">
                    <button class="search-btn" (click)="onSearch()">üîç</button>
                </div>
            </div>

            <!-- √âl√©ments √† droite -->
            <div class="header-right">
                <!-- S√©lecteur de cat√©gories -->
                <div class="category-selector">
                    <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
                        <option value="">Toutes les cat√©gories</option>
                        <option *ngFor="let cat of categories" [value]="cat.value">
                            {{ cat.label }}
                        </option>
                    </select>
                </div>

                <!-- Ic√¥ne panier avec badge -->
                <div class="header-icon" (click)="openCart()">
                    <span class="icon">üõí</span>
                    <span class="badge" *ngIf="cartCount > 0">{{ cartCount }}</span>
                </div>

                <!-- Ic√¥ne notifications avec badge -->
                <div class="header-icon" (click)="openNotifications()">
                    <span class="icon">üîî</span>
                    <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
                </div>

                <!-- Profil utilisateur avec dropdown -->
                <div class="user-profile" (click)="toggleUserDropdown()">
                    <div class="avatar">üë§</div>
                    <div>
                        <div class="user-name">{{ currentUser?.name }}</div>
                        <div class="user-role">{{ currentUser?.role }}</div>
                    </div>
                    <!-- Menu dropdown (cach√© par d√©faut) -->
                    <div class="user-dropdown" [class.show]="userDropdownOpen">
                        <div class="dropdown-item" (click)="goToProfile()">üë§ Mon profil</div>
                        <div class="dropdown-item" (click)="goToSettings()">‚öôÔ∏è Param√®tres</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" (click)="openSupport()">üí¨ Assistance</div>
                        <div class="dropdown-item" (click)="logout()">üö™ D√©connexion</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== PAGE ACCUEIL ===== -->
        <div class="page-section" [class.active]="currentPage === 'home'">
            <!-- CAROUSEL DES BOISSONS VEDETTES -->
            <section class="carousel-section">
                <div class="carousel-container">
                    <!-- Bouton pr√©c√©dent -->
                    <button class="carousel-btn" (click)="previousDrink()">‚ùÆ</button>

                    <!-- Contenu du carousel -->
                    <div class="carousel-content" *ngIf="currentDrink">
                        <div class="featured-drink">
                            <!-- Image de la boisson (avec animation flottante) -->
                            <div class="drink-image">{{ currentDrink.icon }}</div>
                            <!-- Informations de la boisson -->
                            <div class="drink-info">
                                <h2>{{ currentDrink.name }}</h2>
                                <p class="drink-category">{{ currentDrink.category }}</p>
                                <p class="drink-price">{{ currentDrink.price | number }} FCFA</p>
                                <p class="drink-stock">Stock: {{ currentDrink.stock }} unit√©s</p>
                                <button class="view-btn" (click)="viewDrinkDetails(currentDrink)">
                                    Voir les d√©tails
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bouton suivant -->
                    <button class="carousel-btn" (click)="nextDrink()">‚ùØ</button>
                </div>

                <!-- Indicateurs de position (points) -->
                <div class="carousel-indicators">
                    <span
                        class="indicator"
                        *ngFor="let drink of featuredDrinks; let i = index"
                        [class.active]="i === currentDrinkIndex"
                        (click)="goToDrink(i)">
                    </span>
                </div>
            </section>

            <!-- STATISTIQUES RAPIDES -->
            <section class="content-section">
                <div class="stats-cards-grid">
                    <!-- It√©ration sur les cartes statistiques -->
                    <div
                        class="stat-card"
                        *ngFor="let stat of statsCards"
                        [ngClass]="stat.colorClass">
                        <div class="stat-icon">{{ stat.icon }}</div>
                        <div class="stat-content">
                            <div class="stat-label">{{ stat.label }}</div>
                            <div class="stat-value">{{ stat.value }}</div>
                            <div class="stat-change" [ngClass]="stat.changeType">
                                {{ stat.change }}
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PRODUITS POPULAIRES -->
            <section class="content-section">
                <div class="section-header">
                    <h2 class="section-title-main">Produits Populaires</h2>
                </div>
                <div class="products-grid">
                    <!-- It√©ration sur les produits populaires -->
                    <div
                        class="product-card"
                        *ngFor="let product of popularProducts"
                        (click)="viewProductDetails(product)">
                        <div class="product-image">
                            {{ product.icon }}
                            <span
                                class="product-badge"
                                *ngIf="product.badge"
                                [ngClass]="'badge-' + product.badge.toLowerCase()">
                                {{ product.badge }}
                            </span>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <p class="product-category">{{ product.category }}</p>
                            <div class="product-stats">
                                <span class="product-sales">{{ product.sales }} ventes</span>
                                <span class="product-price">{{ product.price | number }} FCFA</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ACTIONS R√âCENTES -->
            <section class="content-section">
                <div class="section-header">
                    <h2 class="section-title-main">Actions R√©centes</h2>
                </div>
                <div class="actions-list">
                    <!-- It√©ration sur les actions r√©centes -->
                    <div
                        class="action-item"
                        *ngFor="let action of recentActions">
                        <div class="action-icon" [ngClass]="action.type">
                            {{ action.icon }}
                        </div>
                        <div class="action-content">
                            <div class="action-title">{{ action.title }}</div>
                            <div class="action-details">{{ action.details }}</div>
                        </div>
                        <div class="action-time">{{ action.time }}</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ===== PAGE MES CAVES ===== -->
        <div class="page-section" [class.active]="currentPage === 'caves'">
            <section class="content-section">
                <div class="section-header">
                    <h2 class="section-title-main">Mes Caves</h2>
                    <!-- Bouton pour ajouter une nouvelle cave -->
                    <button class="btn btn-primary" (click)="openAddCaveModal()">
                        ‚ûï Ajouter une cave
                    </button>
                </div>

                <!-- Grille des caves -->
                <div class="caves-grid">
                    <!-- It√©ration sur les caves -->
                    <div
                        class="cave-card"
                        *ngFor="let cave of caves"
                        (click)="openCaveModal(cave)">
                        <div class="cave-header">
                            <h3 class="cave-name">{{ cave.name }}</h3>
                            <p class="cave-location">{{ cave.location }}</p>
                        </div>
                        <div class="cave-stats">
                            <div class="stat-item">
                                <div class="stat-value">{{ cave.bottles }}</div>
                                <div class="stat-label">Bouteilles</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ cave.managers }}</div>
                                <div class="stat-label">{{ cave.managers === 1 ? 'Manager' : 'Managers' }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ cave.employees }}</div>
                                <div class="stat-label">Employ√©s</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ cave.productivity }}%</div>
                                <div class="stat-label">Productivit√©</div>
                            </div>
                        </div>
                        <div class="cave-actions" (click)="$event.stopPropagation()">
                            <button
                                class="btn btn-sm btn-secondary"
                                (click)="viewCaveStats(cave)">
                                üìä Stats
                            </button>
                            <button
                                class="btn btn-sm btn-primary"
                                (click)="openCaveModal(cave)">
                                Voir d√©tails
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>

<!-- ===== MODAL D√âTAILS CAVE ===== -->
<div class="modal" [class.show]="caveModalOpen" (click)="closeCaveModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">{{ selectedCave?.name || 'D√©tails de la cave' }}</h2>
            <button class="close-btn" (click)="closeCaveModal()">√ó</button>
        </div>

        <!-- Onglets -->
        <div class="modal-tabs">
            <button
                class="modal-tab"
                [class.active]="currentTab === 'managers'"
                (click)="switchTab('managers')">
                üë• Managers
            </button>
            <button
                class="modal-tab"
                [class.active]="currentTab === 'productivity'"
                (click)="switchTab('productivity')">
                üìä Productivit√©
            </button>
        </div>

        <div class="modal-body">
            <!-- ===== ONGLET MANAGERS ===== -->
            <div class="tab-content" [class.active]="currentTab === 'managers'">
                <div class="managers-list">
                    <!-- It√©ration sur les managers -->
                    <div
                        class="manager-card"
                        *ngFor="let manager of selectedCave?.managersList">
                        <div class="manager-avatar">{{ manager.avatar }}</div>
                        <div class="manager-info">
                            <div class="manager-name">{{ manager.name }}</div>
                            <div class="manager-role">{{ manager.role }}</div>
                            <div class="manager-contact">
                                <div>üìß {{ manager.email }}</div>
                                <div>üì± {{ manager.phone }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== ONGLET PRODUCTIVIT√â ===== -->
            <div class="tab-content" [class.active]="currentTab === 'productivity'">
                <h3 style="margin-bottom: 1.5rem;">Statistiques mensuelles</h3>
                <div class="productivity-grid">
                    <!-- It√©ration sur les stats mensuelles -->
                    <div
                        class="productivity-card"
                        *ngFor="let stat of selectedCave?.monthlyStats">
                        <h4>{{ stat.month }}</h4>
                        <div class="productivity-stat">
                            <span>Ventes:</span>
                            <span>{{ stat.sales | number }} FCFA</span>
                        </div>
                        <div class="productivity-stat">
                            <span>Commandes:</span>
                            <span>{{ stat.orders }}</span>
                        </div>
                        <div class="productivity-stat">
                            <span>Productivit√©:</span>
                            <span>{{ stat.avgProductivity }}%</span>
                        </div>
                    </div>
                </div>

                <div class="global-stats" *ngIf="selectedCave">
                    <h3>Moyennes globales</h3>
                    <div class="global-stats-grid">
                        <div class="global-stat-item">
                            <div class="global-stat-label">Ventes moyennes</div>
                            <div class="global-stat-value">
                                {{ getAverageSales(selectedCave) | number }} FCFA
                            </div>
                        </div>
                        <div class="global-stat-item">
                            <div class="global-stat-label">Commandes moyennes</div>
                            <div class="global-stat-value">
                                {{ getAverageOrders(selectedCave) }}
                            </div>
                        </div>
                        <div class="global-stat-item">
                            <div class="global-stat-label">Productivit√© moyenne</div>
                            <div class="global-stat-value">
                                {{ getAverageProductivity(selectedCave) }}%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== MODAL AJOUTER CAVE ===== -->
<div class="modal" [class.show]="addCaveModalOpen" (click)="closeAddCaveModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">‚ûï Ajouter une nouvelle cave</h2>
            <button class="close-btn" (click)="closeAddCaveModal()">√ó</button>
        </div>

        <div class="modal-body">
            <!-- Formulaire d'ajout de cave -->
            <form [formGroup]="addCaveForm" (ngSubmit)="onAddCave()">
                <div class="form-group">
                    <label class="form-label">Nom de la cave</label>
                    <input
                        type="text"
                        class="form-input"
                        formControlName="name"
                        placeholder="Ex: Cave Principale">
                    <div
                        class="error-message"
                        *ngIf="addCaveForm.get('name')?.invalid && addCaveForm.get('name')?.touched">
                        Le nom est requis
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Localisation</label>
                    <input
                        type="text"
                        class="form-input"
                        formControlName="location"
                        placeholder="Ex: Lekki Phase 1, Lagos">
                    <div
                        class="error-message"
                        *ngIf="addCaveForm.get('location')?.invalid && addCaveForm.get('location')?.touched">
                        La localisation est requise
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Capacit√© (nombre de bouteilles)</label>
                    <input
                        type="number"
                        class="form-input"
                        formControlName="capacity"
                        placeholder="Ex: 500">
                    <div
                        class="error-message"
                        *ngIf="addCaveForm.get('capacity')?.invalid && addCaveForm.get('capacity')?.touched">
                        La capacit√© est requise
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-textarea"
                        formControlName="description"
                        placeholder="Description de la cave...">
                    </textarea>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button
                class="btn btn-cancel"
                type="button"
                (click)="closeAddCaveModal()">
                Annuler
            </button>
            <button
                class="btn btn-primary"
                type="button"
                [disabled]="addCaveForm.invalid"
                (click)="onAddCave()">
                Cr√©er la cave
            </button>
        </div>
    </div>
</div>
