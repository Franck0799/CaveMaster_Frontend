<!-- ===== PAGE MES MANAGERS ===== -->
<div class="page-section">
  
  <section class="content-section">
    
    <!-- ===== En-tête avec titre et bouton d'ajout ===== -->
    <div class="section-header">
      <h2 class="section-title-main">👥 Mes Managers</h2>
      
      <!-- Bouton pour ajouter un nouveau manager -->
      <button class="btn btn-primary" (click)="openAddManagerModal()">
        ➕ Ajouter un manager
      </button>
    </div>

    <!-- ===== Statistiques globales ===== -->
    <div class="managers-stats-grid">
      
      <!-- Carte: Total Managers -->
      <div class="stat-card stat-card-blue">
        <div class="stat-icon">👥</div>
        <div class="stat-content">
          <div class="stat-label">Total Managers</div>
          <div class="stat-value">{{ getTotalManagersCount() }}</div>
          <div class="stat-change positive">+2 ce mois</div>
        </div>
      </div>

      <!-- Carte: Employés Supervisés -->
      <div class="stat-card stat-card-green">
        <div class="stat-icon">👨‍💼</div>
        <div class="stat-content">
          <div class="stat-label">Employés Supervisés</div>
          <div class="stat-value">{{ getTotalEmployeesSupervised() }}</div>
          <div class="stat-change positive">+8 ce mois</div>
        </div>
      </div>

      <!-- Carte: Ventes Totales -->
      <div class="stat-card stat-card-purple">
        <div class="stat-icon">💰</div>
        <div class="stat-content">
          <div class="stat-label">Ventes Totales</div>
          <div class="stat-value">{{ getTotalSales() }} FCFA</div>
          <div class="stat-change positive">+15% ce mois</div>
        </div>
      </div>
    </div>

    <!-- ===== Liste des managers ===== -->
    <div class="managers-grid">
      
      <!-- Boucle sur tous les managers -->
      <div *ngFor="let manager of getAllManagers()" class="manager-card-full">
        
        <!-- En-tête de la carte manager -->
        <div class="manager-header">
          <!-- Avatar du manager -->
          <div class="manager-avatar-large">{{ manager.avatar }}</div>
          
          <!-- Informations du manager -->
          <div class="manager-info-full">
            <div class="manager-name-large">{{ manager.name }}</div>
            <div class="manager-role-large">{{ manager.role }}</div>
          </div>
        </div>

        <!-- Indicateurs de performance -->
        <div class="manager-performance-full">
          
          <!-- Ventes -->
          <div class="performance-item">
            <div class="performance-icon">💰</div>
            <div class="performance-value">{{ manager.performance.ventes }}</div>
            <div class="performance-label">Ventes totales</div>
          </div>
          
          <!-- Équipe -->
          <div class="performance-item">
            <div class="performance-icon">👥</div>
            <div class="performance-value">{{ manager.performance.equipe }}</div>
            <div class="performance-label">Équipe</div>
          </div>
          
          <!-- Satisfaction -->
          <div class="performance-item">
            <div class="performance-icon">⭐</div>
            <div class="performance-value">{{ manager.performance.satisfaction }}</div>
            <div class="performance-label">Satisfaction</div>
          </div>
        </div>

        <!-- Bouton pour afficher/masquer les employés -->
        <button class="toggle-employees" (click)="toggleEmployees(manager)">
          👥 Employés ({{ manager.employees.length }})
          <!-- Flèche indicatrice -->
          <span>{{ manager.showEmployees ? '▲' : '▼' }}</span>
        </button>

        <!-- ===== Liste des employés (affichée conditionnellement) ===== -->
        <div *ngIf="manager.showEmployees" class="employees-list-full">
          
          <!-- Boucle sur les employés du manager -->
          <div *ngFor="let employee of manager.employees" class="employee-card-full">
            
            <!-- Avatar de l'employé -->
            <div class="employee-avatar">{{ employee.avatar }}</div>
            
            <!-- Informations de l'employé -->
            <div class="employee-info">
              <div class="employee-name">{{ employee.name }}</div>
              <div class="employee-position">{{ employee.position }}</div>
            </div>
            
            <!-- Statistiques de l'employé -->
            <div class="employee-stats">
              <span class="employee-stat">💰 {{ employee.ventes }}</span>
              <span class="employee-stat">⏱️ {{ employee.heures }}</span>
            </div>
          </div>

          <!-- Message si aucun employé -->
          <div *ngIf="manager.employees.length === 0" class="empty-employees">
            <p>Aucun employé assigné à ce manager</p>
          </div>
        </div>

        <!-- Actions sur le manager -->
        <div class="manager-actions">
          <!-- Bouton modifier -->
          <button class="btn btn-sm btn-secondary" (click)="editManager(manager)">
            ✏️ Modifier
          </button>
          
          <!-- Bouton voir stats -->
          <button class="btn btn-sm btn-info" (click)="viewManagerStats(manager)">
            📊 Voir stats
          </button>
          
          <!-- Bouton supprimer -->
          <button class="btn btn-sm btn-danger" (click)="deleteManager(manager)">
            🗑️ Supprimer
          </button>
        </div>
      </div>

      <!-- État vide si aucun manager -->
      <div *ngIf="getAllManagers().length === 0" class="empty-state">
        <div class="empty-icon">📭</div>
        <p>Aucun manager pour le moment</p>
        <button class="btn btn-primary" (click)="openAddManagerModal()">
          Ajouter le premier manager
        </button>
      </div>
    </div>
  </section>
</div>

<!-- ===== MODAL AJOUTER MANAGER ===== -->
<div *ngIf="isAddManagerModalOpen" 
     class="modal" 
     (click)="closeAddManagerModal()">
  
  <!-- Contenu du modal -->
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <!-- En-tête du modal -->
    <div class="modal-header">
      <h2 class="modal-title">➕ Ajouter un nouveau manager</h2>
      <button class="close-btn" (click)="closeAddManagerModal()">×</button>
    </div>

    <!-- Corps du modal avec formulaire -->
    <div class="modal-body">
      <form>
        
        <!-- Champ: Prénom -->
        <div class="form-group">
          <label class="form-label">Prénom *</label>
          <input type="text"
                 class="form-input"
                 [(ngModel)]="newManagerForm.firstName"
                 name="firstName"
                 placeholder="Ex: Jean"
                 required>
        </div>

        <!-- Champ: Nom -->
        <div class="form-group">
          <label class="form-label">Nom *</label>
          <input type="text"
                 class="form-input"
                 [(ngModel)]="newManagerForm.lastName"
                 name="lastName"
                 placeholder="Ex: Kouassi"
                 required>
        </div>

        <!-- Champ: Email -->
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email"
                 class="form-input"
                 [(ngModel)]="newManagerForm.email"
                 name="email"
                 placeholder="Ex: jean.kouassi@drinkstore.com"
                 required>
        </div>

        <!-- Champ: Téléphone -->
        <div class="form-group">
          <label class="form-label">Téléphone</label>
          <input type="tel"
                 class="form-input"
                 [(ngModel)]="newManagerForm.phone"
                 name="phone"
                 placeholder="Ex: +234 801 234 5678">
        </div>

        <!-- Champ: Cave d'affectation -->
        <div class="form-group">
          <label class="form-label">Cave d'affectation *</label>
          <select class="form-input"
                  [(ngModel)]="newManagerForm.caveId"
                  name="caveId"
                  required>
            <option value="">Sélectionner une cave...</option>
            <!-- Boucle sur les caves -->
            <option *ngFor="let cave of caves" [value]="cave.id">
              {{ cave.name }}
            </option>
          </select>
        </div>

        <!-- Champ: Rôle -->
        <div class="form-group">
          <label class="form-label">Rôle *</label>
          <select class="form-input"
                  [(ngModel)]="newManagerForm.role"
                  name="role"
                  required>
            <option value="Manager">Manager</option>
            <option value="Manager Principal">Manager Principal</option>
            <option value="Manager Adjoint">Manager Adjoint</option>
            <option value="Manager Nuit">Manager Nuit</option>
          </select>
        </div>
      </form>
    </div>

    <!-- Pied du modal -->
    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="closeAddManagerModal()">
        Annuler
      </button>
      <button class="btn btn-primary" (click)="addNewManager()">
        Ajouter le manager
      </button>
    </div>
  </div>
</div>