/* ==========================================
   TEMPLATE HTML
   ========================================== */

<div class="profile-container">

  <!-- CHARGEMENT -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Chargement du profil...</p>
  </div>

  <!-- PROFIL -->
  <div *ngIf="!isLoading && userProfile" class="profile-content">

    <!-- EN-TÊTE -->
    <header class="profile-header">
      <h1 class="page-title">👤 Mon Profil</h1>
      <div class="header-actions">
        <button *ngIf="!isEditing" class="btn btn-primary" (click)="enableEditMode()">
          ✏️ Modifier
        </button>
        <button *ngIf="isEditing" class="btn btn-secondary" (click)="cancelEdit()">
          ✕ Annuler
        </button>
        <button *ngIf="isEditing" class="btn btn-success" (click)="saveProfile()">
          💾 Enregistrer
        </button>
      </div>
    </header>

    <!-- MESSAGES -->
    <div *ngIf="successMessage" class="alert alert-success">
      ✓ {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-error">
      ⚠️ {{ errorMessage }}
    </div>

    <!-- CARTE PRINCIPALE -->
    <section class="profile-main-card">

      <!-- Avatar et infos de base -->
      <div class="profile-avatar-section">
        <div class="avatar-wrapper">
          <div class="avatar-large">
            {{ userProfile.avatar || getInitials() }}
          </div>
          <button *ngIf="isEditing" class="avatar-change-btn" title="Changer l'avatar">
            <input type="file" accept="image/*" (change)="onAvatarChange($event)"
                   style="display: none" #fileInput>
            <span (click)="fileInput.click()">📷</span>
          </button>
        </div>
        <div class="profile-basic-info">
          <h2>{{ userProfile.firstName }} {{ userProfile.lastName }}</h2>
          <p class="role-badge">{{ userProfile.role }}</p>
          <p class="join-date">Membre depuis le {{ userProfile.joinDate }}</p>
        </div>
      </div>

      <!-- Statistiques -->
      <div class="profile-stats-grid">
        <div class="stat-item">
          <div class="stat-icon">🍷</div>
          <div class="stat-value">{{ userProfile.cavesManaged || 0 }}</div>
          <div class="stat-label">Caves gérées</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">👥</div>
          <div class="stat-value">{{ userProfile.managersCount || 0 }}</div>
          <div class="stat-label">Managers</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">👨‍💼</div>
          <div class="stat-value">{{ userProfile.employeesCount || 0 }}</div>
          <div class="stat-label">Employés</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">💰</div>
          <div class="stat-value">{{ userProfile.totalSales || '0' }}</div>
          <div class="stat-label">Ventes totales</div>
        </div>
      </div>

    </section>

    <!-- FORMULAIRE DE MODIFICATION -->
    <section class="profile-form-section">
      <h3 class="section-title">Informations personnelles</h3>

      <form class="profile-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Prénom</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="profileForm.firstName"
              name="firstName"
              [disabled]="!isEditing">
          </div>

          <div class="form-group">
            <label class="form-label">Nom</label>
            <input
              type="text"
              class="form-input"
              [(ngModel)]="profileForm.lastName"
              name="lastName"
              [disabled]="!isEditing">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="profileForm.email"
            name="email"
            [disabled]="!isEditing">
        </div>

        <div class="form-group">
          <label class="form-label">Téléphone</label>
          <input
            type="tel"
            class="form-input"
            [(ngModel)]="profileForm.phone"
            name="phone"
            [disabled]="!isEditing">
        </div>

        <div class="form-group">
          <label class="form-label">Rôle</label>
          <input
            type="text"
            class="form-input"
            [value]="userProfile.role"
            disabled>
          <small class="form-hint">Le rôle ne peut pas être modifié</small>
        </div>
      </form>
    </section>

    <!-- SECTION MOT DE PASSE -->
    <section class="password-section">
      <div class="section-header-with-toggle">
        <h3 class="section-title">🔒 Sécurité du compte</h3>
        <button class="btn btn-secondary" (click)="togglePasswordSection()">
          {{ showPasswordSection ? 'Masquer' : 'Changer le mot de passe' }}
        </button>
      </div>

      <div *ngIf="showPasswordSection" class="password-form">
        <form>
          <div class="form-group">
            <label class="form-label">Mot de passe actuel</label>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="passwordForm.currentPassword"
              name="currentPassword"
              placeholder="••••••••">
          </div>

          <div class="form-group">
            <label class="form-label">Nouveau mot de passe</label>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="passwordForm.newPassword"
              name="newPassword"
              placeholder="••••••••">
            <small class="form-hint">
              Minimum 8 caractères, avec majuscule, minuscule et chiffre
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">Confirmer le mot de passe</label>
            <input
              type="password"
              class="form-input"
              [(ngModel)]="passwordForm.confirmPassword"
              name="confirmPassword"
              placeholder="••••••••">
          </div>

          <button
            type="button"
            class="btn btn-primary btn-block"
            (click)="changePassword()">
            🔒 Changer le mot de passe
          </button>
        </form>
      </div>
    </section>

  </div>

</div>


