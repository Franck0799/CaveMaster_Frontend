<!-- ========================================
FICHIER: src/app/view/admin-dashboard/entries/entries.component.html
DESCRIPTION: Template enrichi pour les entr√©es de stock avec d√©tails complets
VERSION ACTUALIS√âE
======================================== -->

<div class="entries-container">

  <!-- ===== EN-T√äTE ===== -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">üì• Mes Entr√©es de Stock</h1>
      <p class="page-subtitle">
        Gestion compl√®te des r√©ceptions - {{ filteredEntries.length }} entr√©e(s) affich√©e(s)
      </p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="exportToCSV()" title="Exporter en CSV">
        üìä Exporter
      </button>
      <button class="btn btn-secondary" (click)="printEntries()" title="Imprimer">
        üñ®Ô∏è Imprimer
      </button>
      <button class="btn btn-primary" (click)="openAddModal()">
        ‚ûï Nouvelle entr√©e
      </button>
    </div>
  </header>

  <!-- ===== STATISTIQUES ENRICHIES ===== -->
  <section class="stats-section">
    <div class="stat-card stat-primary">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.totalEntries }}</div>
        <div class="stat-label">Entr√©es totales</div>
      </div>
    </div>

    <div class="stat-card stat-success">
      <div class="stat-icon">üìà</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatNumber(stats.totalQuantity) }}</div>
        <div class="stat-label">Unit√©s re√ßues</div>
      </div>
    </div>

    <div class="stat-card stat-warning">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatNumber(stats.totalCost) }} F</div>
        <div class="stat-label">Co√ªt total</div>
      </div>
    </div>

    <div class="stat-card stat-info">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <div class="stat-value">{{ formatNumber(stats.averageUnitPrice) }} F</div>
        <div class="stat-label">Prix moyen unitaire</div>
      </div>
    </div>

    <div class="stat-card stat-success">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.totalBulkUnits }}</div>
        <div class="stat-label">Conditionnements re√ßus</div>
      </div>
    </div>

    <div class="stat-card stat-primary">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.conformityRate }}%</div>
        <div class="stat-label">Taux de conformit√©</div>
      </div>
    </div>

    <div class="stat-card stat-info" *ngIf="stats.topSupplier">
      <div class="stat-icon">üöö</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.topSupplier }}</div>
        <div class="stat-label">Fournisseur principal</div>
      </div>
    </div>

    <div class="stat-card stat-warning" *ngIf="stats.topCategory">
      <div class="stat-icon">üèÜ</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.topCategory }}</div>
        <div class="stat-label">Cat√©gorie la plus re√ßue</div>
      </div>
    </div>
  </section>

  <!-- ===== FILTRES ENRICHIS ===== -->
  <section class="filters-section">
    <!-- Recherche -->
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="üîç Rechercher par boisson, fournisseur, commercial, facture..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()">
      <button
        *ngIf="searchTerm"
        class="clear-btn"
        (click)="searchTerm = ''; onSearchChange()">‚úï</button>
    </div>

    <!-- Filtre par cave -->
    <div class="filter-group">
      <label class="filter-label">Cave :</label>
      <select
        class="filter-select"
        [(ngModel)]="selectedCaveFilter"
        (ngModelChange)="onCaveFilterChange()">
        <option [ngValue]="null">Toutes les caves</option>
        <option *ngFor="let cave of caves" [ngValue]="cave.id">
          üìç {{ cave.name }}
        </option>
      </select>
    </div>

    <!-- Filtre par cat√©gorie -->
    <div class="filter-group">
      <label class="filter-label">Cat√©gorie :</label>
      <select
        class="filter-select"
        [(ngModel)]="selectedCategoryFilter"
        (ngModelChange)="onCategoryFilterChange()">
        <option [ngValue]="null">Toutes les cat√©gories</option>
        <option *ngFor="let category of drinkCategories" [ngValue]="category">
          {{ category }}
        </option>
      </select>
    </div>

    <!-- Filtre par fournisseur -->
    <div class="filter-group">
      <label class="filter-label">Fournisseur :</label>
      <select
        class="filter-select"
        [(ngModel)]="selectedSupplierFilter"
        (ngModelChange)="onSupplierFilterChange()">
        <option [ngValue]="null">Tous les fournisseurs</option>
        <option *ngFor="let supplier of suppliers" [ngValue]="supplier">
          üöö {{ supplier }}
        </option>
      </select>
    </div>

    <!-- Filtre par p√©riode -->
    <div class="filter-group">
      <label class="filter-label">P√©riode :</label>
      <select
        class="filter-select"
        [(ngModel)]="periodFilter"
        (ngModelChange)="onPeriodFilterChange()">
        <option [value]="7">7 derniers jours</option>
        <option [value]="30">30 derniers jours</option>
        <option [value]="90">3 derniers mois</option>
        <option [value]="365">Cette ann√©e</option>
        <option [value]="0">Toutes les entr√©es</option>
      </select>
    </div>

    <!-- Bouton de r√©initialisation -->
    <button
      class="btn btn-secondary"
      (click)="resetFilters()"
      *ngIf="selectedCaveFilter || selectedCategoryFilter || selectedSupplierFilter || searchTerm || periodFilter !== 30">
      üîÑ R√©initialiser
    </button>
  </section>

  <!-- ===== CHARGEMENT ===== -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Chargement des entr√©es...</p>
  </div>

  <!-- ===== AUCUN R√âSULTAT ===== -->
  <div *ngIf="!isLoading && filteredEntries.length === 0" class="no-results">
    <div class="no-results-icon">üì¶</div>
    <h3>Aucune entr√©e trouv√©e</h3>
    <p *ngIf="searchTerm || selectedCaveFilter || selectedCategoryFilter || selectedSupplierFilter">
      Aucune entr√©e ne correspond √† vos crit√®res de recherche
    </p>
    <p *ngIf="!searchTerm && !selectedCaveFilter && !selectedCategoryFilter && !selectedSupplierFilter">
      Commencez par enregistrer votre premi√®re entr√©e de stock
    </p>
    <button class="btn btn-primary" (click)="openAddModal()">
      ‚ûï Nouvelle entr√©e
    </button>
  </div>

  <!-- ===== TABLEAU DES ENTR√âES ENRICHI ===== -->
  <section *ngIf="!isLoading && filteredEntries.length > 0" class="entries-table">
    <div class="table-wrapper">
      <table class="data-table">
        <!-- En-t√™tes -->
        <thead>
          <tr>
            <th>Date</th>
            <th>Boisson</th>
            <th>Cat√©gorie</th>
            <th>Conditionnement</th>
            <th class="text-center">Quantit√©</th>
            <th class="text-right">Prix Unit.</th>
            <th class="text-right">Co√ªt Total</th>
            <th>Fournisseur</th>
            <th>Commercial</th>
            <th>Cave</th>
            <th>Qualit√©</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>

        <!-- Corps -->
        <tbody>
          <tr *ngFor="let entry of filteredEntries"
              class="table-row"
              [class.recent-entry]="isRecentEntry(entry)"
              [class.expiry-warning]="isExpiryApproaching(entry)">

            <!-- Date -->
            <td class="date-cell">
              <div class="date-main">
                {{ formatDate(entry.date).split(' √† ')[0] }}
              </div>
              <div class="date-relative">{{ getRelativeDate(entry.date) }}</div>
            </td>

            <!-- Boisson avec ic√¥ne -->
            <td class="drink-cell">
              <div class="drink-info">
                <span class="drink-icon">{{ entry.drinkIcon }}</span>
                <div>
                  <div class="drink-name">{{ entry.drinkName }}</div>
                  <div class="drink-format">{{ entry.drinkFormat }}</div>
                </div>
              </div>
            </td>

            <!-- Cat√©gorie avec badge color√© -->
            <td>
              <span class="category-badge" [ngClass]="getCategoryClass(entry.drinkCategory)">
                {{ entry.drinkCategory }}
              </span>
            </td>

            <!-- Conditionnement d√©taill√© -->
            <td class="bulk-cell">
              <div class="bulk-info">
                <span class="bulk-icon">{{ getBulkUnitIcon(entry.bulkUnit) }}</span>
                <div>
                  <div class="bulk-quantity">{{ entry.bulkQuantity }} √ó {{ entry.bulkUnit }}</div>
                  <div class="bulk-units">{{ entry.unitsPerBulk }} unit√©s/{{ entry.bulkUnit }}</div>
                </div>
              </div>
            </td>

            <!-- Quantit√© totale -->
            <td class="text-center quantity-cell">
              <span class="quantity-badge">
                {{ entry.quantity }} unit√©s
              </span>
            </td>

            <!-- Prix unitaire -->
            <td class="text-right price-cell">
              {{ formatNumber(entry.unitPrice) }} F
            </td>

            <!-- Co√ªt total -->
            <td class="text-right total-cell">
              <strong>{{ formatNumber(entry.totalCost) }} F</strong>
            </td>

            <!-- Fournisseur -->
            <td class="supplier-cell">
              <div class="supplier-info">
                <div class="supplier-name">{{ entry.supplier }}</div>
                <div class="supplier-invoice" *ngIf="entry.supplierInvoice">
                  üìÑ {{ entry.supplierInvoice }}
                </div>
              </div>
            </td>

            <!-- Commercial -->
            <td class="commercial-cell">
              <div class="commercial-info">
                <div class="commercial-name">{{ entry.commercialName }}</div>
                <div class="commercial-contact">{{ entry.commercialContact }}</div>
              </div>
            </td>

            <!-- Cave -->
            <td class="cave-cell">
              <span class="cave-badge">
                üìç {{ getCaveName(entry.caveId) }}
              </span>
            </td>

            <!-- Qualit√© -->
            <td class="quality-cell">
              <span class="quality-badge" [ngClass]="getQualityCheckClass(entry.qualityCheck)">
                {{ getQualityCheckLabel(entry.qualityCheck) }}
              </span>
            </td>

            <!-- Actions -->
            <td class="text-center actions-cell">
              <button
                class="btn-icon"
                title="Voir les d√©tails"
                (click)="viewEntryDetails(entry)">
                üëÅÔ∏è
              </button>
              <button
                class="btn-icon btn-danger"
                title="Supprimer"
                (click)="deleteEntry(entry)">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== MODAL AJOUT D'ENTR√âE ENRICHI ===== -->
  <div *ngIf="isAddModalOpen" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal-container modal-large" (click)="$event.stopPropagation()">

      <!-- En-t√™te -->
      <header class="modal-header">
        <h2 class="modal-title">‚ûï Nouvelle Entr√©e de Stock</h2>
        <button class="modal-close-btn" (click)="closeAddModal()">‚úï</button>
      </header>

      <!-- Corps -->
      <div class="modal-body">
        <form class="entry-form">

          <!-- SECTION 1: S√âLECTION BOISSON -->
          <div class="form-section">
            <h3 class="section-title">üì¶ S√©lection du produit</h3>

            <div class="form-group">
              <label class="form-label" for="entry-drink">
                Boisson <span class="required">*</span>
              </label>
              <select
                id="entry-drink"
                class="form-input"
                [(ngModel)]="entryForm.drinkId"
                name="drinkId"
                (ngModelChange)="onDrinkSelected()"
                required>
                <option value="">S√©lectionner une boisson...</option>
                <option *ngFor="let drink of drinks" [value]="drink.id">
                  {{ drink.icon }} {{ drink.name }} ({{ drink.format }}) - Stock: {{ drink.stock }}
                </option>
              </select>
            </div>
          </div>

          <!-- SECTION 2: CONDITIONNEMENT -->
          <div class="form-section" *ngIf="entryForm.drinkId">
            <h3 class="section-title">üì¶ Conditionnement re√ßu</h3>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="entry-bulk-unit">
                  Type de conditionnement <span class="required">*</span>
                </label>
                <select
                  id="entry-bulk-unit"
                  class="form-input"
                  [(ngModel)]="entryForm.bulkUnit"
                  name="bulkUnit"
                  required>
                  <option *ngFor="let unit of bulkUnits" [value]="unit">
                    {{ getBulkUnitIcon(unit) }} {{ unit }}
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label" for="entry-bulk-qty">
                  Nombre de conditionnements <span class="required">*</span>
                </label>
                <input
                  type="number"
                  id="entry-bulk-qty"
                  class="form-input"
                  [(ngModel)]="entryForm.bulkQuantity"
                  name="bulkQuantity"
                  min="1"
                  (ngModelChange)="calculateTotalUnits()"
                  placeholder="Ex: 5"
                  required>
              </div>

              <div class="form-group">
                <label class="form-label" for="entry-units-per-bulk">
                  Unit√©s par conditionnement <span class="required">*</span>
                </label>
                <input
                  type="number"
                  id="entry-units-per-bulk"
                  class="form-input"
                  [(ngModel)]="entryForm.unitsPerBulk"
                  name="unitsPerBulk"
                  min="1"
                  (ngModelChange)="calculateTotalUnits()"
                  placeholder="Ex: 12"
                  required>
              </div>
            </div>

            <!-- Total calcul√© automatiquement -->
            <div class="calculation-display">
              <div class="calc-icon">üî¢</div>
              <div class="calc-content">
                <div class="calc-label">Quantit√© totale d'unit√©s :</div>
                <div class="calc-value">{{ entryForm.totalUnits }} unit√©s</div>
              </div>
            </div>
          </div>

          <!-- SECTION 3: TARIFICATION -->
          <div class="form-section" *ngIf="entryForm.drinkId">
            <h3 class="section-title">üí∞ Tarification</h3>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="entry-unit-price">
                  Prix unitaire d'achat (FCFA) <span class="required">*</span>
                </label>
                <input
                  type="number"
                  id="entry-unit-price"
                  class="form-input"
                  [(ngModel)]="entryForm.unitPrice"
                  name="unitPrice"
                  min="0"
                  (ngModelChange)="calculateBulkPrice()"
                  placeholder="Ex: 2500"
                  required>
              </div>

              <div class="form-group">
                <label class="form-label">
                  Prix par conditionnement
                </label>
                <input
                  type="number"
                  class="form-input"
                  [value]="entryForm.bulkPrice"
                  disabled
                  placeholder="Calcul√© automatiquement">
                <small class="helper-text">
                  {{ entryForm.unitPrice }} √ó {{ entryForm.unitsPerBulk }} = {{ formatNumber(entryForm.bulkPrice) }} F
                </small>
              </div>
            </div>

            <!-- Co√ªt total calcul√© -->
            <div class="total-cost-display">
              <span class="total-label">üíµ Co√ªt total de l'entr√©e :</span>
              <span class="total-value">
                {{ formatNumber(entryForm.totalCost) }} FCFA
              </span>
            </div>
          </div>

          <!-- SECTION 4: FOURNISSEUR ET DOCUMENTS -->
          <div class="form-section">
            <h3 class="section-title">üöö Fournisseur et documents</h3>

            <div class="form-group">
              <label class="form-label" for="entry-supplier">
                Fournisseur <span class="required">*</span>
              </label>
              <select
                id="entry-supplier"
                class="form-input"
                [(ngModel)]="entryForm.supplier"
                name="supplier"
                required>
                <option *ngFor="let supplier of suppliers" [value]="supplier">
                  {{ supplier }}
                </option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="entry-invoice">
                  Num√©ro de facture fournisseur
                </label>
                <input
                  type="text"
                  id="entry-invoice"
                  class="form-input"
                  [(ngModel)]="entryForm.supplierInvoice"
                  name="supplierInvoice"
                  placeholder="Ex: INV-2024-001234">
              </div>

              <div class="form-group">
                <label class="form-label" for="entry-delivery-note">
                  Num√©ro de bon de livraison
                </label>
                <input
                  type="text"
                  id="entry-delivery-note"
                  class="form-input"
                  [(ngModel)]="entryForm.deliveryNote"
                  name="deliveryNote"
                  placeholder="Ex: BL-2024-005678">
              </div>
            </div>
          </div>

          <!-- SECTION 5: DESTINATION ET QUALIT√â -->
          <div class="form-section">
            <h3 class="section-title">üìç Destination et contr√¥le qualit√©</h3>

            <div class="form-group">
              <label class="form-label" for="entry-cave">
                Cave de destination <span class="required">*</span>
              </label>
              <select
                id="entry-cave"
                class="form-input"
                [(ngModel)]="entryForm.caveId"
                name="caveId"
                required>
                <option value="">S√©lectionner une cave...</option>
                <option *ngFor="let cave of caves" [value]="cave.id">
                  üìç {{ cave.name }} - {{ cave.location }}
                  <span *ngIf="cave.temperature">({{ cave.temperature }})</span>
                </option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="entry-quality">
                  Contr√¥le qualit√© <span class="required">*</span>
                </label>
                <select
                  id="entry-quality"
                  class="form-input"
                  [(ngModel)]="entryForm.qualityCheck"
                  name="qualityCheck"
                  required>
                  <option value="conforme">‚úÖ Conforme</option>
                  <option value="avec-reserve">‚ö†Ô∏è Avec r√©serve</option>
                  <option value="non-conforme">‚ùå Non conforme</option>
                </select>
              </div>

              <div class="form-group" *ngIf="entryForm.qualityCheck !== 'conforme'">
                <label class="form-label" for="entry-quality-notes">
                  Notes sur la qualit√©
                </label>
                <input
                  type="text"
                  id="entry-quality-notes"
                  class="form-input"
                  [(ngModel)]="entryForm.qualityNotes"
                  name="qualityNotes"
                  placeholder="Pr√©cisez les anomalies...">
              </div>
            </div>
          </div>

          <!-- SECTION 6: TRA√áABILIT√â -->
          <div class="form-section">
            <h3 class="section-title">üîç Tra√ßabilit√©</h3>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="entry-batch">
                  Num√©ro de lot fabricant
                </label>
                <input
                  type="text"
                  id="entry-batch"
                  class="form-input"
                  [(ngModel)]="entryForm.batchNumber"
                  name="batchNumber"
                  placeholder="Ex: LOT-2024-H-0123">
              </div>

              <div class="form-group">
                <label class="form-label" for="entry-expiry">
                  Date de p√©remption
                </label>
                <input
                  type="date"
                  id="entry-expiry"
                  class="form-input"
                  [(ngModel)]="entryForm.expiryDate"
                  name="expiryDate">
              </div>
            </div>
          </div>

          <!-- SECTION 7: NOTES -->
          <div class="form-section">
            <h3 class="section-title">üìù Notes et commentaires</h3>

            <div class="form-group">
              <label class="form-label" for="entry-notes">
                Notes ou observations
              </label>
              <textarea
                id="entry-notes"
                class="form-textarea"
                [(ngModel)]="entryForm.notes"
                name="notes"
                rows="4"
                placeholder="Ajoutez des notes sur cette r√©ception (√©tat du colis, conditions de livraison, etc.)..."></textarea>
            </div>
          </div>

          <!-- SECTION 8: SUGGESTIONS D'ACCORDS METS-VINS -->
          <div class="form-section" *ngIf="winePairingSuggestions.length > 0">
            <h3 class="section-title">üçΩÔ∏è Suggestions d'accords mets-vins</h3>
            <p class="section-description">
              Voici quelques suggestions pour accompagner ce produit :
            </p>

            <div class="wine-pairing-suggestions">
              <div class="pairing-card" *ngFor="let suggestion of winePairingSuggestions">
                <div class="pairing-icon">{{ suggestion.dishIcon }}</div>
                <div class="pairing-content">
                  <h4 class="pairing-dish">{{ suggestion.dish }}</h4>
                  <p class="pairing-description">{{ suggestion.description }}</p>
                  <div class="pairing-temperature">
                    üå°Ô∏è Servir √† {{ suggestion.temperature }}
                  </div>
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>

      <!-- Pied -->
      <footer class="modal-footer">
        <button class="btn btn-cancel" (click)="closeAddModal()">
          Annuler
        </button>
        <button class="btn btn-primary" (click)="saveEntry()">
          üíæ Enregistrer l'entr√©e
        </button>
      </footer>

    </div>
  </div>

  <!-- ===== MODAL D√âTAILS D'ENTR√âE ===== -->
  <div *ngIf="isDetailModalOpen && selectedEntry" class="modal-overlay" (click)="closeDetailModal()">
    <div class="modal-container modal-large" (click)="$event.stopPropagation()">

      <!-- En-t√™te -->
      <header class="modal-header">
        <h2 class="modal-title">
          {{ selectedEntry.drinkIcon }} D√©tails de l'entr√©e - {{ selectedEntry.drinkName }}
        </h2>
        <button class="modal-close-btn" (click)="closeDetailModal()">‚úï</button>
      </header>

      <!-- Corps -->
      <div class="modal-body">
        <div class="details-content">

          <!-- Informations g√©n√©rales -->
          <div class="detail-section">
            <h3 class="detail-section-title">üì¶ Informations g√©n√©rales</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Date de r√©ception :</span>
                <span class="detail-value">{{ formatDate(selectedEntry.date) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Boisson :</span>
                <span class="detail-value">
                  {{ selectedEntry.drinkIcon }} {{ selectedEntry.drinkName }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Cat√©gorie :</span>
                <span class="detail-value badge" [ngClass]="getCategoryClass(selectedEntry.drinkCategory)">
                  {{ selectedEntry.drinkCategory }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Format :</span>
                <span class="detail-value">{{ selectedEntry.drinkFormat }}</span>
              </div>
            </div>
          </div>

          <!-- Conditionnement -->
          <div class="detail-section">
            <h3 class="detail-section-title">üì¶ Conditionnement</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Type :</span>
                <span class="detail-value">
                  {{ getBulkUnitIcon(selectedEntry.bulkUnit) }} {{ selectedEntry.bulkUnit }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Nombre :</span>
                <span class="detail-value">{{ selectedEntry.bulkQuantity }} {{ selectedEntry.bulkUnit }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Unit√©s par conditionnement :</span>
                <span class="detail-value">{{ selectedEntry.unitsPerBulk }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Quantit√© totale :</span>
                <span class="detail-value highlight">{{ selectedEntry.quantity }} unit√©s</span>
              </div>
            </div>
          </div>

          <!-- Tarification -->
          <div class="detail-section">
            <h3 class="detail-section-title">üí∞ Tarification</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Prix unitaire :</span>
                <span class="detail-value">{{ formatNumber(selectedEntry.unitPrice) }} FCFA</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Prix par conditionnement :</span>
                <span class="detail-value">{{ formatNumber(selectedEntry.bulkPrice) }} FCFA</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Co√ªt total :</span>
                <span class="detail-value highlight-success">
                  {{ formatNumber(selectedEntry.totalCost) }} FCFA
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Taux de marge potentiel :</span>
                <span class="detail-value">{{ calculateMarginRate(selectedEntry) }}%</span>
              </div>
            </div>
          </div>

          <!-- Fournisseur -->
          <div class="detail-section">
            <h3 class="detail-section-title">üöö Fournisseur et commercial</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Fournisseur :</span>
                <span class="detail-value">{{ selectedEntry.supplier }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Commercial :</span>
                <span class="detail-value">{{ selectedEntry.commercialName }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Contact :</span>
                <span class="detail-value">{{ selectedEntry.commercialContact }}</span>
              </div>
              <div class="detail-item" *ngIf="selectedEntry.supplierInvoice">
                <span class="detail-label">Facture :</span>
                <span class="detail-value">üìÑ {{ selectedEntry.supplierInvoice }}</span>
              </div>
              <div class="detail-item" *ngIf="selectedEntry.deliveryNote">
                <span class="detail-label">Bon de livraison :</span>
                <span class="detail-value">üìã {{ selectedEntry.deliveryNote }}</span>
              </div>
            </div>
          </div>

          <!-- Destination et qualit√© -->
          <div class="detail-section">
            <h3 class="detail-section-title">üìç Destination et qualit√©</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Cave :</span>
                <span class="detail-value">üìç {{ getCaveName(selectedEntry.caveId) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Contr√¥le qualit√© :</span>
                <span class="detail-value badge" [ngClass]="getQualityCheckClass(selectedEntry.qualityCheck)">
                  {{ getQualityCheckLabel(selectedEntry.qualityCheck) }}
                </span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedEntry.qualityNotes">
                <span class="detail-label">Notes qualit√© :</span>
                <span class="detail-value">{{ selectedEntry.qualityNotes }}</span>
              </div>
            </div>
          </div>

          <!-- Tra√ßabilit√© -->
          <div class="detail-section">
            <h3 class="detail-section-title">üîç Tra√ßabilit√©</h3>
            <div class="detail-grid">
              <div class="detail-item" *ngIf="selectedEntry.batchNumber">
                <span class="detail-label">Num√©ro de lot :</span>
                <span class="detail-value">{{ selectedEntry.batchNumber }}</span>
              </div>
              <div class="detail-item" *ngIf="selectedEntry.expiryDate">
                <span class="detail-label">Date de p√©remption :</span>
                <span class="detail-value" [class.expiry-warning]="isExpiryApproaching(selectedEntry)">
                  {{ formatDate(selectedEntry.expiryDate).split(' √† ')[0] }}
                  <span *ngIf="isExpiryApproaching(selectedEntry)">
                    ‚ö†Ô∏è ({{ getDaysUntilExpiry(selectedEntry.expiryDate) }} jours restants)
                  </span>
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Enregistr√© par :</span>
                <span class="detail-value">{{ selectedEntry.addedBy }}</span>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="detail-section" *ngIf="selectedEntry.notes">
            <h3 class="detail-section-title">üìù Notes</h3>
            <div class="detail-notes">
              {{ selectedEntry.notes }}
            </div>
          </div>

          <!-- Suggestions d'accords -->
          <div class="detail-section" *ngIf="winePairingSuggestions.length > 0">
            <h3 class="detail-section-title">üçΩÔ∏è Suggestions d'accords mets-vins</h3>
            <div class="wine-pairing-suggestions">
              <div class="pairing-card" *ngFor="let suggestion of winePairingSuggestions">
                <div class="pairing-icon">{{ suggestion.dishIcon }}</div>
                <div class="pairing-content">
                  <h4 class="pairing-dish">{{ suggestion.dish }}</h4>
                  <p class="pairing-description">{{ suggestion.description }}</p>
                  <div class="pairing-temperature">
                    üå°Ô∏è Servir √† {{ suggestion.temperature }}
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Pied -->
      <footer class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDetailModal()">
          Fermer
        </button>
      </footer>

    </div>
  </div>

</div>
