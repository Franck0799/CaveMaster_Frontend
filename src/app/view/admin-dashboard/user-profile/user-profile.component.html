<!-- ===== FICHIER: user-profile.component.html ===== -->
<!-- Template pour l'affichage et gestion du profil utilisateur -->

<div class="user-profile-container">

  <!-- Message de feedback -->
  <div *ngIf="message"
       class="alert"
       [ngClass]="'alert-' + messageType">
    {{ message }}
  </div>

  <!-- En-tÃªte du profil -->
  <div class="profile-header" *ngIf="userProfile">
    <!-- Couverture de profil -->
    <div class="profile-cover"></div>

    <!-- Section infos de profil -->
    <div class="profile-info-section">
      <!-- Avatar grand avec bouton Ã©dition -->
      <div class="avatar-large-container">
        <span class="avatar-xxl">{{ userProfile.avatar }}</span>
        <button (click)="startEditingProfile()" class="btn-edit-avatar" title="Changer avatar">
          âœï¸
        </button>
      </div>

      <!-- Infos basiques -->
      <div class="profile-basic">
        <h1>{{ userProfile.firstName }} {{ userProfile.lastName }}</h1>
        <p class="role">ğŸ‘” {{ userProfile.role }}</p>
        <p class="cave">ğŸ¢ {{ userProfile.cave }}</p>

        <!-- Badge statut -->
        <span class="status-badge" [ngClass]="'status-' + userProfile.status">
          {{ userProfile.status === 'active' ? 'ğŸŸ¢ Actif' :
             userProfile.status === 'inactive' ? 'ğŸ”´ Inactif' :
             'ğŸŸ¡ En congÃ©' }}
        </span>
      </div>

      <!-- Barre de complÃ©tude du profil -->
      <div class="completion-bar">
        <div class="bar-label">
          <span>Profil complÃ©tÃ©:</span>
          <span class="percentage">{{ getProfileCompletion() }}%</span>
        </div>
        <div class="bar-container">
          <div class="bar-fill" [style.width.%]="getProfileCompletion()"></div>
        </div>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="profile-actions">
      <button (click)="startEditingProfile()" class="btn btn-primary" *ngIf="!isEditingProfile">
        âœï¸ Ã‰diter le profil
      </button>
      <button (click)="downloadReport()" class="btn btn-secondary">
        ğŸ“¥ TÃ©lÃ©charger rapport
      </button>
      <button (click)="exportProfileData()" class="btn btn-secondary">
        ğŸ’¾ Exporter donnÃ©es
      </button>
      <button (click)="logout()" class="btn btn-danger">
        ğŸšª DÃ©connexion
      </button>
    </div>
  </div>

  <!-- Onglets de navigation -->
  <div class="tabs-container">
    <button class="tab-btn"
            [class.active]="activeTab === 'info'"
            (click)="switchTab('info')">
      ğŸ‘¤ Infos personnelles
    </button>
    <button class="tab-btn"
            [class.active]="activeTab === 'stats'"
            (click)="switchTab('stats')">
      ğŸ“Š Statistiques
    </button>
    <button class="tab-btn"
            [class.active]="activeTab === 'activities'"
            (click)="switchTab('activities')">
      ğŸ“‹ ActivitÃ©s
    </button>
    <button class="tab-btn"
            [class.active]="activeTab === 'security'"
            (click)="switchTab('security')">
      ğŸ”’ SÃ©curitÃ©
    </button>
  </div>

  <!-- Contenu des onglets -->
  <div class="tabs-content">

    <!-- ONGLET 1: INFORMATIONS PERSONNELLES -->
    <div *ngIf="activeTab === 'info'" class="tab-pane" [ngIf]="userProfile">

      <!-- Mode affichage -->
      <div *ngIf="!isEditingProfile" class="info-display">
        <div class="info-grid">
          <!-- Ligne 1 -->
          <div class="info-item">
            <span class="label">ğŸ“§ Email</span>
            <span class="value">{{ userProfile.email }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“± TÃ©lÃ©phone</span>
            <span class="value">{{ userProfile.phone }}</span>
          </div>

          <!-- Ligne 2 -->
          <div class="info-item">
            <span class="label">ğŸ“… Date de naissance</span>
            <span class="value">{{ formatDate(userProfile.birthDate) }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“ Adresse</span>
            <span class="value">{{ userProfile.address }}</span>
          </div>

          <!-- Ligne 3 -->
          <div class="info-item">
            <span class="label">ğŸ‘¥ Contact d'urgence</span>
            <span class="value">{{ userProfile.emergencyContact }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“ TÃ©lÃ©phone urgence</span>
            <span class="value">{{ userProfile.emergencyPhone }}</span>
          </div>

          <!-- Ligne 4 -->
          <div class="info-item">
            <span class="label">ğŸ¦ Compte bancaire</span>
            <span class="value">{{ userProfile.bankAccount }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸª Banque</span>
            <span class="value">{{ userProfile.bankName }}</span>
          </div>
        </div>
      </div>

      <!-- Mode Ã©dition -->
      <form *ngIf="isEditingProfile" [formGroup]="profileForm" class="info-edit">
        <!-- PrÃ©nom & Nom -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">PrÃ©nom</label>
            <input type="text" class="form-input" formControlName="firstName">
          </div>
          <div class="form-group">
            <label class="form-label">Nom</label>
            <input type="text" class="form-input" formControlName="lastName">
          </div>
        </div>

        <!-- Email & TÃ©lÃ©phone -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" formControlName="email">
          </div>
          <div class="form-group">
            <label class="form-label">TÃ©lÃ©phone</label>
            <input type="tel" class="form-input" formControlName="phone">
          </div>
        </div>

        <!-- Date naissance & Adresse -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date de naissance</label>
            <input type="date" class="form-input" formControlName="birthDate">
          </div>
          <div class="form-group">
            <label class="form-label">Adresse</label>
            <input type="text" class="form-input" formControlName="address">
          </div>
        </div>

        <!-- Contact urgence -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Contact d'urgence</label>
            <input type="text" class="form-input" formControlName="emergencyContact">
          </div>
          <div class="form-group">
            <label class="form-label">TÃ©lÃ©phone urgence</label>
            <input type="tel" class="form-input" formControlName="emergencyPhone">
          </div>
        </div>

        <!-- Infos bancaires -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Compte bancaire</label>
            <input type="text" class="form-input" formControlName="bankAccount">
          </div>
          <div class="form-group">
            <label class="form-label">Banque</label>
            <input type="text" class="form-input" formControlName="bankName">
          </div>
        </div>

        <!-- Boutons -->
        <div class="form-actions">
          <button type="button" (click)="cancelEditingProfile()" class="btn btn-secondary">
            âœ• Annuler
          </button>
          <button type="button" (click)="saveProfile()"
                  [disabled]="profileForm.invalid"
                  class="btn btn-primary">
            ğŸ’¾ Enregistrer
          </button>
        </div>
      </form>
    </div>

    <!-- ONGLET 2: STATISTIQUES -->
    <div *ngIf="activeTab === 'stats'" class="tab-pane" [ngIf]="userProfile">
      <div class="stats-grid">
        <!-- Ventes totales -->
        <div class="stat-card">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-content">
            <span class="label">Ventes totales</span>
            <span class="value">{{ formatCurrency(userProfile.statistics.totalSales) }}</span>
          </div>
        </div>

        <!-- Heures travaillÃ©es -->
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-content">
            <span class="label">Heures travaillÃ©es</span>
            <span class="value">{{ userProfile.statistics.totalHours }}h</span>
          </div>
        </div>

        <!-- Moyenne par jour -->
        <div class="stat-card">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-content">
            <span class="label">Moyenne/jour</span>
            <span class="value">{{ formatCurrency(userProfile.statistics.averageSalesPerDay) }}</span>
          </div>
        </div>

        <!-- Bonus mensuel -->
        <div class="stat-card">
          <div class="stat-icon">ğŸ</div>
          <div class="stat-content">
            <span class="label">Bonus mensuel</span>
            <span class="value">{{ formatCurrency(userProfile.statistics.monthlyBonus) }}</span>
          </div>
        </div>

        <!-- Performance -->
        <div class="stat-card">
          <div class="stat-icon">â­</div>
          <div class="stat-content">
            <span class="label">Note performance</span>
            <span class="value">{{ userProfile.statistics.performanceRating }}/100</span>
          </div>
        </div>

        <!-- PrÃ©sence -->
        <div class="stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-content">
            <span class="label">Taux prÃ©sence</span>
            <span class="value">{{ userProfile.statistics.attendanceRate }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ONGLET 3: ACTIVITÃ‰S -->
    <div *ngIf="activeTab === 'activities'" class="tab-pane">
      <div class="activities-list">
        <!-- Boucle sur les activitÃ©s affichÃ©es -->
        <div *ngFor="let activity of getDisplayedActivities()" class="activity-item">
          <!-- IcÃ´ne avec badge du type -->
          <div class="activity-badge" [ngClass]="getActivityBadgeClass(activity.type)">
            {{ activity.icon }}
          </div>

          <!-- Contenu de l'activitÃ© -->
          <div class="activity-content">
            <h4>{{ activity.title }}</h4>
            <p>{{ activity.description }}</p>
          </div>

          <!-- Timestamp -->
          <div class="activity-time">
            {{ activity.timestamp }}
          </div>
        </div>

        <!-- Bouton charger plus -->
        <button *ngIf="activitiesDisplayCount < allActivities.length"
                (click)="loadMoreActivities()"
                class="btn btn-secondary btn-block">
          â¬‡ï¸ Charger plus d'activitÃ©s
        </button>
      </div>
    </div>

    <!-- ONGLET 4: SÃ‰CURITÃ‰ -->
    <div *ngIf="activeTab === 'security'" class="tab-pane">
      <div class="security-section">
        <h3>ğŸ”’ Changer le mot de passe</h3>

        <!--  affichage -->
        <div *ngIf="!isChangingPassword" class="security-display">
          <p>Votre mot de passe a Ã©tÃ© mis Ã  jour le <strong>{{ userProfile?.lastUpdateDate }}</strong></p>
          <button (click)="isChangingPassword = true" class="btn btn-primary">
            ğŸ”‘ Changer le mot de passe
          </button>
        </div>

        <!-- Mode Ã©dition -->
        <form *ngIf="isChangingPassword" [formGroup]="passwordForm" class="password-form">
          <!-- Mot de passe actuel -->
          <div class="form-group">
            <label class="form-label">Mot de passe actuel *</label>
            <div class="password-input-container">
              <input [type]="showPasswords ? 'text' : 'password'"
                     class="form-input"
                     formControlName="currentPassword"
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
              <button type="button"
                      (click)="togglePasswordVisibility()"
                      class="btn-toggle-password">
                {{ showPasswords ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
          </div>

          <!-- Nouveau mot de passe -->
          <div class="form-group">
            <label class="form-label">Nouveau mot de passe *</label>
            <div class="password-input-container">
              <input [type]="showPasswords ? 'text' : 'password'"
                     class="form-input"
                     formControlName="newPassword"
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                     (input)="evaluatePasswordStrength()">
              <button type="button"
                      (click)="togglePasswordVisibility()"
                      class="btn-toggle-password">
                {{ showPasswords ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>

            <!-- Indicateur de force -->
            <div class="strength-indicator" [ngClass]="'strength-' + passwordStrength">
              <span>Force: <strong>{{ passwordStrength }}</strong></span>
            </div>
          </div>

          <!-- Confirmation mot de passe -->
          <div class="form-group">
            <label class="form-label">Confirmer le mot de passe *</label>
            <div class="password-input-container">
              <input [type]="showPasswords ? 'text' : 'password'"
                     class="form-input"
                     formControlName="confirmPassword"
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
          </div>

          <!-- Boutons -->
          <div class="form-actions">
            <button type="button"
                    (click)="isChangingPassword = false; passwordForm.reset()"
                    class="btn btn-secondary">
              âœ• Annuler
            </button>
            <button type="button"
                    (click)="changePassword()"
                    [disabled]="passwordForm.invalid"
                    class="btn btn-primary">
              ğŸ” Changer le mot de passe
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
