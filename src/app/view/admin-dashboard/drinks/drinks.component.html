<!-- ========================================
FICHIER: src/app/features/drinks/drinks.component.html
DESCRIPTION: Template HTML pour la gestion des boissons
======================================== -->

<div class="drinks-container">

  <!-- ===== EN-T√äTE DE LA PAGE ===== -->
  <header class="page-header">
    <!-- Titre et description -->
    <div class="header-content">
      <h1 class="page-title">üçæ Mes Boissons</h1>
      <p class="page-subtitle">
        G√©rez votre inventaire de boissons - {{ filteredDrinks.length }} produit(s) affich√©(s)
      </p>
    </div>

    <!-- Bouton d'ajout -->
    <button class="btn btn-primary" (click)="openAddModal()">
      ‚ûï Ajouter une boisson
    </button>
  </header>

  <!-- ===== BARRE DE FILTRES ET RECHERCHE ===== -->
  <section class="filters-section">
    <!-- Barre de recherche -->
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="üîç Rechercher une boisson..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange($event)">
      <!-- Bouton pour effacer la recherche -->
      <button
        *ngIf="searchTerm"
        class="clear-search-btn"
        (click)="searchTerm = ''; onSearchChange('')"
        title="Effacer la recherche">
        ‚úï
      </button>
    </div>

    <!-- S√©lecteur de cat√©gorie -->
    <div class="category-filter">
      <label class="filter-label">Cat√©gorie :</label>
      <select
        class="category-select"
        [(ngModel)]="selectedCategory"
        (ngModelChange)="onCategoryChange($event)">
        <option [ngValue]="null">Toutes les cat√©gories</option>
        <option
          *ngFor="let category of drinkCategories"
          [ngValue]="category">
          {{ category }} ({{ getDrinkCountByCategory(category) }})
        </option>
      </select>
    </div>

    <!-- Bouton de r√©initialisation -->
    <button
      class="btn btn-secondary"
      (click)="resetFilters()"
      *ngIf="selectedCategory || searchTerm">
      üîÑ R√©initialiser
    </button>

    <!-- Options de tri -->
    <div class="sort-options">
      <label class="filter-label">Trier par :</label>
      <div class="sort-buttons">
        <button
          class="sort-btn"
          [class.active]="currentSort === 'name'"
          (click)="changeSortCriteria('name')">
          Nom {{ getSortIcon('name') }}
        </button>
        <button
          class="sort-btn"
          [class.active]="currentSort === 'price'"
          (click)="changeSortCriteria('price')">
          Prix {{ getSortIcon('price') }}
        </button>
        <button
          class="sort-btn"
          [class.active]="currentSort === 'stock'"
          (click)="changeSortCriteria('stock')">
          Stock {{ getSortIcon('stock') }}
        </button>
        <button
          class="sort-btn"
          [class.active]="currentSort === 'sales'"
          (click)="changeSortCriteria('sales')">
          Ventes {{ getSortIcon('sales') }}
        </button>
      </div>
    </div>
  </section>

  <!-- ===== INDICATEUR DE CHARGEMENT ===== -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Chargement des boissons...</p>
  </div>

  <!-- ===== MESSAGE SI AUCUN R√âSULTAT ===== -->
  <div *ngIf="!isLoading && filteredDrinks.length === 0" class="no-results">
    <div class="no-results-icon">üîç</div>
    <h3>Aucune boisson trouv√©e</h3>
    <p *ngIf="searchTerm || selectedCategory">
      Essayez de modifier vos crit√®res de recherche
    </p>
    <p *ngIf="!searchTerm && !selectedCategory">
      Commencez par ajouter votre premi√®re boisson
    </p>
    <button class="btn btn-primary" (click)="openAddModal()">
      ‚ûï Ajouter une boisson
    </button>
  </div>

  <!-- ===== GRILLE DES BOISSONS ===== -->
  <section *ngIf="!isLoading && filteredDrinks.length > 0" class="drinks-grid">
    <!-- Boucle sur chaque boisson -->
    <article
      *ngFor="let drink of filteredDrinks"
      class="drink-card"
      [class.critical-stock]="isCriticalStock(drink.stock)">

      <!-- Badge HOT ou NEW -->
      <span
        *ngIf="drink.badge"
        class="drink-badge"
        [ngClass]="'badge-' + drink.badge">
        {{ drink.badge === 'hot' ? 'üî• HOT' : '‚ú® NEW' }}
      </span>

      <!-- Badge de stock critique -->
      <span
        *ngIf="isCriticalStock(drink.stock)"
        class="stock-alert-badge">
        ‚ö†Ô∏è Stock faible
      </span>

      <!-- Image/Ic√¥ne de la boisson -->
      <div class="drink-image">
        <div class="drink-icon">{{ drink.icon }}</div>
      </div>

      <!-- Informations de la boisson -->
      <div class="drink-info">
        <!-- Nom -->
        <h3 class="drink-name">{{ drink.name }}</h3>

        <!-- Cat√©gorie -->
        <p class="drink-category" [ngClass]="getCategoryClass(drink.category)">
          {{ drink.category }}
        </p>

        <!-- Description (si disponible) -->
        <p *ngIf="drink.description" class="drink-description">
          {{ drink.description }}
        </p>

        <!-- Statistiques -->
        <div class="drink-stats">
          <!-- Prix -->
          <div class="stat-item">
            <span class="stat-icon">üí∞</span>
            <span class="stat-value">{{ formatNumber(drink.price) }} FCFA</span>
          </div>

          <!-- Stock -->
          <div class="stat-item">
            <span class="stat-icon">üì¶</span>
            <span class="stat-value">
              {{ drink.stock }}
              <span [ngClass]="getStockBadge(drink.stock).class" class="stock-badge">
                {{ getStockBadge(drink.stock).label }}
              </span>
            </span>
          </div>

          <!-- Ventes (si disponible) -->
          <div *ngIf="drink.sales" class="stat-item">
            <span class="stat-icon">üìä</span>
            <span class="stat-value">{{ drink.sales }} ventes</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="drink-actions">
        <button
          class="btn-icon btn-edit"
          (click)="openEditModal(drink)"
          title="Modifier">
          ‚úèÔ∏è
        </button>
        <button
          class="btn-icon btn-view"
          title="Voir les d√©tails">
          üëÅÔ∏è
        </button>
        <button
          class="btn-icon btn-delete"
          (click)="deleteDrink(drink)"
          title="Supprimer">
          üóëÔ∏è
        </button>
      </div>
    </article>
  </section>

  <!-- ===== MODAL AJOUT/MODIFICATION ===== -->
  <div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">

      <!-- En-t√™te du modal -->
      <header class="modal-header">
        <h2 class="modal-title">
          {{ selectedDrink ? '‚úèÔ∏è Modifier une boisson' : '‚ûï Ajouter une boisson' }}
        </h2>
        <button class="modal-close-btn" (click)="closeModal()">‚úï</button>
      </header>

      <!-- Corps du modal -->
      <div class="modal-body">
        <form class="drink-form">

          <!-- Nom de la boisson -->
          <div class="form-group">
            <label class="form-label" for="drink-name">
              Nom de la boisson <span class="required">*</span>
            </label>
            <input
              type="text"
              id="drink-name"
              class="form-input"
              [(ngModel)]="drinkForm.name"
              name="name"
              placeholder="Ex: Ch√¢teau Margaux 2015"
              required>
          </div>

          <!-- Cat√©gorie -->
          <div class="form-group">
            <label class="form-label" for="drink-category">
              Cat√©gorie <span class="required">*</span>
            </label>
            <select
              id="drink-category"
              class="form-input"
              [(ngModel)]="drinkForm.category"
              name="category"
              required>
              <option *ngFor="let category of drinkCategories" [value]="category">
                {{ category }}
              </option>
            </select>
          </div>

          <!-- Grille pour Prix et Stock -->
          <div class="form-row">
            <!-- Prix -->
            <div class="form-group">
              <label class="form-label" for="drink-price">
                Prix (FCFA) <span class="required">*</span>
              </label>
              <input
                type="number"
                id="drink-price"
                class="form-input"
                [(ngModel)]="drinkForm.price"
                name="price"
                min="0"
                placeholder="Ex: 15000"
                required>
            </div>

            <!-- Stock -->
            <div class="form-group">
              <label class="form-label" for="drink-stock">
                Stock <span class="required">*</span>
              </label>
              <input
                type="number"
                id="drink-stock"
                class="form-input"
                [(ngModel)]="drinkForm.stock"
                name="stock"
                min="0"
                placeholder="Ex: 50"
                required>
            </div>
          </div>

          <!-- Ic√¥ne -->
          <div class="form-group">
            <label class="form-label" for="drink-icon">
              Ic√¥ne (Emoji)
            </label>
            <input
              type="text"
              id="drink-icon"
              class="form-input"
              [(ngModel)]="drinkForm.icon"
              name="icon"
              placeholder="Ex: üç∑"
              maxlength="2">
            <small class="form-hint">
              Choisissez un emoji pour repr√©senter la boisson
            </small>
          </div>

          <!-- Description -->
          <div class="form-group">
            <label class="form-label" for="drink-description">
              Description
            </label>
            <textarea
              id="drink-description"
              class="form-textarea"
              [(ngModel)]="drinkForm.description"
              name="description"
              rows="4"
              placeholder="Ajoutez une description d√©taill√©e de la boisson..."></textarea>
          </div>

        </form>
      </div>

      <!-- Pied du modal -->
      <footer class="modal-footer">
        <button class="btn btn-cancel" (click)="closeModal()">
          Annuler
        </button>
        <button class="btn btn-primary" (click)="saveDrink()">
          {{ selectedDrink ? 'üíæ Enregistrer' : '‚ûï Ajouter' }}
        </button>
      </footer>

    </div>
  </div>

</div>
