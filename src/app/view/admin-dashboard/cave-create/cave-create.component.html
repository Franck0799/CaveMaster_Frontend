<!-- ===== FICHIER: cave-create.component.html ===== -->
<!-- Template HTML pour la gestion des caves -->

<div class="cave-create-container">

  <!-- Message de feedback (succÃ¨s, erreur, info) -->
  <div *ngIf="message"
       class="alert"
       [ngClass]="'alert-' + messageType">
    {{ message }}
  </div>

  <!-- En-tÃªte avec titre et bouton d'annulation -->
  <div class="section-header">
    <h2>ğŸ· Gestion des Caves</h2>
    <!-- Bouton d'annulation visible en mode Ã©dition -->
    <button *ngIf="isEditing"
            (click)="resetForm()"
            class="btn btn-secondary">
      â†» Annuler l'Ã©dition
    </button>
  </div>

  <!-- Conteneur du formulaire -->
  <div class="form-container">
    <form [formGroup]="caveForm" (ngSubmit)="submitForm()">

      <!-- Champ Nom de la cave -->
      <div class="form-group">
        <label class="form-label">Nom de la cave *</label>
        <!-- Input avec validation en temps rÃ©el -->
        <input
          type="text"
          class="form-input"
          formControlName="name"
          placeholder="Ex: Cave Principale"
          [class.input-error]="isFieldInvalid('name')">
        <!-- Message d'erreur de validation -->
        <small *ngIf="isFieldInvalid('name')" class="error-text">
          âš ï¸ Minimum 3 caractÃ¨res requis
        </small>
      </div>

      <!-- Champ Localisation -->
      <div class="form-group">
        <label class="form-label">Localisation *</label>
        <!-- Select dropdown avec liste de rÃ©gions -->
        <select
          class="form-input"
          formControlName="location"
          [class.input-error]="isFieldInvalid('location')">
          <option value="">SÃ©lectionner une rÃ©gion...</option>
          <!-- Boucle sur les rÃ©gions disponibles -->
          <option *ngFor="let region of regions" [value]="region">
            ğŸ“ {{ region }}
          </option>
        </select>
      </div>

      <!-- Champ CapacitÃ© -->
      <div class="form-group">
        <label class="form-label">CapacitÃ© (bouteilles) *</label>
        <!-- Input numÃ©rique avec min -->
        <input
          type="number"
          class="form-input"
          formControlName="capacity"
          placeholder="Ex: 500"
          min="1"
          [class.input-error]="isFieldInvalid('capacity')">
      </div>

      <!-- Champ Description -->
      <div class="form-group">
        <label class="form-label">Description</label>
        <!-- Textarea pour description plus longue -->
        <textarea
          class="form-textarea"
          formControlName="description"
          placeholder="Description dÃ©taillÃ©e de la cave..."
          rows="4"></textarea>
      </div>

      <!-- Boutons d'action du formulaire -->
      <div class="form-actions">
        <!-- Bouton rÃ©initialiser -->
        <button type="reset" class="btn btn-secondary">
          â†» RÃ©initialiser
        </button>
        <!-- Bouton soumettre (texte diffÃ©rent selon le mode) -->
        <button type="submit"
                class="btn btn-primary"
                [disabled]="caveForm.invalid">
          {{ isEditing ? 'ğŸ’¾ Mettre Ã  jour' : 'â• CrÃ©er cave' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Conteneur de la liste des caves -->
  <div class="caves-list-container">
    <h3>ğŸ“‹ Caves existantes ({{ caves.length }})</h3>

    <!-- Grille de cartes des caves -->
    <div class="caves-grid">
      <!-- Boucle sur chaque cave -->
      <div *ngFor="let cave of caves" class="cave-item">

        <!-- En-tÃªte de la carte avec nom et localisation -->
        <div class="cave-item-header">
          <div>
            <h4>{{ cave.name }}</h4>
            <p class="cave-location">ğŸ“ {{ cave.location }}</p>
          </div>
          <!-- Badge montrant le taux d'occupation -->
          <div class="occupancy-badge">
            {{ getOccupancyRate(cave) }}%
          </div>
        </div>

        <!-- Statistiques de la cave (grille) -->
        <div class="cave-stats">
          <!-- CapacitÃ© -->
          <div class="stat">
            <span class="label">ğŸ¾ CapacitÃ©:</span>
            <span class="value">{{ cave.capacity }}</span>
          </div>
          <!-- Nombre de managers -->
          <div class="stat">
            <span class="label">ğŸ‘¥ Managers:</span>
            <span class="value">{{ cave.managersCount }}</span>
          </div>
          <!-- Nombre d'employÃ©s -->
          <div class="stat">
            <span class="label">ğŸ‘¨â€ğŸ’¼ EmployÃ©s:</span>
            <span class="value">{{ cave.employeesCount }}</span>
          </div>
        </div>

        <!-- Description de la cave -->
        <p class="cave-description">{{ cave.description }}</p>

        <!-- Boutons d'action (Ã©diter, supprimer) -->
        <div class="cave-item-actions">
          <!-- Bouton Ã©diter -->
          <button (click)="editCave(cave)" class="btn btn-secondary btn-sm">
            âœï¸ Ã‰diter
          </button>
          <!-- Bouton supprimer avec confirmation -->
          <button (click)="deleteCave(cave.id)" class="btn btn-danger btn-sm">
            ğŸ—‘ï¸ Supprimer
          </button>
        </div>
      </div>

      <!-- Message affichÃ© si aucune cave n'existe -->
      <div *ngIf="caves.length === 0" class="empty-state">
        <p>ğŸ“­ Aucune cave crÃ©Ã©e. Commencez par en crÃ©er une!</p>
      </div>
    </div>
  </div>
</div>
