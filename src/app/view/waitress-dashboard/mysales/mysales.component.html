<!-- ==========================================
FICHIER: src/app/server/my-sales/my-sales.component.html
DESCRIPTION: Statistiques et historique des ventes personnelles
========================================== -->

<div class="my-sales-page">

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">ðŸ“Š Mes Ventes</h1>
      <p class="page-subtitle">Suivez vos performances et statistiques</p>
    </div>
    <div class="header-right">
      <div class="period-selector">
        <button
          class="period-btn"
          [class.active]="selectedPeriod === 'today'"
          (click)="selectPeriod('today')">
          Aujourd'hui
        </button>
        <button
          class="period-btn"
          [class.active]="selectedPeriod === 'week'"
          (click)="selectPeriod('week')">
          Cette semaine
        </button>
        <button
          class="period-btn"
          [class.active]="selectedPeriod === 'month'"
          (click)="selectPeriod('month')">
          Ce mois
        </button>
      </div>
      <button class="btn-export" (click)="exportData()">
        <i class="icon download-icon"></i>
        Exporter
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div
      *ngFor="let stat of dailyStats"
      class="stat-card"
      [class]="'stat-' + stat.color">
      <div class="stat-icon">
        <i class="icon" [class]="'icon-' + stat.icon"></i>
      </div>
      <div class="stat-content">
        <span class="stat-label">{{ stat.label }}</span>
        <div class="stat-value-row">
          <h3 class="stat-value">{{ stat.value }}</h3>
          <span class="stat-change" *ngIf="stat.change" [class.positive]="stat.trend === 'up'">
            <i class="icon" [class.arrow-up-icon]="stat.trend === 'up'" [class.arrow-down-icon]="stat.trend === 'down'"></i>
            {{ stat.change }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="content-layout">

    <!-- LEFT COLUMN -->
    <div class="left-column">

      <!-- Sales Chart -->
      <div class="chart-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="icon bar-chart-icon"></i>
            Ventes par heure
          </h2>
        </div>
        <div class="chart-container">
          <div class="chart-bars">
            <div
              *ngFor="let sale of hourlySales"
              class="chart-bar-wrapper">
              <div class="chart-bar">
                <div
                  class="bar-fill"
                  [style.height.%]="getChartBarHeight(sale.value)">
                </div>
                <span class="bar-value">{{ sale.value }} â‚¬</span>
              </div>
              <span class="bar-label">{{ sale.label }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales History -->
      <div class="history-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="icon clock-icon"></i>
            Historique des ventes
          </h2>
          <span class="total-count">{{ salesHistory.length }} ventes</span>
        </div>

        <div class="history-list">
          <div
            *ngFor="let sale of salesHistory"
            class="history-item"
            (click)="viewSaleDetails(sale)">

            <div class="item-header">
              <div class="item-info">
                <h4 class="table-number">{{ sale.tableNumber }}</h4>
                <span class="sale-time">{{ formatTime(sale.date) }}</span>
              </div>
              <span class="sale-amount">{{ sale.amount | number:'1.2-2' }} â‚¬</span>
            </div>

            <div class="item-details">
              <div class="detail-item">
                <i class="icon shopping-bag-icon"></i>
                <span>{{ sale.items }} articles</span>
              </div>
              <div class="detail-item">
                <i class="icon credit-card-icon"></i>
                <span>{{ sale.paymentMethod }}</span>
              </div>
              <div class="detail-item">
                <i class="icon clock-icon"></i>
                <span>{{ formatDuration(sale.duration) }}</span>
              </div>
              <div class="detail-item tip" *ngIf="sale.tip > 0">
                <i class="icon gift-icon"></i>
                <span>{{ sale.tip | number:'1.2-2' }} â‚¬</span>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div class="empty-history" *ngIf="salesHistory.length === 0">
            <i class="icon inbox-icon"></i>
            <p>Aucune vente enregistrÃ©e</p>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-column">

      <!-- Summary Stats -->
      <div class="summary-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="icon pie-chart-icon"></i>
            RÃ©sumÃ©
          </h2>
        </div>

        <div class="summary-items">
          <div class="summary-item">
            <div class="summary-icon total">
              <i class="icon dollar-sign-icon"></i>
            </div>
            <div class="summary-content">
              <span class="summary-label">Total des ventes</span>
              <span class="summary-value">{{ getTotalSales() | number:'1.2-2' }} â‚¬</span>
            </div>
          </div>

          <div class="summary-item">
            <div class="summary-icon average">
              <i class="icon trending-up-icon"></i>
            </div>
            <div class="summary-content">
              <span class="summary-label">Panier moyen</span>
              <span class="summary-value">{{ getAverageTicket() | number:'1.2-2' }} â‚¬</span>
            </div>
          </div>

          <div class="summary-item">
            <div class="summary-icon tips">
              <i class="icon gift-icon"></i>
            </div>
            <div class="summary-content">
              <span class="summary-label">Total pourboires</span>
              <span class="summary-value">{{ getTotalTips() | number:'1.2-2' }} â‚¬</span>
            </div>
          </div>

          <div class="summary-item">
            <div class="summary-icon duration">
              <i class="icon clock-icon"></i>
            </div>
            <div class="summary-content">
              <span class="summary-label">DurÃ©e moyenne</span>
              <span class="summary-value">{{ formatDuration(getAverageDuration()) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Leaderboard -->
      <div class="leaderboard-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="icon trophy-icon"></i>
            Classement du jour
          </h2>
        </div>

        <div class="leaderboard-list">
          <div
            *ngFor="let entry of leaderboard"
            class="leaderboard-item"
            [class.current-user]="entry.isCurrentUser">

            <div class="rank-badge" [class]="'rank-' + entry.rank">
              <span class="medal" *ngIf="entry.rank <= 3">{{ getMedalIcon(entry.rank) }}</span>
              <span class="rank-number" *ngIf="entry.rank > 3">{{ entry.rank }}</span>
            </div>

            <div class="player-info">
              <span class="player-name">
                {{ entry.serverName }}
                <span class="you-badge" *ngIf="entry.isCurrentUser">Vous</span>
              </span>
              <div class="player-stats">
                <span class="stat">
                  <i class="icon dollar-sign-icon"></i>
                  {{ entry.sales | number:'1.0-0' }} â‚¬
                </span>
                <span class="stat">
                  <i class="icon shopping-cart-icon"></i>
                  {{ entry.orders }}
                </span>
                <span class="stat">
                  <i class="icon gift-icon"></i>
                  {{ entry.tips | number:'1.0-0' }} â‚¬
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Methods -->
      <div class="payment-methods-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="icon credit-card-icon"></i>
            Modes de paiement
          </h2>
        </div>

        <div class="payment-breakdown">
          <div
            *ngFor="let sale of salesHistory"
            class="payment-item">
            <div class="payment-icon">
              <i class="icon" [class]="'icon-' + getPaymentMethodIcon(sale.paymentMethod)"></i>
            </div>
            <span class="payment-method">{{ sale.paymentMethod }}</span>
            <span class="payment-count">1</span>
          </div>
        </div>
      </div>

    </div>

  </div>

</div>
