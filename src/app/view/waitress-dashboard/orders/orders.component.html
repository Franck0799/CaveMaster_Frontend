<!-- ==========================================
FICHIER: src/app/server/orders/orders.component.html
DESCRIPTION: Prise de commande avec carte interactive
========================================== -->

<div class="orders-page">

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="btn-back" routerLink="/server/tables">
        <i class="icon arrow-left-icon"></i>
      </button>
      <div>
        <h1 class="page-title">Prendre une Commande</h1>
        <p class="page-subtitle" *ngIf="tableNumber">Table {{ tableNumber }}</p>
      </div>
    </div>
    <div class="header-right">
      <button class="btn-wine-help" (click)="goToWineSuggestions()" *ngIf="cart.length > 0">
        <i class="icon wine-icon"></i>
        Suggestions Vins
      </button>
    </div>
  </div>

  <div class="orders-layout">

    <!-- LEFT: Menu Items -->
    <div class="menu-section">

      <!-- Search Bar -->
      <div class="search-bar">
        <i class="icon search-icon"></i>
        <input
          type="text"
          placeholder="Rechercher un plat, un vin..."
          [(ngModel)]="searchQuery"
          (input)="filterItems()">
      </div>

      <!-- Categories -->
      <div class="categories-bar">
        <button
          *ngFor="let category of categories"
          class="category-btn"
          [class.active]="selectedCategory === category.id"
          (click)="selectCategory(category.id)">
          <i class="icon" [class]="'icon-' + category.icon"></i>
          <span>{{ category.name }}</span>
          <span class="category-count">{{ category.count }}</span>
        </button>
      </div>

      <!-- Menu Items Grid -->
      <div class="menu-items-grid">
        <div
          *ngFor="let item of filteredItems"
          class="menu-item-card"
          [class.unavailable]="!item.available"
          (click)="addToCart(item)">

          <div class="item-image" *ngIf="item.image">
            <img [src]="item.image" [alt]="item.name">
          </div>
          <div class="item-image placeholder" *ngIf="!item.image">
            <i class="icon" [class]="item.isWine ? 'wine-icon' : 'utensils-icon'"></i>
          </div>

          <div class="item-content">
            <h3 class="item-name">{{ item.name }}</h3>
            <p class="item-description" *ngIf="item.description">{{ item.description }}</p>

            <div class="item-footer">
              <span class="item-price">{{ item.price | number:'1.2-2' }} €</span>
              <button class="btn-add-item" *ngIf="item.available">
                <i class="icon plus-icon"></i>
              </button>
              <span class="badge-unavailable" *ngIf="!item.available">Indisponible</span>
            </div>

            <!-- Wine specific info -->
            <div class="wine-info" *ngIf="item.isWine">
              <span class="wine-type">{{ getWineTypeIcon(item.wineType) }} {{ item.year }}</span>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredItems.length === 0">
          <i class="icon search-x-icon"></i>
          <p>Aucun article trouvé</p>
        </div>
      </div>
    </div>

    <!-- RIGHT: Cart -->
    <div class="cart-section">
      <div class="cart-header">
        <h2 class="cart-title">
          <i class="icon shopping-cart-icon"></i>
          Panier ({{ getCartItemsCount() }})
        </h2>
        <button class="btn-clear-cart" (click)="clearCart()" *ngIf="cart.length > 0">
          <i class="icon trash-icon"></i>
        </button>
      </div>

      <!-- Cart Items -->
      <div class="cart-items" *ngIf="cart.length > 0">
        <div *ngFor="let item of cart; let i = index" class="cart-item">
          <div class="cart-item-header">
            <h4 class="cart-item-name">{{ item.menuItem.name }}</h4>
            <button class="btn-remove-item" (click)="removeFromCart(i)">
              <i class="icon x-icon"></i>
            </button>
          </div>

          <div class="cart-item-details">
            <span class="item-unit-price">{{ item.menuItem.price | number:'1.2-2' }} €</span>

            <div class="quantity-controls">
              <button class="btn-qty" (click)="updateQuantity(i, -1)">
                <i class="icon minus-icon"></i>
              </button>
              <span class="quantity">{{ item.quantity }}</span>
              <button class="btn-qty" (click)="updateQuantity(i, 1)">
                <i class="icon plus-icon"></i>
              </button>
            </div>

            <span class="item-total-price">{{ (item.menuItem.price * item.quantity) | number:'1.2-2' }} €</span>
          </div>

          <!-- Notes -->
          <div class="cart-item-notes" *ngIf="item.notes">
            <i class="icon message-circle-icon"></i>
            <span>{{ item.notes }}</span>
          </div>
          <button class="btn-add-note" (click)="addNoteToItem(i)" *ngIf="!item.notes">
            <i class="icon edit-icon"></i>
            Ajouter une note
          </button>
        </div>
      </div>

      <!-- Empty Cart State -->
      <div class="cart-empty" *ngIf="cart.length === 0">
        <i class="icon shopping-cart-icon"></i>
        <p>Le panier est vide</p>
        <span>Ajoutez des articles pour commencer</span>
      </div>

      <!-- Wine Suggestion Alert -->
      <div class="wine-suggestion-alert" *ngIf="showWineSuggestions">
        <div class="alert-content">
          <i class="icon wine-icon"></i>
          <div>
            <strong>Suggestion de vins</strong>
            <p>Proposez un accord mets-vins à vos clients</p>
          </div>
        </div>
        <button class="btn-view-wines" (click)="goToWineSuggestions()">
          Voir les vins
        </button>
        <button class="btn-dismiss" (click)="showWineSuggestions = false">
          <i class="icon x-icon"></i>
        </button>
      </div>

      <!-- Cart Summary -->
      <div class="cart-summary" *ngIf="cart.length > 0">
        <div class="summary-row">
          <span class="summary-label">Articles</span>
          <span class="summary-value">{{ getCartItemsCount() }}</span>
        </div>
        <div class="summary-row total">
          <span class="summary-label">Total</span>
          <span class="summary-value">{{ getCartTotal() | number:'1.2-2' }} €</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="cart-actions">
        <button
          class="btn-send-order"
          (click)="sendToKitchen()"
          [disabled]="cart.length === 0">
          <i class="icon send-icon"></i>
          Envoyer en Cuisine
        </button>
      </div>
    </div>

  </div>
</div>
