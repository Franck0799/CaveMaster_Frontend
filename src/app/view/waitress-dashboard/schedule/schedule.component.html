<!-- ==========================================
FICHIER: src/app/server/schedule/schedule.component.html
DESCRIPTION: Planning de travail et demandes de cong√©s
========================================== -->

<div class="schedule-page">

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">üìÖ Mon Planning</h1>
      <p class="page-subtitle">Horaires de travail et demandes de cong√©s</p>
    </div>
    <div class="header-right">
      <button class="btn-toggle-view" (click)="toggleViewMode()">
        <i class="icon" [class.calendar-icon]="viewMode === 'list'" [class.list-icon]="viewMode === 'calendar'"></i>
        {{ viewMode === 'calendar' ? 'Vue Liste' : 'Vue Calendrier' }}
      </button>
      <button class="btn-request-leave" (click)="openLeaveModal()">
        <i class="icon plus-icon"></i>
        Demander un cong√©
      </button>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-item">
      <div class="stat-icon hours">
        <i class="icon clock-icon"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ getTotalHoursThisMonth() }}h</span>
        <span class="stat-label">Heures ce mois</span>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon days">
        <i class="icon calendar-icon"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ getScheduledDaysThisMonth() }}</span>
        <span class="stat-label">Jours travaill√©s</span>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon leaves">
        <i class="icon briefcase-icon"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ leaveRequests.length }}</span>
        <span class="stat-label">Demandes de cong√©s</span>
      </div>
    </div>
  </div>

  <!-- Calendar View -->
  <div class="calendar-view" *ngIf="viewMode === 'calendar'">

    <!-- Calendar Header -->
    <div class="calendar-header">
      <button class="btn-nav" (click)="previousMonth()">
        <i class="icon chevron-left-icon"></i>
      </button>
      <h2 class="month-title">{{ getMonthName() }}</h2>
      <button class="btn-nav" (click)="nextMonth()">
        <i class="icon chevron-right-icon"></i>
      </button>
      <button class="btn-today" (click)="goToToday()">
        Aujourd'hui
      </button>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
      <!-- Week days header -->
      <div class="calendar-weekdays">
        <div *ngFor="let day of weekDays" class="weekday">
          {{ day }}
        </div>
      </div>

      <!-- Calendar days -->
      <div class="calendar-days">
        <div
          *ngFor="let dayCell of currentMonth.days"
          class="calendar-day"
          [class.other-month]="!dayCell.isCurrentMonth"
          [class.today]="dayCell.isToday"
          [class.has-shift]="dayCell.shift"
          [class.has-leave]="dayCell.leaveRequest">

          <div class="day-number">{{ dayCell.dayNumber }}</div>

          <!-- Shift indicator -->
          <div class="day-content" *ngIf="dayCell.shift">
            <div
              class="shift-badge"
              [class]="'shift-' + getShiftTypeColor(dayCell.shift.type)">
              <i class="icon clock-icon"></i>
              <span>{{ dayCell.shift.startTime }} - {{ dayCell.shift.endTime }}</span>
              <span class="shift-type">{{ getShiftTypeLabel(dayCell.shift.type) }}</span>
            </div>
          </div>

          <!-- Leave indicator -->
          <div class="day-content" *ngIf="dayCell.leaveRequest">
            <div
              class="leave-badge"
              [class]="'leave-' + getLeaveStatusColor(dayCell.leaveRequest.status)">
              <i class="icon briefcase-icon"></i>
              <span>{{ getLeaveTypeLabel(dayCell.leaveRequest.type) }}</span>
              <span class="leave-status">{{ getLeaveStatusLabel(dayCell.leaveRequest.status) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Legend -->
    <div class="calendar-legend">
      <div class="legend-item">
        <span class="legend-dot shift-morning"></span>
        <span>Service matin</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot shift-evening"></span>
        <span>Service soir</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot shift-full-day"></span>
        <span>Journ√©e compl√®te</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot leave-approved"></span>
        <span>Cong√© approuv√©</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot leave-pending"></span>
        <span>Cong√© en attente</span>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="list-view" *ngIf="viewMode === 'list'">

    <!-- Upcoming Shifts -->
    <div class="list-section">
      <h2 class="section-title">
        <i class="icon calendar-icon"></i>
        Prochains services
      </h2>
      <div class="shifts-list">
        <div
          *ngFor="let shift of shifts"
          class="shift-item"
          [class]="'shift-' + shift.status">

          <div class="shift-date">
            <span class="date-day">{{ shift.date | date:'dd' }}</span>
            <span class="date-month">{{ shift.date | date:'MMM' }}</span>
          </div>

          <div class="shift-details">
            <div class="shift-header">
              <h3 class="shift-title">{{ getShiftTypeLabel(shift.type) }}</h3>
              <span
                class="shift-status-badge"
                [class]="'status-' + shift.status">
                {{ shift.status === 'scheduled' ? 'Planifi√©' : shift.status === 'completed' ? 'Effectu√©' : 'Annul√©' }}
              </span>
            </div>
            <div class="shift-time">
              <i class="icon clock-icon"></i>
              <span>{{ shift.startTime }} - {{ shift.endTime }}</span>
              <span class="shift-duration">({{ shift.duration }}h)</span>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-shifts" *ngIf="shifts.length === 0">
          <i class="icon calendar-x-icon"></i>
          <p>Aucun service planifi√©</p>
        </div>
      </div>
    </div>

    <!-- Leave Requests -->
    <div class="list-section">
      <h2 class="section-title">
        <i class="icon briefcase-icon"></i>
        Demandes de cong√©s
      </h2>
      <div class="leaves-list">
        <div
          *ngFor="let leave of leaveRequests"
          class="leave-item"
          [class]="'leave-' + leave.status">

          <div class="leave-icon">
            <i class="icon" [class.check-circle-icon]="leave.status === 'approved'" [class.clock-icon]="leave.status === 'pending'" [class.x-circle-icon]="leave.status === 'rejected'"></i>
          </div>

          <div class="leave-details">
            <div class="leave-header">
              <h3 class="leave-type">{{ getLeaveTypeLabel(leave.type) }}</h3>
              <span
                class="leave-status-badge"
                [class]="'status-' + getLeaveStatusColor(leave.status)">
                {{ getLeaveStatusLabel(leave.status) }}
              </span>
            </div>
            <div class="leave-dates">
              <i class="icon calendar-icon"></i>
              <span>Du {{ leave.startDate | date:'dd/MM/yyyy' }} au {{ leave.endDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="leave-reason" *ngIf="leave.reason">
              <i class="icon message-circle-icon"></i>
              <span>{{ leave.reason }}</span>
            </div>
            <div class="leave-submitted">
              <span>Demand√© le {{ leave.submittedDate | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>

          <div class="leave-actions" *ngIf="leave.status === 'pending'">
            <button class="btn-cancel-leave" (click)="cancelLeaveRequest(leave)">
              <i class="icon x-icon"></i>
              Annuler
            </button>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-leaves" *ngIf="leaveRequests.length === 0">
          <i class="icon inbox-icon"></i>
          <p>Aucune demande de cong√©</p>
        </div>
      </div>
    </div>

  </div>

</div>

<!-- Leave Request Modal -->
<div class="modal-overlay" *ngIf="showLeaveModal" (click)="closeLeaveModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Nouvelle demande de cong√©</h2>
      <button class="btn-close-modal" (click)="closeLeaveModal()">
        <i class="icon x-icon"></i>
      </button>
    </div>

    <div class="modal-body">
      <form class="leave-form">
        <div class="form-group">
          <label>Type de cong√©</label>
          <select [(ngModel)]="newLeaveRequest.type" name="type" required>
            <option value="vacation">Cong√©s pay√©s</option>
            <option value="sick">Maladie</option>
            <option value="personal">Personnel</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Date de d√©but</label>
            <input
              type="date"
              [(ngModel)]="newLeaveRequest.startDate"
              name="startDate"
              required>
          </div>
          <div class="form-group">
            <label>Date de fin</label>
            <input
              type="date"
              [(ngModel)]="newLeaveRequest.endDate"
              name="endDate"
              required>
          </div>
        </div>

        <div class="form-group">
          <label>Raison (optionnel)</label>
          <textarea
            [(ngModel)]="newLeaveRequest.reason"
            name="reason"
            rows="4"
            placeholder="Expliquez bri√®vement la raison de votre demande..."></textarea>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn-modal-cancel" (click)="closeLeaveModal()">
        Annuler
      </button>
      <button class="btn-modal-submit" (click)="submitLeaveRequest()">
        <i class="icon send-icon"></i>
        Envoyer la demande
      </button>
    </div>
  </div>
</div>
