<!-- ==========================================
FICHIER: src/app/server/tables/tables.component.html
DESCRIPTION: Template de gestion des tables
========================================== -->

<div class="tables-page">

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">Gestion des Tables</h1>
      <p class="page-subtitle">Plan de salle et statuts en temps réel</p>
    </div>
    <div class="header-right">
      <button class="btn-toggle-view" (click)="toggleViewMode()">
        <i class="icon" [class.grid-icon]="viewMode === 'list'" [class.list-icon]="viewMode === 'plan'"></i>
        {{ viewMode === 'plan' ? 'Vue Liste' : 'Vue Plan' }}
      </button>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-item stat-total">
      <i class="icon grid-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.total }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>
    <div class="stat-item stat-free">
      <i class="icon check-circle-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.free }}</span>
        <span class="stat-label">Libres</span>
      </div>
    </div>
    <div class="stat-item stat-occupied">
      <i class="icon users-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.occupied }}</span>
        <span class="stat-label">Occupées</span>
      </div>
    </div>
    <div class="stat-item stat-reserved">
      <i class="icon bookmark-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.reserved }}</span>
        <span class="stat-label">Réservées</span>
      </div>
    </div>
    <div class="stat-item stat-billing">
      <i class="icon credit-card-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.billing }}</span>
        <span class="stat-label">Addition</span>
      </div>
    </div>
    <div class="stat-item stat-my">
      <i class="icon user-check-icon"></i>
      <div class="stat-content">
        <span class="stat-value">{{ stats.myTables }}</span>
        <span class="stat-label">Mes tables</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="filter-group">
      <label>Statut</label>
      <select [(ngModel)]="filters.status" (change)="applyFilters()">
        <option value="all">Tous</option>
        <option value="free">Libres</option>
        <option value="occupied">Occupées</option>
        <option value="reserved">Réservées</option>
        <option value="billing">Addition</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Places</label>
      <select [(ngModel)]="filters.seats" (change)="applyFilters()">
        <option value="all">Toutes</option>
        <option value="2">2 places</option>
        <option value="4">4 places</option>
        <option value="6">6 places</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Serveur</label>
      <select [(ngModel)]="filters.server" (change)="applyFilters()">
        <option value="all">Tous</option>
        <option value="my">Mes tables</option>
        <option value="other">Autres serveurs</option>
      </select>
    </div>
    <button class="btn-reset" (click)="resetFilters()">
      <i class="icon x-icon"></i>
      Réinitialiser
    </button>
  </div>

  <!-- Plan View -->
  <div class="tables-content" *ngIf="viewMode === 'plan'">
    <div class="plan-container">
      <div class="plan-legend">
        <div class="legend-item legend-free">
          <span class="legend-dot"></span>
          <span>Libre</span>
        </div>
        <div class="legend-item legend-occupied">
          <span class="legend-dot"></span>
          <span>Occupée</span>
        </div>
        <div class="legend-item legend-reserved">
          <span class="legend-dot"></span>
          <span>Réservée</span>
        </div>
        <div class="legend-item legend-billing">
          <span class="legend-dot"></span>
          <span>Addition</span>
        </div>
      </div>

      <div class="plan-view">
        <div
          *ngFor="let table of filteredTables"
          class="table-item"
          [class]="'table-' + table.status"
          [class.selected]="selectedTable?.id === table.id"
          [style.left.px]="table.x"
          [style.top.px]="table.y"
          (click)="selectTable(table)">
          <div class="table-number">{{ table.number }}</div>
          <div class="table-seats">
            <i class="icon user-icon"></i>
            {{ table.seats }}
          </div>
          <div class="table-server" *ngIf="table.serverName">
            {{ table.serverName }}
          </div>
        </div>
      </div>
    </div>

    <!-- Table Details Sidebar -->
    <div class="table-details" *ngIf="selectedTable">
      <div class="details-header">
        <h3>{{ selectedTable.number }}</h3>
        <button class="btn-close" (click)="selectedTable = null">
          <i class="icon x-icon"></i>
        </button>
      </div>

      <div class="details-content">
        <div class="detail-row">
          <span class="detail-label">Statut</span>
          <span class="detail-value status-badge" [class]="'status-' + getStatusColor(selectedTable.status)">
            {{ getStatusLabel(selectedTable.status) }}
          </span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Capacité</span>
          <span class="detail-value">{{ selectedTable.seats }} places</span>
        </div>

        <div class="detail-row" *ngIf="selectedTable.serverName">
          <span class="detail-label">Serveur</span>
          <span class="detail-value">{{ selectedTable.serverName }}</span>
        </div>

        <div class="detail-row" *ngIf="selectedTable.guestsCount">
          <span class="detail-label">Convives</span>
          <span class="detail-value">{{ selectedTable.guestsCount }} personnes</span>
        </div>

        <div class="detail-row" *ngIf="selectedTable.occupiedSince">
          <span class="detail-label">Depuis</span>
          <span class="detail-value">{{ getElapsedTime(selectedTable.occupiedSince) }}</span>
        </div>

        <div class="detail-row" *ngIf="selectedTable.currentAmount !== undefined">
          <span class="detail-label">Montant actuel</span>
          <span class="detail-value amount">{{ selectedTable.currentAmount | number:'1.2-2' }} €</span>
        </div>
      </div>

      <div class="details-actions">
        <button
          *ngIf="selectedTable.status === 'free'"
          class="btn-action btn-assign"
          (click)="assignTable(selectedTable)">
          <i class="icon user-plus-icon"></i>
          Affecter
        </button>

        <button
          *ngIf="selectedTable.status === 'occupied' && selectedTable.serverId === 1"
          class="btn-action btn-order"
          (click)="takeOrder(selectedTable)">
          <i class="icon clipboard-icon"></i>
          Prendre Commande
        </button>

        <button
          *ngIf="selectedTable.status === 'occupied' && selectedTable.serverId === 1"
          class="btn-action btn-bill"
          (click)="generateBill(selectedTable)">
          <i class="icon credit-card-icon"></i>
          Facturer
        </button>

        <button
          *ngIf="(selectedTable.status === 'occupied' || selectedTable.status === 'billing') && selectedTable.serverId === 1"
          class="btn-action btn-free"
          (click)="freeTable(selectedTable)">
          <i class="icon check-icon"></i>
          Libérer
        </button>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="tables-list-view" *ngIf="viewMode === 'list'">
    <div
      *ngFor="let table of filteredTables"
      class="list-item"
      [class]="'list-' + table.status"
      (click)="selectTable(table)">
      <div class="list-item-header">
        <div class="table-info">
          <h3 class="table-number">{{ table.number }}</h3>
          <span class="table-seats">
            <i class="icon users-icon"></i>
            {{ table.seats }} places
          </span>
        </div>
        <span class="status-badge" [class]="'status-' + getStatusColor(table.status)">
          {{ getStatusLabel(table.status) }}
        </span>
      </div>

      <div class="list-item-content" *ngIf="table.status !== 'free'">
        <div class="info-row">
          <span class="info-label">Serveur:</span>
          <span class="info-value">{{ table.serverName || '-' }}</span>
        </div>
        <div class="info-row" *ngIf="table.guestsCount">
          <span class="info-label">Convives:</span>
          <span class="info-value">{{ table.guestsCount }}</span>
        </div>
        <div class="info-row" *ngIf="table.occupiedSince">
          <span class="info-label">Depuis:</span>
          <span class="info-value">{{ getElapsedTime(table.occupiedSince) }}</span>
        </div>
        <div class="info-row" *ngIf="table.currentAmount !== undefined">
          <span class="info-label">Montant:</span>
          <span class="info-value amount">{{ table.currentAmount | number:'1.2-2' }} €</span>
        </div>
      </div>

      <div class="list-item-actions">
        <button
          *ngIf="table.status === 'free'"
          class="btn-action-sm btn-primary"
          (click)="assignTable(table); $event.stopPropagation()">
          Affecter
        </button>
        <button
          *ngIf="table.status === 'occupied' && table.serverId === 1"
          class="btn-action-sm btn-primary"
          (click)="takeOrder(table); $event.stopPropagation()">
          Commander
        </button>
        <button
          *ngIf="table.status === 'occupied' && table.serverId === 1"
          class="btn-action-sm btn-danger"
          (click)="generateBill(table); $event.stopPropagation()">
          Facturer
        </button>
      </div>
    </div>
  </div>

</div>
