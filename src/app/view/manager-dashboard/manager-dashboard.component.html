<!-- ===== FICHIER: manager-dashboard.component.html ===== -->
<div class="dashboard" [class.sidebar-open]="isMobileSidebarOpen">

  <!-- ===== OVERLAY MOBILE ===== -->
  <div class="mobile-overlay"
       *ngIf="isMobileSidebarOpen"
       (click)="closeMobileSidebar()"></div>

  <!-- ===== SIDEBAR MANAGER (VERSION SIMPLIFIÃ‰E) ===== -->
  <aside class="sidebar" [class.mobile-open]="isMobileSidebarOpen">

    <!-- Logo et statut de prÃ©sence -->
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-icon">ğŸ¾</span>
        <span class="logo-text">Manager Pro</span>
      </div>
    </div>

    <!-- ===== BOUTON DE PRÃ‰SENCE ===== -->
    <div class="presence-section">
      <button class="presence-btn"
              [class.active]="userProfile.isPresent"
              (click)="togglePresence()">
        <span class="presence-icon">{{ userProfile.isPresent ? 'âœ…' : 'â­•' }}</span>
        <div class="presence-info">
          <span class="presence-label">{{ userProfile.isPresent ? 'Je suis prÃ©sent' : 'Je suis absent' }}</span>
          <span class="presence-cave">{{ userProfile.caveAssigned }}</span>
        </div>
      </button>

      <!-- Mini stats Ã©quipe -->
      <div class="team-quick-stats">
        <div class="stat-item present">
          <span class="stat-icon">âœ…</span>
          <span class="stat-count">{{ getPresenceCount('present') }}</span>
        </div>
        <div class="stat-item absent">
          <span class="stat-icon">â­•</span>
          <span class="stat-count">{{ getPresenceCount('absent') }}</span>
        </div>
        <div class="stat-item leave">
          <span class="stat-icon">ğŸ–ï¸</span>
          <span class="stat-count">{{ getPresenceCount('leave') }}</span>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- ===== NAVIGATION PRINCIPALE ===== -->
    <nav class="sidebar-section">
      <div class="nav-item"
           [routerLink]="['/manager', 'home']"
           routerLinkActive="active"
           (click)="closeMobileSidebar()">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-text">Tableau de bord</span>
      </div>

      <div class="nav-item"
           [routerLink]="['/manager', 'mycave']"
           routerLinkActive="active"
           (click)="closeMobileSidebar()">
        <span class="nav-icon">ğŸ·</span>
        <span class="nav-text">Ma cave</span>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- ===== SECTION Ã‰QUIPE AVEC SOUS-MENU ===== -->
    <nav class="sidebar-section">
      <div class="section-title-hover"
           (mouseenter)="onSectionMouseEnter('team')"
           (mouseleave)="onSectionMouseLeave()">
        <div class="section-title">MON Ã‰QUIPE</div>
      </div>

      <div class="hover-submenu"
           [class.show]="isSubmenuOpen('team')"
           (mouseenter)="onSubmenuMouseEnter()"
           (mouseleave)="onSubmenuMouseLeave()">

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'team']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ‘¥</span>
          <span class="nav-text">Vue d'ensemble</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'presence']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">PrÃ©sences</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'schedule']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“…</span>
          <span class="nav-text">Planning</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'performance']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Performance</span>
        </div>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- ===== SECTION OPÃ‰RATIONS ===== -->
    <nav class="sidebar-section">
      <div class="section-title-hover"
           (mouseenter)="onSectionMouseEnter('operations')"
           (mouseleave)="onSectionMouseLeave()">
        <div class="section-title">OPÃ‰RATIONS</div>
      </div>

      <div class="hover-submenu"
           [class.show]="isSubmenuOpen('operations')"
           (mouseenter)="onSubmenuMouseEnter()"
           (mouseleave)="onSubmenuMouseLeave()">

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'orders']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ›’</span>
          <span class="nav-text">Commandes</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'sales']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ’°</span>
          <span class="nav-text">Ventes</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'stockrequest']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“¦</span>
          <span class="nav-text">Demandes de stock</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'inventory']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">Inventaire</span>
        </div>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- ===== SECTION RAPPORTS ===== -->
    <nav class="sidebar-section">
      <div class="section-title-hover"
           (mouseenter)="onSectionMouseEnter('reports')"
           (mouseleave)="onSectionMouseLeave()">
        <div class="section-title">RAPPORTS</div>
      </div>

      <div class="hover-submenu"
           [class.show]="isSubmenuOpen('reports')"
           (mouseenter)="onSubmenuMouseEnter()"
           (mouseleave)="onSubmenuMouseLeave()">

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'dailyreport']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">Rapport journalier</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'cashregister']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ’µ</span>
          <span class="nav-text">Caisse</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'incident']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">âš ï¸</span>
          <span class="nav-text">Incidents</span>
        </div>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- ===== SECTION CLIENT ===== -->
    <nav class="sidebar-section">
      <div class="nav-item"
           [routerLink]="['/manager', 'customers']"
           routerLinkActive="active"
           (click)="closeMobileSidebar()">
        <span class="nav-icon">ğŸ§‘â€ğŸ’¼</span>
        <span class="nav-text">Clients</span>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- ===== SECTION AIDE ===== -->
    <nav class="sidebar-section">
      <div class="section-title-hover"
           (mouseenter)="onSectionMouseEnter('help')"
           (mouseleave)="onSectionMouseLeave()">
        <div class="section-title">AIDE</div>
      </div>

      <div class="hover-submenu"
           [class.show]="isSubmenuOpen('help')"
           (mouseenter)="onSubmenuMouseEnter()"
           (mouseleave)="onSubmenuMouseLeave()">

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'faq']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">â“</span>
          <span class="nav-text">FAQ</span>
        </div>

        <div class="nav-item submenu-item"
             [routerLink]="['/manager', 'contact']"
             routerLinkActive="active"
             (click)="closeMobileSidebar()">
          <span class="nav-icon">ğŸ“§</span>
          <span class="nav-text">Support</span>
        </div>
      </div>
    </nav>

    <div class="divider"></div>

    <!-- Mon compte -->
    <nav class="sidebar-section">
      <div class="nav-item"
           [routerLink]="['/manager', 'profile']"
           routerLinkActive="active"
           (click)="closeMobileSidebar()">
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-text">Mon compte</span>
      </div>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer">
      <p class="version-text">Manager v1.0</p>
      <p class="copyright-text">Â© 2025 CaveViking Pro</p>
    </div>
  </aside>

  <!-- ===== CONTENU PRINCIPAL ===== -->
  <main class="main-content">

    <!-- En-tÃªte -->
    <header class="top-header">
      <!-- Bouton menu mobile -->
      <button class="mobile-menu-btn" (click)="toggleMobileSidebar()" aria-label="Menu">
        â˜°
      </button>

      <!-- Barre de recherche -->
      <div class="header-left">
        <div class="search-bar">
          <input
            type="text"
            placeholder="Rechercher un vin, commande, membre..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
            aria-label="Recherche">
          <button class="search-btn" (click)="onSearch()" aria-label="Rechercher">
            ğŸ”
          </button>
        </div>
      </div>

      <!-- Ã‰lÃ©ments Ã  droite -->
      <div class="header-right">
        <!-- Composant de changement de thÃ¨me -->
        <app-theme-toggle></app-theme-toggle>

        <!-- Messages -->
        <div class="header-icon"
             [routerLink]="['/manager', 'messages']"
             role="button"
             tabindex="0"
             aria-label="Messages">
          <span class="icon">ğŸ’¬</span>
          <span class="badge" *ngIf="getUnreadMessagesCount() > 0">
            {{ getUnreadMessagesCount() }}
          </span>
        </div>

        <!-- Notifications -->
        <div class="header-icon"
             [routerLink]="['/manager', 'notifications']"
             role="button"
             tabindex="0"
             aria-label="Notifications">
          <span class="icon">ğŸ””</span>
          <span class="badge" *ngIf="getUnreadNotificationsCount() > 0">
            {{ getUnreadNotificationsCount() }}
          </span>
        </div>

        <!-- Profil utilisateur -->
        <div class="user-profile"
             (click)="toggleUserDropdown($event)"
             role="button"
             tabindex="0"
             aria-label="Profil utilisateur">
          <div class="avatar">{{ userProfile.avatar }}</div>
          <div class="user-info">
            <div class="user-name">{{ userProfile.firstName }} {{ userProfile.lastName }}</div>
            <div class="user-role">{{ userProfile.role }} - {{ userProfile.caveAssigned }}</div>
          </div>
          <span class="dropdown-arrow" [class.rotated]="isUserDropdownOpen">â–¼</span>

          <!-- Menu dropdown -->
          <div class="user-dropdown"
               [class.show]="isUserDropdownOpen"
               (click)="$event.stopPropagation()">
            <div class="dropdown-item"
                 [routerLink]="['/manager', 'profile']"
                 (click)="isUserDropdownOpen = false">
              <span class="dropdown-icon">ğŸ‘¤</span>
              <span>Mon profil</span>
            </div>
            <div class="dropdown-item"
                 [routerLink]="['/manager', 'settings']"
                 (click)="isUserDropdownOpen = false">
              <span class="dropdown-icon">âš™ï¸</span>
              <span>ParamÃ¨tres</span>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-item logout-item" (click)="logout($event)">
              <span class="dropdown-icon">ğŸšª</span>
              <span>DÃ©connexion</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== ROUTER OUTLET ===== -->
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
      <div class="footer-content">
        <p class="footer-text">
          Â© 2025 CaveViking Pro Manager - Tous droits rÃ©servÃ©s
        </p>
        <div class="footer-links">
          <a [routerLink]="['/manager', 'help']" class="footer-link">Aide</a>
          <span class="separator">â€¢</span>
          <a [routerLink]="['/manager', 'contact']" class="footer-link">Contact</a>
        </div>
      </div>
    </footer>
  </main>
</div>
