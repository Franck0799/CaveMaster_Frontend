
<div class="daily-report-page">
  <div class="page-header">
    <div>
      <h1 class="page-title">Rapport Journalier</h1>
      <p class="page-subtitle">{{ reportDate | date:'EEEE d MMMM y':'':'fr' }}</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="viewHistory()">
        ğŸ“… Historique
      </button>
      <button class="btn-primary" (click)="submitReport()" [disabled]="!canSubmit">
        ğŸ’¾ Enregistrer le rapport
      </button>
    </div>
  </div>

  <!-- RÃ©sumÃ© rapide -->
  <div class="quick-summary">
    <div class="summary-card">
      <div class="summary-icon">ğŸ’°</div>
      <div class="summary-content">
        <div class="summary-label">Ventes totales</div>
        <div class="summary-value">{{ report.totalSales | number:'1.2-2' }} â‚¬</div>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">ğŸ›’</div>
      <div class="summary-content">
        <div class="summary-label">Commandes</div>
        <div class="summary-value">{{ report.totalOrders }}</div>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">ğŸ‘¥</div>
      <div class="summary-content">
        <div class="summary-label">Ã‰quipe prÃ©sente</div>
        <div class="summary-value">{{ report.teamPresent }}</div>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">âš–ï¸</div>
      <div class="summary-content">
        <div class="summary-label">DiffÃ©rence caisse</div>
        <div class="summary-value" [class.positive]="cashDifference >= 0" [class.negative]="cashDifference < 0">
          {{ cashDifference | number:'1.2-2' }} â‚¬
        </div>
      </div>
    </div>
  </div>

  <!-- Formulaire de rapport -->
  <div class="report-form">
    <!-- Section Caisse -->
    <div class="form-section">
      <h3 class="section-title">ğŸ’µ Caisse</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Ouverture de caisse</label>
          <input type="number" [(ngModel)]="report.openingCash" class="form-input">
        </div>
        <div class="form-group">
          <label>Fermeture de caisse</label>
          <input type="number" [(ngModel)]="report.closingCash" class="form-input">
        </div>
      </div>
    </div>

    <!-- Section Ventes -->
    <div class="form-section">
      <h3 class="section-title">ğŸ“Š Ventes</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Paiements espÃ¨ces</label>
          <input type="number" [(ngModel)]="report.cashPayments" class="form-input">
        </div>
        <div class="form-group">
          <label>Paiements carte</label>
          <input type="number" [(ngModel)]="report.cardPayments" class="form-input">
        </div>
      </div>
    </div>

    <!-- Section Incidents -->
    <div class="form-section">
      <h3 class="section-title">âš ï¸ Incidents</h3>
      <div class="incidents-list">
        <div class="incident-item" *ngFor="let incident of report.incidents; let i = index">
          <input type="text" [(ngModel)]="report.incidents[i]" class="form-input" placeholder="DÃ©crire l'incident...">
          <button class="btn-remove" (click)="removeIncident(i)">ğŸ—‘ï¸</button>
        </div>
      </div>
      <button class="btn-add" (click)="addIncident()">
        â• Ajouter un incident
      </button>
    </div>

    <!-- Section Notes -->
    <div class="form-section">
      <h3 class="section-title">ğŸ“ Notes et observations</h3>
      <textarea [(ngModel)]="report.notes"
                class="form-textarea"
                rows="6"
                placeholder="Notes gÃ©nÃ©rales, observations, points Ã  amÃ©liorer..."></textarea>
    </div>
  </div>
</div>
<!-- ===== DAILY REPORT - MODAL HISTORIQUE ===== -->
<div class="modal-overlay" *ngIf="showHistoryModal" (click)="closeHistoryModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Historique des rapports</h2>
      <button class="btn-close" (click)="closeHistoryModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <div class="history-table">
        <div class="history-row" *ngFor="let history of reportHistory">
          <div class="history-date">
            <span class="date">{{ history.date | date:'dd/MM/yyyy' }}</span>
            <span class="day">{{ history.date | date:'EEEE':'':'fr' }}</span>
          </div>
          <div class="history-info">
            <div class="info-item">
              <span class="label">Ventes:</span>
              <span class="value">{{ history.totalSales | number:'1.2-2' }}â‚¬</span>
            </div>
            <div class="info-item">
              <span class="label">DiffÃ©rence:</span>
              <span class="value" [class.positive]="history.difference >= 0" [class.negative]="history.difference < 0">
                {{ history.difference | number:'1.2-2' }}â‚¬
              </span>
            </div>
          </div>
          <div class="history-status">
            <span class="status-badge" [class]="'status-' + history.status">
              {{ getStatusLabel(history.status) }}
            </span>
          </div>
          <div class="history-actions">
            <button class="btn-link" (click)="loadHistoryReport(history)">Charger</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeHistoryModal()">Fermer</button>
    </div>
  </div>
</div>
